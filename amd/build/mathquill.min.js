define ("qtype_shortmath/mathquill",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=void 0;function s(e){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){s=function(e){return typeof e}}else{s=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}}return s(e)}!function(){function ee(){}function te(s){var t=s.length-1;return function(){var e=d.call(arguments,0,t),r=d.call(arguments,t);return s.apply(this,e.concat([r]))}}function se(s){return te(function(r,a){"function"!=typeof r&&(r=m(r));var t=function(e){return r.apply(e,[e].concat(a))};return s.call(this,t)})}function re(s){var t=d.call(arguments,1);return function(){return s.apply(this,t)}}function ne(s,t){if(!t)throw new Error("prayer failed: "+s)}function ae(e){ne("a direction was passed",e===ie||e===oe)}function le(s,t,e){ne("a parent is always present",s),ne("leftward is properly set up",function(){return t?t[oe]===e&&t.parent===s:s.ends[ie]===e}()),ne("rightward is properly set up",function(){return e?e[ie]===t&&e.parent===s:s.ends[oe]===t}())}function r(){window.console&&console.warn("You are using the MathQuill API without specifying an interface version, which will fail in v1.0.0. Easiest fix is to do the following before doing anything else:\n\n    MathQuill = MathQuill.getInterface(1);\n    // now MathQuill.MathField() works like it used to\n\nSee also the \"`dev` branch (2014\u20132015) \u2192 v0.10.0 Migration Guide\" at\n  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide")}function n(e){return r(),ss(e)}function e(l){function e(s){var t,r;return s&&s.nodeType?(t=pe(s).children(".mq-root-block").attr(At),r=t&&de.byId[t].controller,r?a[r.KIND_OF_MQ](r):null):null}function n(s,t){var e,l,o;t&&t.handlers&&(t.handlers={fns:t.handlers,APIClasses:a});for(e in t){t.hasOwnProperty(e)&&(l=t[e],o=qe[e],s[e]=o?o(l):l)}}var a,t,i;if(!(ye<=l&&l<=Oe))throw"Only interface versions between "+ye+" and "+Oe+" supported. You specified: "+l;a={},e.L=ie,e.R=oe,e.saneKeyboardEvents=je,e.config=function(e){return n(ge.p,e),this},e.registerEmbed=function(s,t){if(!/^[a-z][a-z0-9]*$/i.test(s))throw"Embed name must start with letter and be only letters and digits";xe[s]=t},t=a.AbstractMathQuill=u(be,function(e){e.init=function(e){this.__controller=e,this.__options=e.options,this.id=e.id,this.data=e.data},e.__mathquillify=function(r){var t,a=this.__controller,n=a.root,l=a.container;a.createTextarea(),t=l.addClass(r).contents().detach(),n.jQ=pe("<span class=\"mq-root-block\"/>").attr(At,n.id).appendTo(l),this.latex(t.text()),this.revert=function(){return l.empty().unbind(".mathquill").removeClass("mq-editable-field mq-math-mode mq-text-mode").append(t)}},e.config=function(e){return n(this.__options,e),this},e.el=function(){return this.__controller.container[0]},e.text=function(){return this.__controller.exportText()},e.latex=function(e){return 0<arguments.length?(this.__controller.renderLatexMath(e),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()},e.html=function(){return this.__controller.root.jQ.html().replace(/ mathquill-(?:command|block)-id="?\d+"?/g,"").replace(/<span class="?mq-cursor( mq-blink)?"?>.?<\/span>/i,"").replace(/ mq-hasCursor|mq-hasCursor ?/,"").replace(/ class=(""|(?= |>))/g,"")},e.reflow=function(){return this.__controller.root.postOrder("reflow"),this}}),e.prototype=t.prototype,a.EditableField=u(t,function(t,e){t.__mathquillify=function(){return e.__mathquillify.apply(this,arguments),this.__controller.editable=!0,this.__controller.delegateMouseEvents(),this.__controller.editablesTextareaEvents(),this},t.focus=function(){return this.__controller.textarea.focus(),this},t.blur=function(){return this.__controller.textarea.blur(),this},t.write=function(e){return this.__controller.writeLatex(e),this.__controller.scrollHoriz(),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this},t.empty=function(){var s=this.__controller.root,t=this.__controller.cursor;return s.eachChild("postOrder","dispose"),s.ends[ie]=s.ends[oe]=0,s.jQ.empty(),delete t.selection,t.insAtRightEnd(s),this},t.cmd=function(s){var r,a=this.__controller.notify(),n=a.cursor;return /^\\[a-z]+$/i.test(s)?(s=s.slice(1),(r=f[s])&&(s=r(s),n.selection&&s.replaces(n.replaceSelection()),s.createLeftOf(n.show()),this.__controller.scrollHoriz())):n.parent.write(n,s),a.blurred&&n.hide().parent.blur(),this},t.select=function(){var e=this.__controller;for(e.notify("move").cursor.insAtRightEnd(e.root);e.cursor[ie];){e.selectLeft()}return this},t.clearSelection=function(){return this.__controller.cursor.clearSelection(),this},t.moveToDirEnd=function(e){return this.__controller.notify("move").cursor.insAtDirEnd(e,this.__controller.root),this},t.moveToLeftEnd=function(){return this.moveToDirEnd(ie)},t.moveToRightEnd=function(){return this.moveToDirEnd(oe)},t.keystroke=function(t){var s;for(t=t.replace(/^\s+|\s+$/g,"").split(/\s+/),s=0;s<t.length;s+=1){this.__controller.keystroke(t[s],{preventDefault:ee})}return this},t.typedText=function(s){for(var t=0;t<s.length;t+=1){this.__controller.typedText(s.charAt(t))}return this},t.dropEmbedded=function(a,t,e){var n,l=a-pe(window).scrollLeft(),s=t-pe(window).scrollTop(),r=document.elementFromPoint(l,s);this.__controller.seek(pe(r),a,t),n=ts().setOptions(e),n.createLeftOf(this.__controller.cursor)},t.clickAt=function(r,t,e){e=e||document.elementFromPoint(r,t);var a=this.__controller,l=a.root;return ns.contains(l.jQ[0],e)||(e=l.jQ[0]),a.seek(pe(e),r+pageXOffset,t+pageYOffset),a.blurred&&this.focus(),this},t.ignoreNextMousedown=function(e){return this.__controller.cursor.options.ignoreNextMousedown=e,this}}),e.EditableField=function(){throw"wtf don't call me, I'm 'abstract'"},e.EditableField.prototype=a.EditableField.prototype;for(i in we){!function(n,t){var p=a[n]=t(a);e[n]=function(t,r){var s,i=e(t);return i instanceof p||!t||!t.nodeType?i:(s=fe(p.RootBlock(),pe(t),ge()),s.KIND_OF_MQ=n,p(s).__mathquillify(r,l))},e[n].prototype=p.prototype}(i,we[i])}return e}function l(s){var t,r=["moveOutOf","deleteOutOf","selectOutOf","upOutOf","downOutOf"];for(t=0;t<r.length;t+=1){!function(r){s[r]=function(e){this.controller.handle(r,e)}}(r[t])}s.reflow=function(){this.controller.handle("reflow"),this.controller.handle("edited"),this.controller.handle("edit")}}function t(s,t,e){return u(Ae,{ctrlSeq:s,htmlTemplate:"<"+t+" "+e+">&0</"+t+">"})}function c(s){var t=this.parent,e=s;do{if(e[oe])return s.insLeftOf(t);e=e.parent.parent}while(e!==t);s.insRightOf(t)}function i(s,t){s.jQadd=function(){t.jQadd.apply(this,arguments),this.delimjQs=this.jQ.children(":first").add(this.jQ.children(":last")),this.contentjQ=this.jQ.children(":eq(1)")},s.reflow=function(){var e=this.contentjQ.outerHeight()/parseFloat(this.contentjQ.css("fontSize"));Je(this.delimjQs,It(1+.2*(e-1),1.2),1.2*e)}}function o(r,t){var t=t||r,a=Jt[r],n=Jt[t];me[r]=re(Zt,ie,r,a,t,n),me[a]=re(Zt,oe,r,a,t,n)}var p,d,m,u,ie,oe,pe,h,de,ce,f,me,ue,he,fe,we,ge,qe,be,xe,ye,Oe,ve,Qe,je,ke,Te,Ce,_e,Se,De,Ee,Le,Ae,Re,Ie,Be,Me,ze,Fe,Ne,Pe,$e,Ue,We,He,Ve,Ge,Ke,Ye,Xe,Ze,Je,Rt,Bt,Ft,Nt,Pt,$t,Ut,Wt,Ht,Vt,Gt,Kt,Yt,Xt,Zt,Jt,es,ts,ss,rs,ns=window.jQuery,At="mathquill-block-id",It=Math.min,zt=Math.max;if(!ns)throw"MathQuill requires jQuery 1.5.2+ to be loaded first";d=[].slice,m=te(function(s,t){return te(function(r,e){if(s in r)return r[s].apply(r,t.concat(e))})}),u=function(n,t){function e(e){return"object"==s(e)}function i(e){return"function"==typeof e}function p(){}return function s(d,r){function m(){var e=new a;return i(e.init)&&e.init.apply(e,arguments),e}function a(){}var l,f,w;return void 0===r&&(r=d,d=Object),m.Bare=a,l=p.prototype=d.prototype,f=a.prototype=m.prototype=m.p=new p,f.constructor=m,m.extend=function(t){return s(m,t)},(m.open=function(s){if(w={},i(s)?w=s.call(m,f,l,m,d):e(s)&&(w=s),e(w))for(var n in w){t.call(w,n)&&(f[n]=w[n])}return i(f.init)||(f.init=d),m})(r)}}(0,{}.hasOwnProperty),ie=-1,oe=1,pe=u(ns,function(e){e.insDirOf=function(s,t){return s===ie?this.insertBefore(t.first()):this.insertAfter(t.last())},e.insAtDirEnd=function(s,t){return s===ie?this.prependTo(t):this.appendTo(t)}}),h=u(function(e){e.parent=0,e[ie]=0,e[oe]=0,e.init=function(s,t,e){this.parent=s,this[ie]=t,this[oe]=e},this.copy=function(e){return h(e.parent,e[ie],e[oe])}}),de=u(function(s){function t(){return e+=1}s[ie]=0,s[oe]=0,s.parent=0;var e=0;this.byId={},s.init=function(){this.id=t(),de.byId[this.id]=this,this.ends={},this.ends[ie]=0,this.ends[oe]=0},s.dispose=function(){delete de.byId[this.id]},s.toString=function(){return"{{ MathQuill Node #"+this.id+" }}"},s.jQ=pe(),s.jQadd=function(e){return this.jQ=this.jQ.add(e)},s.jQize=function(s){function r(e){var s,a;for(e.getAttribute&&(s=e.getAttribute("mathquill-command-id"),a=e.getAttribute("mathquill-block-id"),s&&de.byId[s].jQadd(e),a&&de.byId[a].jQadd(e)),e=e.firstChild;e;e=e.nextSibling){r(e)}}var e;for(s=pe(s||this.html()),e=0;e<s.length;e+=1){r(s[e])}return s},s.createDir=function(s,t){ae(s);var e=this;return e.jQize(),e.jQ.insDirOf(s,t.jQ),t[s]=e.adopt(t.parent,t[ie],t[oe]),e},s.createLeftOf=function(e){return this.createDir(ie,e)},s.selectChildren=function(s,t){return he(s,t)},s.bubble=se(function(s){var t;for(t=this;t&&!1!==s(t);t=t.parent){}return this}),s.postOrder=se(function(s){return function t(e){e.eachChild(t),s(e)}(this),this}),s.isEmpty=function(){return 0===this.ends[ie]&&0===this.ends[oe]},s.isStyleBlock=function(){return!1},s.children=function(){return ce(this.ends[ie],this.ends[oe])},s.eachChild=function(){var e=this.children();return e.each.apply(e,arguments),this},s.foldChildren=function(s,t){return this.children().fold(s,t)},s.withDirAdopt=function(s,t,e,r){return ce(this,this).withDirAdopt(s,t,e,r),this},s.adopt=function(s,t,e){return ce(this,this).adopt(s,t,e),this},s.disown=function(){return ce(this,this).disown(),this},s.remove=function(){return this.jQ.remove(),this.postOrder("dispose"),this.disown()}}),ce=u(function(e){e.init=function(s,t,e){if(e===p&&(e=ie),ae(e),ne("no half-empty fragments",!s==!t),this.ends={},s){ne("withDir is passed to Fragment",s instanceof de),ne("oppDir is passed to Fragment",t instanceof de),ne("withDir and oppDir have the same parent",s.parent===t.parent),this.ends[e]=s,this.ends[-e]=t;var r=this.fold([],function(s,t){return s.push.apply(s,t.jQ.get()),s});this.jQ=this.jQ.add(r)}},e.jQ=pe(),e.withDirAdopt=function(s,t,e,r){return s===ie?this.adopt(t,e,r):this.adopt(t,r,e)},e.adopt=function(a,t,l){var n,o,p;return le(a,t,l),n=this,n.disowned=!1,(o=n.ends[ie])?(p=n.ends[oe],t||(a.ends[ie]=o),l?l[ie]=p:a.ends[oe]=p,n.ends[oe][oe]=l,n.each(function(e){e[ie]=t,e.parent=a,t&&(t[oe]=e),t=e}),n):this},e.disown=function(){var s,r,a=this,n=a.ends[ie];return!n||a.disowned?a:(a.disowned=!0,s=a.ends[oe],r=n.parent,le(r,n[ie],n),le(r,s,s[oe]),n[ie]?n[ie][oe]=s[oe]:r.ends[ie]=s[oe],s[oe]?s[oe][ie]=n[ie]:r.ends[oe]=n[ie],a)},e.remove=function(){return this.jQ.remove(),this.each("postOrder","dispose"),this.disown()},e.each=se(function(s){var t=this,e=t.ends[ie];if(!e)return t;for(;e!==t.ends[oe][oe]&&!1!==s(e);e=e[oe]){}return t}),e.fold=function(s,r){return this.each(function(e){s=r.call(this,s,e)}),s}}),f={},me={},ue=u(h,function(e){e.init=function(s,t){this.parent=s,this.options=t;var e=this.jQ=this._jQ=pe("<span class=\"mq-cursor\">&#8203;</span>");this.blink=function(){e.toggleClass("mq-blink")},this.upDownCache={}},e.show=function(){return this.jQ=this._jQ.removeClass("mq-blink"),"intervalId"in this?clearInterval(this.intervalId):(this[oe]?this.selection&&this.selection.ends[ie][ie]===this[ie]?this.jQ.insertBefore(this.selection.jQ):this.jQ.insertBefore(this[oe].jQ.first()):this.jQ.appendTo(this.parent.jQ),this.parent.focus()),this.intervalId=setInterval(this.blink,500),this},e.hide=function(){return"intervalId"in this&&clearInterval(this.intervalId),delete this.intervalId,this.jQ.detach(),this.jQ=pe(),this},e.withDirInsertAt=function(r,t,e,n){var a=this.parent;this.parent=t,this[r]=e,this[-r]=n,a!==t&&a.blur&&a.blur(this)},e.insDirOf=function(s,t){return ae(s),this.jQ.insDirOf(s,t.jQ),this.withDirInsertAt(s,t.parent,t[s],t),this.parent.jQ.addClass("mq-hasCursor"),this},e.insLeftOf=function(e){return this.insDirOf(ie,e)},e.insRightOf=function(e){return this.insDirOf(oe,e)},e.insAtDirEnd=function(s,t){return ae(s),this.jQ.insAtDirEnd(s,t.jQ),this.withDirInsertAt(s,t,0,t.ends[s]),t.focus(),this},e.insAtLeftEnd=function(e){return this.insAtDirEnd(ie,e)},e.insAtRightEnd=function(e){return this.insAtDirEnd(oe,e)},e.jumpUpDown=function(r,t){var e,a,l=this;l.upDownCache[r.id]=h.copy(l),e=l.upDownCache[t.id],e?e[oe]?l.insLeftOf(e[oe]):l.insAtRightEnd(e.parent):(a=l.offset().left,t.seek(a,l))},e.offset=function(){var s=this,t=s.jQ.removeClass("mq-cursor").offset();return s.jQ.addClass("mq-cursor"),t},e.unwrapGramp=function(){var r=this.parent.parent,t=r.parent,e=r[oe],n=this,a=r[ie];if(r.disown().eachChild(function(s){s.isEmpty()||(s.children().adopt(t,a,e).each(function(t){t.jQ.insertBefore(r.jQ.first())}),a=s.ends[oe])}),!this[oe])if(this[ie])this[oe]=this[ie][oe];else for(;!this[oe];){if(this.parent=this.parent[oe],!this.parent){this[oe]=r[oe],this.parent=t;break}this[oe]=this.parent.ends[ie]}this[oe]?this.insLeftOf(this[oe]):this.insAtRightEnd(t),r.jQ.remove(),r[ie].siblingDeleted&&r[ie].siblingDeleted(n.options,oe),r[oe].siblingDeleted&&r[oe].siblingDeleted(n.options,ie)},e.startSelection=function(){var s,r=this.anticursor=h.copy(this),e=r.ancestors={};for(s=r;s.parent;s=s.parent){e[s.parent.id]=s}},e.endSelection=function(){delete this.anticursor},e.select=function(){var s,p,d,c,m,u,f,w=this.anticursor;if(this[ie]===w[ie]&&this.parent===w.parent)return!1;for(s=this;s.parent;s=s.parent){if(s.parent.id in w.ancestors){p=s.parent;break}}if(ne("cursor and anticursor in the same tree",p),d=w.ancestors[p.id],u=oe,s[ie]!==d)for(f=s;f;f=f[oe]){if(f[oe]===d[oe]){u=ie,c=s,m=d;break}}return u===oe&&(c=d,m=s),c instanceof h&&(c=c[oe]),m instanceof h&&(m=m[ie]),this.hide().selection=p.selectChildren(c,m),this.insDirOf(u,this.selection.ends[u]),this.selectionChanged(),!0},e.clearSelection=function(){return this.selection&&(this.selection.clear(),delete this.selection,this.selectionChanged()),this},e.deleteSelection=function(){this.selection&&(this[ie]=this.selection.ends[ie][ie],this[oe]=this.selection.ends[oe][oe],this.selection.remove(),this.selectionChanged(),delete this.selection)},e.replaceSelection=function(){var e=this.selection;return e&&(this[ie]=e.ends[ie][ie],this[oe]=e.ends[oe][oe],delete this.selection),e}}),he=u(ce,function(s,t){s.init=function(){t.init.apply(this,arguments),this.jQ=this.jQ.wrapAll("<span class=\"mq-selection\"></span>").parent()},s.adopt=function(){return this.jQ.replaceWith(this.jQ=this.jQ.children()),t.adopt.apply(this,arguments)},s.clear=function(){return this.jQ.replaceWith(this.jQ[0].childNodes),this},s.join=function(s){return this.fold("",function(t,e){return t+e[s]()})}}),fe=u(function(s){s.init=function(s,t,e){this.id=s.id,this.data={},this.root=s,this.container=t,this.options=e,s.controller=this,this.cursor=s.cursor=ue(s,e)},s.handle=function(s,t){var e,r=this.options.handlers;r&&r.fns[s]&&(e=r.APIClasses[this.KIND_OF_MQ](this),t===ie||t===oe?r.fns[s](t,e):r.fns[s](e))};var r=[];this.onNotify=function(e){r.push(e)},s.notify=function(){for(var e=0;e<r.length;e+=1){r[e].apply(this.cursor,arguments)}return this}}),we={},ge=u(),qe={},be=u(),xe={},n.prototype=be.p,n.VERSION="v0.10.1",n.interfaceVersion=function(e){if(1!==e)throw"Only interface version 1 supported. You specified: "+e;return r=function(){window.console&&console.warn("You called MathQuill.interfaceVersion(1); to specify the interface version, which will fail in v1.0.0. You can fix this easily by doing this before doing anything else:\n\n    MathQuill = MathQuill.getInterface(1);\n    // now MathQuill.MathField() works like it used to\n\nSee also the \"`dev` branch (2014\u20132015) \u2192 v0.10.0 Migration Guide\" at\n  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide")},r(),n},n.getInterface=e,ye=e.MIN=1,Oe=e.MAX=2,n.noConflict=function(){return window.MathQuill=ve,n},ve=window.MathQuill,window.MathQuill=n,Qe=u(function(s,t,l){function n(s,r){throw s=s?"'"+s+"'":"EOF","Parse Error: "+r+" at "+s}var e,i,p;s.init=function(e){this._=e},s.parse=function(s){function t(s,t){return t}return this.skip(p)._(""+s,t,n)},s.or=function(r){ne("or is passed a parser",r instanceof l);var t=this;return l(function(e,n,a){return t._(e,n,function(){return r._(e,n,a)})})},s.then=function(s){var t=this;return l(function(e,n,r){function i(t,e){var i=s instanceof l?s:s(e);return ne("a parser is returned",i instanceof l),i._(t,n,r)}return t._(e,i,r)})},s.many=function(){var n=this;return l(function(a,t){function l(e,t){return a=e,r.push(t),!0}function s(){return!1}for(var r=[];n._(a,l,s);){}return t(a,r)})},s.times=function(s,t){2>arguments.length&&(t=s);var p=this;return l(function(i,e,d){function r(s,t){return w.push(t),i=s,!0}function o(s,t){return l=t,i=s,!1}function a(){return!1}var l,m,w=[],h=!0;for(m=0;m<s;m+=1){if(!(h=p._(i,r,o)))return d(i,l)}for(;m<t&&h;m+=1){h=p._(i,r,a)}return e(i,w)})},s.result=function(e){return this.then(i(e))},s.atMost=function(e){return this.times(0,e)},s.atLeast=function(s){var r=this;return r.times(s).then(function(s){return r.many().map(function(t){return s.concat(t)})})},s.map=function(s){return this.then(function(t){return i(s(t))})},s.skip=function(s){return this.then(function(t){return s.result(t)})},this.string=function(a){var t=a.length;return l(function(e,n,s){var r=e.slice(0,t);return r===a?n(e.slice(t),r):s(e,"expected '"+a+"'")})},e=this.regex=function(e){ne("regexp parser is anchored","^"===e.toString().charAt(1));return l(function(t,n,a){var s,l=e.exec(t);return l?(s=l[0],n(t.slice(s.length),s)):a(t,"expected "+e)})},i=l.succeed=function(s){return l(function(t,e){return e(t,s)})},l.fail=function(s){return l(function(t,e,r){return r(t,s)})},l.letter=e(/^[a-z]/i),l.letters=e(/^[a-z]*/i),l.digit=e(/^[0-9]/),l.digits=e(/^[0-9]*/),l.whitespace=e(/^\s+/),l.optWhitespace=e(/^\s*/),l.any=l(function(s,t,e){return s?t(s.slice(1),s.charAt(0)):e(s,"expected any character")}),l.all=l(function(s,t){return t("",s)}),p=l.eof=l(function(s,t,e){return s?e(s,"expected EOF"):t(s,s)})}),je=function(){function t(n){var t,l=n.which||n.keyCode,i=a[l],s=[];return n.ctrlKey&&s.push("Ctrl"),n.originalEvent&&n.originalEvent.metaKey&&s.push("Meta"),n.altKey&&s.push("Alt"),n.shiftKey&&s.push("Shift"),t=i||String.fromCharCode(l),s.length||i?(s.push(t),s.join("-")):t}var a={8:"Backspace",9:"Tab",10:"Enter",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",144:"NumLock"};return function(e,n){function i(e){x=e,clearTimeout(m),m=setTimeout(e)}function s(t){i(function(e){x=ee,clearTimeout(m),t(e)})}function r(t){x(),x=ee,clearTimeout(m),Q.val(t),t&&Q[0].select&&Q[0].select(),h=!!t}function o(){var e=Q[0];return"selectionStart"in e&&e.selectionStart!==e.selectionEnd}function a(){n.keystroke(t(f),f)}function l(e){f=e,O=null,h&&s(function(e){e&&"focusout"===e.type||!Q[0].select||Q[0].select()}),a()}function p(e){f&&O&&a(),O=e,i(c)}function d(){f&&!O&&i(c)}function c(){if(!o()){var e=Q.val();1===e.length?(Q.val(""),n.typedText(e)):e&&Q[0].select&&Q[0].select()}}function u(){var e=Q.val();Q.val(""),e&&n.paste(e)}var m,h,f=null,O=null,Q=ns(e),q=ns(n.container||Q),x=ee;return q.bind("keydown keypress input keyup focusout paste",function(e){x(e)}),h=!1,q.bind({keydown:l,keypress:p,keyup:d,focusout:function(){f=O=null},cut:function cut(){s(function(){n.cut()})},copy:function copy(){s(function(){n.copy()})},paste:function(){Q.focus(),i(u)}}),{select:r}}}(),fe.open(function(e){e.exportText=function(){return this.root.foldChildren("",function(s,t){return s+t.text()})}}),fe.open(function(e){e.focusBlurEvents=function(){function a(){clearTimeout(e),s.selection&&s.selection.jQ.addClass("mq-blur"),t()}function t(){s.hide().parent.blur(),l.container.removeClass("mq-focused"),pe(window).unbind("blur",a)}var e,l=this,i=l.root,s=l.cursor;l.textarea.focus(function(){l.blurred=!1,clearTimeout(e),l.container.addClass("mq-focused"),s.parent||s.insAtRightEnd(i),s.selection?(s.selection.jQ.removeClass("mq-blur"),l.selectionChanged()):s.show()}).blur(function(){l.blurred=!0,e=setTimeout(function(){i.postOrder("intentionalBlur"),s.clearSelection().endSelection(),t()}),pe(window).bind("blur",a)}),l.blurred=!0,s.hide().parent.blur()}}),fe.open(function(e){e.keystroke=function(s,t){this.cursor.parent.keystroke(s,t,this)}}),de.open(function(e){e.keystroke=function(s,t,e){var r=e.cursor;switch(s){case"Ctrl-Shift-Backspace":case"Ctrl-Backspace":e.ctrlDeleteDir(ie);break;case"Shift-Backspace":case"Backspace":e.backspace();break;case"Esc":case"Tab":return void e.escapeDir(oe,s,t);case"Shift-Tab":case"Shift-Esc":return void e.escapeDir(ie,s,t);case"End":e.notify("move").cursor.insAtRightEnd(r.parent);break;case"Ctrl-End":e.notify("move").cursor.insAtRightEnd(e.root);break;case"Shift-End":for(;r[oe];){e.selectRight()}break;case"Ctrl-Shift-End":for(;r[oe]||r.parent!==e.root;){e.selectRight()}break;case"Home":e.notify("move").cursor.insAtLeftEnd(r.parent);break;case"Ctrl-Home":e.notify("move").cursor.insAtLeftEnd(e.root);break;case"Shift-Home":for(;r[ie];){e.selectLeft()}break;case"Ctrl-Shift-Home":for(;r[ie]||r.parent!==e.root;){e.selectLeft()}break;case"Left":e.moveLeft();break;case"Shift-Left":e.selectLeft();break;case"Ctrl-Left":break;case"Right":e.moveRight();break;case"Shift-Right":e.selectRight();break;case"Ctrl-Right":break;case"Up":e.moveUp();break;case"Down":e.moveDown();break;case"Shift-Up":if(r[ie])for(;r[ie];){e.selectLeft()}else e.selectLeft();case"Shift-Down":if(r[oe])for(;r[oe];){e.selectRight()}else e.selectRight();case"Ctrl-Up":case"Ctrl-Down":break;case"Ctrl-Shift-Del":case"Ctrl-Del":e.ctrlDeleteDir(oe);break;case"Shift-Del":case"Del":e.deleteForward();break;case"Meta-A":case"Ctrl-A":for(e.notify("move").cursor.insAtRightEnd(e.root);r[ie];){e.selectLeft()}break;default:return;}t.preventDefault(),e.scrollHoriz()},e.moveOutOf=e.moveTowards=e.deleteOutOf=e.deleteTowards=e.unselectInto=e.selectOutOf=e.selectTowards=function(){ne("overridden or never called on this node")}}),fe.open(function(s){function t(r,t){var a=r.notify("upDown").cursor,e=t+"Into",n=t+"OutOf";return a[oe][e]?a.insAtLeftEnd(a[oe][e]):a[ie][e]?a.insAtRightEnd(a[ie][e]):a.parent.bubble(function(s){var t=s[n];if(t&&("function"==typeof t&&(t=s[n](a)),t instanceof de&&a.jumpUpDown(s,t),!0!==t))return!1}),r}this.onNotify(function(e){"move"!==e&&"upDown"!==e||this.show().clearSelection()}),s.escapeDir=function(s,t,e){ae(s);var r=this.cursor;if(r.parent!==this.root&&e.preventDefault(),r.parent!==this.root)return r.parent.moveOutOf(s,r),this.notify("move")},qe.leftRightIntoCmdGoes=function(e){if(e&&"up"!==e&&"down"!==e)throw"\"up\" or \"down\" required for leftRightIntoCmdGoes option, got \""+e+"\"";return e},s.moveDir=function(s){ae(s);var t=this.cursor,e=t.options.leftRightIntoCmdGoes;return t.selection?t.insDirOf(s,t.selection.ends[s]):t[s]?t[s].moveTowards(s,t,e):t.parent.moveOutOf(s,t,e),this.notify("move")},s.moveLeft=function(){return this.moveDir(ie)},s.moveRight=function(){return this.moveDir(oe)},s.moveUp=function(){return t(this,"up")},s.moveDown=function(){return t(this,"down")},this.onNotify(function(e){"upDown"!==e&&(this.upDownCache={})}),this.onNotify(function(e){"edit"===e&&this.show().deleteSelection()}),s.deleteDir=function(s){var t,r;return ae(s),t=this.cursor,r=t.selection,this.notify("edit"),r||(t[s]?t[s].deleteTowards(s,t):t.parent.deleteOutOf(s,t)),t[ie].siblingDeleted&&t[ie].siblingDeleted(t.options,oe),t[oe].siblingDeleted&&t[oe].siblingDeleted(t.options,ie),t.parent.bubble("reflow"),this},s.ctrlDeleteDir=function(s){ae(s);var t=this.cursor;return!t[s]||t.selection?this.deleteDir(s):(this.notify("edit"),s===ie?ce(t.parent.ends[ie],t[ie]).remove():ce(t[oe],t.parent.ends[oe]).remove(),t.insAtDirEnd(s,t.parent),t[ie].siblingDeleted&&t[ie].siblingDeleted(t.options,oe),t[oe].siblingDeleted&&t[oe].siblingDeleted(t.options,ie),t.parent.bubble("reflow"),this)},s.backspace=function(){return this.deleteDir(ie)},s.deleteForward=function(){return this.deleteDir(oe)},this.onNotify(function(e){"select"!==e&&this.endSelection()}),s.selectDir=function(s){var t,r=this.notify("select").cursor,n=r.selection;ae(s),r.anticursor||r.startSelection(),t=r[s],t?n&&n.ends[s]===t&&r.anticursor[-s]!==t?t.unselectInto(s,r):t.selectTowards(s,r):r.parent.selectOutOf(s,r),r.clearSelection(),r.select()||r.show()},s.selectLeft=function(){return this.selectDir(ie)},s.selectRight=function(){return this.selectDir(oe)}}),ke=function(){function w(s){var t=Ee();return s.adopt(t,0,0),t}function t(s){var t,r=s[0]||Ee();for(t=1;t<s.length;t+=1){s[t].children().adopt(r,r.ends[oe],0)}return r}var e=Qe.string,n=Qe.regex,i=Qe.letter,s=Qe.any,r=Qe.optWhitespace,o=Qe.succeed,a=Qe.fail,l=i.map(function(e){return Fe(e)}),c=n(/^[^${}\\_^]/).map(function(e){return Se(e)}),u=n(/^[^\\a-eg-zA-Z]/).or(e("\\").then(n(/^[a-z]+/i).or(n(/^\s+/).result(" ")).or(s))).then(function(s){var t=f[s];return t?t(s).parser():a("unknown command: \\"+s)}),h=u.or(l).or(c),q=e("{").then(function(){return d}).skip(e("}")),p=r.then(q.or(h.map(w))),d=p.many().map(t).skip(r),m=e("[").then(p.then(function(e){return"]"!==e.join("latex")?o(e):a()}).many().map(t).skip(r)).skip(e("]")),g=d;return g.block=p,g.optBlock=m,g}(),fe.open(function(e){e.exportLatex=function(){return this.root.latex().replace(/(\\[a-z]+) (?![a-z])/gi,"$1")},e.writeLatex=function(a){var t,l=this.notify("edit").cursor,n=Qe.all,i=Qe.eof,s=ke.skip(i).or(n.result(!1)).parse(a);return s&&!s.isEmpty()&&(s.children().adopt(l.parent,l[ie],l[oe]),t=s.jQize(),t.insertBefore(l.jQ),l[ie]=s.ends[oe],s.finalizeInsert(l.options,l),s.ends[oe][oe].siblingCreated&&s.ends[oe][oe].siblingCreated(l.options,ie),s.ends[ie][ie].siblingCreated&&s.ends[ie][ie].siblingCreated(l.options,oe),l.parent.bubble("reflow")),this},e.renderLatexMath=function(l){var t,p,d=this.root,i=this.cursor,s=Qe.all,r=Qe.eof,o=ke.skip(r).or(s.result(!1)).parse(l);d.eachChild("postOrder","dispose"),d.ends[ie]=d.ends[oe]=0,o&&o.children().adopt(d,0,0),t=d.jQ,o?(p=o.join("html"),t.html(p),d.jQize(t.children()),d.finalizeInsert(i.options)):t.empty(),delete i.selection,i.insAtRightEnd(d)},e.renderLatexText=function(p){var t,d,m,w,g,q,b,x,y,O,v=this.root,h=this.cursor;if(v.jQ.children().slice(1).remove(),v.eachChild("postOrder","dispose"),v.ends[ie]=v.ends[oe]=0,delete h.selection,h.show().insAtRightEnd(v),t=Qe.regex,d=Qe.string,m=Qe.eof,w=Qe.all,g=d("$").then(ke).skip(d("$").or(m)).map(function(s){var t,r=Ie(h);return r.createBlocks(),t=r.ends[ie],s.children().adopt(t,0,0),r}),q=d("\\$").result("$"),b=q.or(t(/^[^$]/)).map(Se),x=g.or(b).many(),y=x.skip(m).or(w.result(!1)).parse(p)){for(O=0;O<y.length;O+=1){y[O].adopt(v,v.ends[oe],0)}v.jQize().appendTo(v.jQ),v.finalizeInsert(h.options)}}}),fe.open(function(t){ge.p.ignoreNextMousedown=ee,t.delegateMouseEvents=function(){var t=this.root.jQ;this.container.bind("mousedown.mathquill",function(e){function n(e){r=pe(e.target)}function i(e){c.anticursor||c.startSelection(),l.seek(r,e.pageX,e.pageY).cursor.select(),r=p}function s(e){c.blink=m,c.selection||(l.editable?c.show():u.detach()),d.unbind("mousemove",n),pe(e.target.ownerDocument).unbind("mousemove",i).unbind("mouseup",s)}var r,d=pe(e.target).closest(".mq-root-block"),a=de.byId[d.attr("mathquill-block-id")||t.attr("mathquill-block-id")],l=a.controller,c=l.cursor,m=c.blink,u=l.textareaSpan,h=l.textarea;e.preventDefault(),e.target.unselectable=!0,c.options.ignoreNextMousedown(e)||(c.options.ignoreNextMousedown=ee,l.blurred&&(l.editable||d.prepend(u),h.focus()),c.blink=ee,l.seek(pe(e.target),e.pageX,e.pageY).cursor.startSelection(),d.mousemove(n),pe(e.target.ownerDocument).mousemove(i).mouseup(s))})}}),fe.open(function(e){e.seek=function(s,t){var e,n,l,p=this.notify("select").cursor;return s&&((e=s.attr("mathquill-block-id")||s.attr("mathquill-command-id"))||(n=s.parent(),e=n.attr("mathquill-block-id")||n.attr("mathquill-command-id"))),l=e?de.byId[e]:this.root,ne("nodeId is the id of some Node that exists",l),p.clearSelection().show(),l.seek(t,p),this.scrollHoriz(),this}}),fe.open(function(e){e.scrollHoriz=function(){var l,p,d,c,m,u=this.cursor,r=u.selection,o=this.root.jQ[0].getBoundingClientRect();if(r){if(d=r.jQ[0].getBoundingClientRect(),c=d.left-(o.left+20),m=d.right-(o.right-20),r.ends[ie]===u[oe]){if(0>c)p=c;else{if(!(0<m))return;p=d.left-m<o.left+20?c:m}}else if(0<m)p=m;else{if(!(0>c))return;p=d.right-c>o.right-20?m:c}}else if((l=u.jQ[0].getBoundingClientRect().left)>o.right-20)p=l-(o.right-20);else{if(!(l<o.left+20))return;p=l-(o.left+20)}this.root.jQ.stop().animate({scrollLeft:"+="+p},100)}}),fe.open(function(e){ge.p.substituteTextarea=function(){return pe("<textarea autocapitalize=off autocomplete=off autocorrect=off spellcheck=false x-palm-disable-ste-all=true />")[0]},e.createTextarea=function(){var s,r=this.textareaSpan=pe("<span class=\"mq-textarea\"></span>"),e=this.options.substituteTextarea();if(!e.nodeType)throw"substituteTextarea() must return a DOM element, got "+e;e=this.textarea=pe(e).appendTo(r),s=this,s.cursor.selectionChanged=function(){s.selectionChanged()}},e.selectionChanged=function(){var e=this;Rt(e.container[0]),e.textareaSelectionTimeout===p&&(e.textareaSelectionTimeout=setTimeout(function(){e.setTextareaSelection()}))},e.setTextareaSelection=function(){this.textareaSelectionTimeout=p;var e="";this.cursor.selection&&(e=this.cursor.selection.join("latex"),this.options.statelessClipboard&&(e="$"+e+"$")),this.selectFn(e)},e.staticMathTextareaEvents=function(){function r(){a.detach(),t.blurred=!0}var t=this,e=(t.root,t.cursor),n=t.textarea,a=t.textareaSpan;this.container.prepend(ns("<span class=\"mq-selectable\">").text("$"+t.exportLatex()+"$")),t.blurred=!0,n.bind("cut paste",!1).bind("copy",function(){t.setTextareaSelection()}).focus(function(){t.blurred=!1}).blur(function(){e.selection&&e.selection.clear(),setTimeout(r)}),t.selectFn=function(e){n.val(e),e&&n.select()}},ge.p.substituteKeyboardEvents=je,e.editablesTextareaEvents=function(){var s=this,t=s.textarea,e=s.textareaSpan,r=this.options.substituteKeyboardEvents(t,this);this.selectFn=function(e){r.select(e)},this.container.prepend(e),this.focusBlurEvents()},e.typedText=function(s){if("\n"===s)return this.handle("enter");var t=this.notify().cursor;t.parent.write(t,s),this.scrollHoriz()},e.cut=function(){var s=this,t=s.cursor;t.selection&&setTimeout(function(){s.notify("edit"),t.parent.bubble("reflow")})},e.copy=function(){this.setTextareaSelection()},e.paste=function(e){this.options.statelessClipboard&&(e="$"===e.slice(0,1)&&"$"===e.slice(-1)?e.slice(1,-1):"\\text{"+e+"}"),this.writeLatex(e).cursor.show()}}),Te=u(de,function(e){e.finalizeInsert=function(s,t){var e=this;e.postOrder("finalizeTree",s),e.postOrder("contactWeld",t),e.postOrder("blur"),e.postOrder("reflow"),e[oe].siblingCreated&&e[oe].siblingCreated(s,ie),e[ie].siblingCreated&&e[ie].siblingCreated(s,oe),e.bubble("reflow")}}),Ce=u(Te,function(s,r){s.init=function(e,t,n){var a=this;r.init.call(a),a.ctrlSeq||(a.ctrlSeq=e),t&&(a.htmlTemplate=t),n&&(a.textTemplate=n)},s.replaces=function(e){e.disown(),this.replacedFragment=e},s.isEmpty=function(){return this.foldChildren(!0,function(s,t){return s&&t.isEmpty()})},s.parser=function(){var s=ke.block,r=this;return s.times(r.numBlocks()).map(function(e){r.blocks=e;for(var t=0;t<e.length;t+=1){e[t].adopt(r,r.ends[oe],0)}return r})},s.createLeftOf=function(e){var t=this,s=t.replacedFragment;t.createBlocks(),r.createLeftOf.call(t,e),s&&(s.adopt(t.ends[ie],0,0),s.jQ.appendTo(t.ends[ie].jQ)),t.finalizeInsert(e.options),t.placeCursor(e)},s.createBlocks=function(){var r,a,l=this,n=l.numBlocks(),i=l.blocks=Array(n);for(r=0;r<n;r+=1){a=i[r]=Ee(),a.adopt(l,l.ends[oe],0)}},s.placeCursor=function(e){e.insAtRightEnd(this.foldChildren(this.ends[ie],function(s,t){return s.isEmpty()?s:t}))},s.moveTowards=function(s,t,e){var r=e&&this[e+"Into"];t.insAtDirEnd(-s,r||this.ends[-s])},s.deleteTowards=function(s,t){this.isEmpty()?t[s]=this.remove()[s]:this.moveTowards(s,t,null)},s.selectTowards=function(s,t){t[-s]=this,t[s]=this[s]},s.selectChildren=function(){return he(this,this)},s.unselectInto=function(s,t){t.insAtDirEnd(-s,t.anticursor.ancestors[this.id])},s.seek=function(l,t){function e(s){var t={};return t[ie]=s.jQ.offset().left,t[oe]=t[ie]+s.jQ.outerWidth(),t}var n,p=this,s=e(p);return l<s[ie]?t.insLeftOf(p):l>s[oe]?t.insRightOf(p):(n=s[ie],void p.eachChild(function(r){var i=e(r);return l<i[ie]?(l-n<i[ie]-l?r[ie]?t.insAtRightEnd(r[ie]):t.insLeftOf(p):t.insAtLeftEnd(r),!1):l>i[oe]?void(r[oe]?n=i[oe]:s[oe]-l<l-i[oe]?t.insRightOf(p):t.insAtRightEnd(r)):(r.seek(l,t),!1)}))},s.numBlocks=function(){var e=this.htmlTemplate.match(/&\d+/g);return e?e.length:0},s.html=function(){var s,l,p,d=this,i=d.blocks,r=" mathquill-command-id="+d.id,o=d.htmlTemplate.match(/<[^<>]+>|[^<>]+/g);for(ne("no unmatched angle brackets",o.join("")===this.htmlTemplate),s=0,l=o[0];l;s+=1,l=o[s]){if("/>"===l.slice(-2))o[s]=l.slice(0,-2)+r+"/>";else if("<"===l.charAt(0)){ne("not an unmatched top-level close tag","/"!==l.charAt(1)),o[s]=l.slice(0,-1)+r+">",p=1;do{s+=1,l=o[s],ne("no missing close tags",l),"</"===l.slice(0,2)?p-=1:"<"===l.charAt(0)&&"/>"!==l.slice(-2)&&(p+=1)}while(0<p)}}return o.join("").replace(/>&(\d+)/g,function(s,t){return" mathquill-block-id="+i[t].id+">"+i[t].join("html")})},s.latex=function(){return this.foldChildren(this.ctrlSeq,function(s,t){return s+"{"+(t.latex()||" ")+"}"})},s.textTemplate=[""],s.text=function(){var r=this,t=0;return r.foldChildren(r.textTemplate[t],function(e,n){t+=1;var a=n.text();return e&&"("===r.textTemplate[t]&&"("===a[0]&&")"===a.slice(-1)?e+a.slice(1,-1)+r.textTemplate[t]:e+n.text()+(r.textTemplate[t]||"")})}}),_e=u(Ce,function(t,s){t.init=function(r,t,e){e||(e=r&&1<r.length?r.slice(1):r),s.init.call(this,r,t,[e])},t.parser=function(){return Qe.succeed(this)},t.numBlocks=function(){return 0},t.replaces=function(e){e.remove()},t.createBlocks=ee,t.moveTowards=function(s,t){t.jQ.insDirOf(s,this.jQ),t[-s]=this,t[s]=this[s]},t.deleteTowards=function(s,t){t[s]=this.remove()[s]},t.seek=function(s,t){s-this.jQ.offset().left<this.jQ.outerWidth()/2?t.insLeftOf(this):t.insRightOf(this)},t.latex=function(){return this.ctrlSeq},t.text=function(){return this.textTemplate},t.placeCursor=ee,t.isEmpty=function(){return!0}}),Se=u(_e,function(s,r){s.init=function(e,t){r.init.call(this,e,"<span>"+(t||e)+"</span>")}}),De=u(_e,function(s,r){s.init=function(e,t,s){r.init.call(this,e,"<span class=\"mq-binary-operator\">"+t+"</span>",s)}}),Ee=u(Te,function(s,r){s.join=function(s){return this.foldChildren("",function(t,e){return t+e[s]()})},s.html=function(){return this.join("html")},s.latex=function(){return this.join("latex")},s.text=function(){return this.ends[ie]===this.ends[oe]&&0!==this.ends[ie]?this.ends[ie].text():this.join("text")},s.keystroke=function(e,t,s){return!s.options.spaceBehavesLikeTab||"Spacebar"!==e&&"Shift-Spacebar"!==e?r.keystroke.apply(this,arguments):(t.preventDefault(),void s.escapeDir("Shift-Spacebar"===e?ie:oe,e,t))},s.moveOutOf=function(s,t,e){e&&this.parent[e+"Into"]||!this[s]?t.insDirOf(s,this.parent):t.insAtDirEnd(-s,this[s])},s.selectOutOf=function(s,t){t.insDirOf(s,this.parent)},s.deleteOutOf=function(s,t){t.unwrapGramp()},s.seek=function(s,t){var e=this.ends[oe];if(!e||e.jQ.offset().left+e.jQ.outerWidth()<s)return t.insAtRightEnd(this);if(s<this.ends[ie].jQ.offset().left)return t.insAtLeftEnd(this);for(;s<e.jQ.offset().left;){e=e[ie]}return e.seek(s,t)},s.chToCmd=function(s,t){var e;return s.match(/^[a-eg-zA-Z]$/)?Fe(s):/^\d$/.test(s)?Me(s):t&&t.typingSlashWritesDivisionSymbol&&"/"===s?f["\xF7"](s):t&&t.typingAsteriskWritesTimesSymbol&&"*"===s?f["\xD7"](s):(e=me[s]||f[s])?e(s):Se(s)},s.write=function(s,t){var e=this.chToCmd(t,s.options);s.selection&&e.replaces(s.replaceSelection()),e.createLeftOf(s.show())},s.focus=function(){return this.jQ.addClass("mq-hasCursor"),this.jQ.removeClass("mq-empty"),this},s.blur=function(){return this.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.jQ.addClass("mq-empty"),this}}),we.StaticMath=function(s){return u(s.AbstractMathQuill,function(t,r){this.RootBlock=Ee,t.__mathquillify=function(e){return this.config(e),r.__mathquillify.call(this,"mq-math-mode"),this.__controller.delegateMouseEvents(),this.__controller.staticMathTextareaEvents(),this},t.init=function(){r.init.apply(this,arguments),this.__controller.root.postOrder("registerInnerField",this.innerFields=[],s.MathField)},t.latex=function(){var t=r.latex.apply(this,arguments);return 0<arguments.length&&this.__controller.root.postOrder("registerInnerField",this.innerFields=[],s.MathField),t}})},Le=u(Ee,l),we.MathField=function(t){return u(t.EditableField,function(t,s){this.RootBlock=Le,t.__mathquillify=function(t,e){return this.config(t),1<e&&(this.__controller.root.reflow=ee),s.__mathquillify.call(this,"mq-editable-field mq-math-mode"),delete this.__controller.root.reflow,this}})},Ae=u(de,function(s,r){function p(s){var t,r;if(s.jQ[0].normalize(),t=s.jQ[0].firstChild)return ne("only node in TextBlock span is Text node",3===t.nodeType),r=Re(t.data),r.jQadd(t),s.children().disown(),r.adopt(s,0,0)}s.ctrlSeq="\\text",s.replaces=function(e){e instanceof ce?this.replacedText=e.remove().jQ.text():"string"==typeof e&&(this.replacedText=e)},s.jQadd=function(e){r.jQadd.call(this,e),this.ends[ie]&&this.ends[ie].jQadd(this.jQ[0].firstChild)},s.createLeftOf=function(e){var t,s=this;if(r.createLeftOf.call(this,e),s[oe].siblingCreated&&s[oe].siblingCreated(e.options,ie),s[ie].siblingCreated&&s[ie].siblingCreated(e.options,oe),s.bubble("reflow"),e.insAtRightEnd(s),s.replacedText)for(t=0;t<s.replacedText.length;t+=1){s.write(e,s.replacedText.charAt(t))}},s.parser=function(){var s=this,t=Qe.string,e=Qe.regex;return Qe.optWhitespace.then(t("{")).then(e(/^[^}]*/)).skip(t("}")).map(function(t){return 0===t.length?ce():(Re(t).adopt(s,0,0),s)})},s.textContents=function(){return this.foldChildren("",function(s,t){return s+t.text})},s.text=function(){return"\""+this.textContents()+"\""},s.latex=function(){var e=this.textContents();return 0===e.length?"":"\\text{"+e.replace(/\\/g,"\\backslash ").replace(/[{}]/g,"\\$&")+"}"},s.html=function(){return"<span class=\"mq-text-mode\" mathquill-command-id="+this.id+">"+this.textContents()+"</span>"},s.moveTowards=function(s,t){t.insAtDirEnd(-s,this)},s.moveOutOf=function(s,t){t.insDirOf(s,this)},s.unselectInto=s.moveTowards,s.selectTowards=Ce.prototype.selectTowards,s.deleteTowards=Ce.prototype.deleteTowards,s.selectOutOf=function(s,t){t.insDirOf(s,this)},s.deleteOutOf=function(s,t){this.isEmpty()&&t.insRightOf(this)},s.write=function(e,t){var n,a;e.show().deleteSelection(),"$"!==t?e[ie]?e[ie].appendText(t):Re(t).createLeftOf(e):this.isEmpty()?(e.insRightOf(this),Se("\\$","$").createLeftOf(e)):e[oe]?e[ie]?(n=Ae(),a=this.ends[ie],a.disown().jQ.detach(),a.adopt(n,0,0),e.insLeftOf(this),r.createLeftOf.call(n,e)):e.insLeftOf(this):e.insRightOf(this)},s.seek=function(n,t){var e,d,m,f,w,g,q,b;for(t.hide(),e=p(this),d=this.jQ.width()/this.text.length,m=Math.round((n-this.jQ.offset().left)/d),0>=m?t.insAtLeftEnd(this):m>=e.text.length?t.insAtRightEnd(this):t.insLeftOf(e.splitRight(m)),f=n-t.show().offset().left,w=f&&0>f?ie:oe,g=w;t[w]&&0<f*g;){t[w].moveTowards(w,t),g=f,f=n-t.offset().left}w*f<-w*g&&t[-w].moveTowards(-w,t),t.anticursor?t.anticursor.parent===this&&(q=t[ie]&&t[ie].text.length,this.anticursorPosition===q?t.anticursor=h.copy(t):(this.anticursorPosition<q?(b=t[ie].splitRight(this.anticursorPosition),t[ie]=b):b=t[oe].splitRight(this.anticursorPosition-q),t.anticursor=h(this,b[ie],b))):this.anticursorPosition=t[ie]&&t[ie].text.length},s.blur=function(e){Ee.prototype.blur.call(this),e&&(""===this.textContents()?(this.remove(),e[ie]===this?e[ie]=this[ie]:e[oe]===this&&(e[oe]=this[oe])):p(this))},s.focus=Ee.prototype.focus}),Re=u(de,function(s,r){function l(s,t){return t.charAt(s===ie?0:-1+t.length)}s.init=function(e){r.init.call(this),this.text=e},s.jQadd=function(e){this.dom=e,this.jQ=pe(e)},s.jQize=function(){return this.jQadd(document.createTextNode(this.text))},s.appendText=function(e){this.text+=e,this.dom.appendData(e)},s.prependText=function(e){this.text=e+this.text,this.dom.insertData(0,e)},s.insTextAtDirEnd=function(s,t){ae(t),t===oe?this.appendText(s):this.prependText(s)},s.splitRight=function(s){var t=Re(this.text.slice(s)).adopt(this.parent,this,this[oe]);return t.jQadd(this.dom.splitText(s)),this.text=this.text.slice(0,s),t},s.moveTowards=function(r,t){var e,n;return ae(r),e=l(-r,this.text),n=this[-r],n?n.insTextAtDirEnd(e,r):Re(e).createDir(-r,t),this.deleteTowards(r,t)},s.latex=function(){return this.text},s.deleteTowards=function(s,t){1<this.text.length?s===oe?(this.dom.deleteData(0,1),this.text=this.text.slice(1)):(this.dom.deleteData(-1+this.text.length,1),this.text=this.text.slice(0,-1)):(this.remove(),this.jQ.remove(),t[s]=this[s])},s.selectTowards=function(r,t){var e,n,p,d;return ae(r),e=t.anticursor,n=l(-r,this.text),e[r]===this?(p=Re(n).createDir(r,t),e[r]=p,t.insDirOf(r,p)):(d=this[-r],d?d.insTextAtDirEnd(n,r):(p=Re(n).createDir(-r,t),p.jQ.insDirOf(-r,t.selection.jQ)),1===this.text.length&&e[-r]===this&&(e[-r]=this[-r])),this.deleteTowards(r,t)}}),f.text=f.textnormal=f.textrm=f.textup=f.textmd=Ae,f.em=f.italic=f.italics=f.emph=f.textit=f.textsl=t("\\textit","i","class=\"mq-text-mode\""),f.strong=f.bold=f.textbf=t("\\textbf","b","class=\"mq-text-mode\""),f.sf=f.textsf=t("\\textsf","span","class=\"mq-sans-serif mq-text-mode\""),f.tt=f.texttt=t("\\texttt","span","class=\"mq-monospace mq-text-mode\""),f.textsc=t("\\textsc","span","style=\"font-variant:small-caps\" class=\"mq-text-mode\""),f.uppercase=t("\\uppercase","span","style=\"text-transform:uppercase\" class=\"mq-text-mode\""),f.lowercase=t("\\lowercase","span","style=\"text-transform:lowercase\" class=\"mq-text-mode\""),Ie=u(Ce,function(s,r){s.init=function(e){r.init.call(this,"$"),this.cursor=e},s.htmlTemplate="<span class=\"mq-math-mode\">&0</span>",s.createBlocks=function(){r.createBlocks.call(this),this.ends[ie].cursor=this.cursor,this.ends[ie].write=function(s,t){"$"!==t?Ee.prototype.write.call(this,s,t):this.isEmpty()?(s.insRightOf(this.parent),this.parent.deleteTowards(dir,s),Se("\\$","$").createLeftOf(s.show())):s[oe]?s[ie]?Ee.prototype.write.call(this,s,t):s.insLeftOf(this.parent):s.insRightOf(this.parent)}},s.latex=function(){return"$"+this.ends[ie].latex()+"$"}}),Be=u(Le,function(s,r){s.keystroke=function(e){if("Spacebar"!==e&&"Shift-Spacebar"!==e)return r.keystroke.apply(this,arguments)},s.write=function(s,t){if(s.show().deleteSelection(),"$"===t)Ie(s).createLeftOf(s);else{var e;"<"===t?e="&lt;":">"==t&&(e="&gt;"),Se(t,e).createLeftOf(s)}}}),we.TextField=function(e){return u(e.EditableField,function(s,t){this.RootBlock=Be,s.__mathquillify=function(){return t.__mathquillify.call(this,"mq-editable-field mq-text-mode")},s.latex=function(e){return 0<arguments.length?(this.__controller.renderLatexText(e),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()}})},me["\\"]=u(Ce,function(s,r){s.ctrlSeq="\\",s.replaces=function(e){this._replacedFragment=e.disown(),this.isEmpty=function(){return!1}},s.htmlTemplate="<span class=\"mq-latex-command-input mq-non-leaf\">\\<span>&0</span></span>",s.textTemplate=["\\"],s.createBlocks=function(){r.createBlocks.call(this),this.ends[ie].focus=function(){return this.parent.jQ.addClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.removeClass("mq-empty"),this},this.ends[ie].blur=function(){return this.parent.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.addClass("mq-empty"),this},this.ends[ie].write=function(s,t){s.show().deleteSelection(),t.match(/[a-z]/i)?Se(t).createLeftOf(s):(this.parent.renderCommand(s),"\\"===t&&this.isEmpty()||s.parent.write(s,t))},this.ends[ie].keystroke=function(e,t,s){return"Tab"===e||"Enter"===e||"Spacebar"===e?(this.parent.renderCommand(s.cursor),void t.preventDefault()):r.keystroke.apply(this,arguments)}},s.createLeftOf=function(e){if(r.createLeftOf.call(this,e),this._replacedFragment){var s=this.jQ[0];this.jQ=this._replacedFragment.jQ.addClass("mq-blur").bind("mousedown mousemove",function(e){return pe(e.target=s).trigger(e),!1}).insertBefore(this.jQ).add(this.jQ)}},s.latex=function(){return"\\"+this.ends[ie].latex()+" "},s.renderCommand=function(s){var t,r;this.jQ=this.jQ.last(),this.remove(),this[oe]?s.insLeftOf(this[oe]):s.insAtRightEnd(this.parent),t=this.ends[ie].latex(),t||(t=" "),r=f[t],r?(r=r(t),this._replacedFragment&&r.replaces(this._replacedFragment),r.createLeftOf(s)):(r=Ae(),r.replaces(t),r.createLeftOf(s),s.insRightOf(r),this._replacedFragment&&this._replacedFragment.remove())}}),f.notin=f.cong=f.equiv=f.oplus=f.otimes=u(De,function(s,r){s.init=function(e){r.init.call(this,"\\"+e+" ","&"+e+";")}}),f["\u2260"]=f.ne=f.neq=re(De,"\\ne ","&ne;"),f["\u2217"]=f.ast=f.star=f.loast=f.lowast=re(De,"\\ast ","&lowast;"),f.therefor=f.therefore=re(De,"\\therefore ","&there4;"),f.cuz=f.because=re(De,"\\because ","&#8757;"),f.prop=f.propto=re(De,"\\propto ","&prop;"),f["\u2248"]=f.asymp=f.approx=re(De,"\\approx ","&asymp;"),f.isin=f.in=re(De,"\\in ","&isin;"),f.ni=f.contains=re(De,"\\ni ","&ni;"),f.notni=f.niton=f.notcontains=f.doesnotcontain=re(De,"\\not\\ni ","&#8716;"),f.sub=f.subset=re(De,"\\subset ","&sub;"),f.sup=f.supset=f.superset=re(De,"\\supset ","&sup;"),f.nsub=f.notsub=f.nsubset=f.notsubset=re(De,"\\not\\subset ","&#8836;"),f.nsup=f.notsup=f.nsupset=f.notsupset=f.nsuperset=f.notsuperset=re(De,"\\not\\supset ","&#8837;"),f.sube=f.subeq=f.subsete=f.subseteq=re(De,"\\subseteq ","&sube;"),f.supe=f.supeq=f.supsete=f.supseteq=f.supersete=f.superseteq=re(De,"\\supseteq ","&supe;"),f.nsube=f.nsubeq=f.notsube=f.notsubeq=f.nsubsete=f.nsubseteq=f.notsubsete=f.notsubseteq=re(De,"\\not\\subseteq ","&#8840;"),f.nsupe=f.nsupeq=f.notsupe=f.notsupeq=f.nsupsete=f.nsupseteq=f.notsupsete=f.notsupseteq=f.nsupersete=f.nsuperseteq=f.notsupersete=f.notsuperseteq=re(De,"\\not\\supseteq ","&#8841;"),f.N=f.naturals=f.Naturals=re(Se,"\\mathbb{N}","&#8469;"),f.P=f.primes=f.Primes=f.projective=f.Projective=f.probability=f.Probability=re(Se,"\\mathbb{P}","&#8473;"),f.Z=f.integers=f.Integers=re(Se,"\\mathbb{Z}","&#8484;"),f.Q=f.rationals=f.Rationals=re(Se,"\\mathbb{Q}","&#8474;"),f.R=f.reals=f.Reals=re(Se,"\\mathbb{R}","&#8477;"),f.C=f.complex=f.Complex=f.complexes=f.Complexes=f.complexplane=f.Complexplane=f.ComplexPlane=re(Se,"\\mathbb{C}","&#8450;"),f.H=f.Hamiltonian=f.quaternions=f.Quaternions=re(Se,"\\mathbb{H}","&#8461;"),f.quad=f.emsp=re(Se,"\\quad ","    "),f.qquad=re(Se,"\\qquad ","        "),f.diamond=re(Se,"\\diamond ","&#9671;"),f.bigtriangleup=re(Se,"\\bigtriangleup ","&#9651;"),f.ominus=re(Se,"\\ominus ","&#8854;"),f.uplus=re(Se,"\\uplus ","&#8846;"),f.bigtriangledown=re(Se,"\\bigtriangledown ","&#9661;"),f.sqcap=re(Se,"\\sqcap ","&#8851;"),f.triangleleft=re(Se,"\\triangleleft ","&#8882;"),f.sqcup=re(Se,"\\sqcup ","&#8852;"),f.triangleright=re(Se,"\\triangleright ","&#8883;"),f.odot=f.circledot=re(Se,"\\odot ","&#8857;"),f.bigcirc=re(Se,"\\bigcirc ","&#9711;"),f.dagger=re(Se,"\\dagger ","&#0134;"),f.ddagger=re(Se,"\\ddagger ","&#135;"),f.wr=re(Se,"\\wr ","&#8768;"),f.amalg=re(Se,"\\amalg ","&#8720;"),f.models=re(Se,"\\models ","&#8872;"),f.prec=re(Se,"\\prec ","&#8826;"),f.succ=re(Se,"\\succ ","&#8827;"),f.preceq=re(Se,"\\preceq ","&#8828;"),f.succeq=re(Se,"\\succeq ","&#8829;"),f.simeq=re(Se,"\\simeq ","&#8771;"),f.mid=re(Se,"\\mid ","&#8739;"),f.ll=re(Se,"\\ll ","&#8810;"),f.gg=re(Se,"\\gg ","&#8811;"),f.parallel=re(Se,"\\parallel ","&#8741;"),f.nparallel=re(Se,"\\nparallel ","&#8742;"),f.bowtie=re(Se,"\\bowtie ","&#8904;"),f.sqsubset=re(Se,"\\sqsubset ","&#8847;"),f.sqsupset=re(Se,"\\sqsupset ","&#8848;"),f.smile=re(Se,"\\smile ","&#8995;"),f.sqsubseteq=re(Se,"\\sqsubseteq ","&#8849;"),f.sqsupseteq=re(Se,"\\sqsupseteq ","&#8850;"),f.doteq=re(Se,"\\doteq ","&#8784;"),f.frown=re(Se,"\\frown ","&#8994;"),f.vdash=re(Se,"\\vdash ","&#8870;"),f.dashv=re(Se,"\\dashv ","&#8867;"),f.nless=re(Se,"\\nless ","&#8814;"),f.ngtr=re(Se,"\\ngtr ","&#8815;"),f.longleftarrow=re(Se,"\\longleftarrow ","&#8592;"),f.longrightarrow=re(Se,"\\longrightarrow ","&#8594;"),f.Longleftarrow=re(Se,"\\Longleftarrow ","&#8656;"),f.Longrightarrow=re(Se,"\\Longrightarrow ","&#8658;"),f.longleftrightarrow=re(Se,"\\longleftrightarrow ","&#8596;"),f.updownarrow=re(Se,"\\updownarrow ","&#8597;"),f.Longleftrightarrow=re(Se,"\\Longleftrightarrow ","&#8660;"),f.Updownarrow=re(Se,"\\Updownarrow ","&#8661;"),f.mapsto=re(Se,"\\mapsto ","&#8614;"),f.nearrow=re(Se,"\\nearrow ","&#8599;"),f.hookleftarrow=re(Se,"\\hookleftarrow ","&#8617;"),f.hookrightarrow=re(Se,"\\hookrightarrow ","&#8618;"),f.searrow=re(Se,"\\searrow ","&#8600;"),f.leftharpoonup=re(Se,"\\leftharpoonup ","&#8636;"),f.rightharpoonup=re(Se,"\\rightharpoonup ","&#8640;"),f.swarrow=re(Se,"\\swarrow ","&#8601;"),f.leftharpoondown=re(Se,"\\leftharpoondown ","&#8637;"),f.rightharpoondown=re(Se,"\\rightharpoondown ","&#8641;"),f.nwarrow=re(Se,"\\nwarrow ","&#8598;"),f.ldots=re(Se,"\\ldots ","&#8230;"),f.cdots=re(Se,"\\cdots ","&#8943;"),f.vdots=re(Se,"\\vdots ","&#8942;"),f.ddots=re(Se,"\\ddots ","&#8945;"),f.surd=re(Se,"\\surd ","&#8730;"),f.triangle=re(Se,"\\triangle ","&#9651;"),f.ell=re(Se,"\\ell ","&#8467;"),f.top=re(Se,"\\top ","&#8868;"),f.flat=re(Se,"\\flat ","&#9837;"),f.natural=re(Se,"\\natural ","&#9838;"),f.sharp=re(Se,"\\sharp ","&#9839;"),f.wp=re(Se,"\\wp ","&#8472;"),f.bot=re(Se,"\\bot ","&#8869;"),f.clubsuit=re(Se,"\\clubsuit ","&#9827;"),f.diamondsuit=re(Se,"\\diamondsuit ","&#9826;"),f.heartsuit=re(Se,"\\heartsuit ","&#9825;"),f.spadesuit=re(Se,"\\spadesuit ","&#9824;"),f.parallelogram=re(Se,"\\parallelogram ","&#9649;"),f.square=re(Se,"\\square ","&#11036;"),f.oint=re(Se,"\\oint ","&#8750;"),f.bigcap=re(Se,"\\bigcap ","&#8745;"),f.bigcup=re(Se,"\\bigcup ","&#8746;"),f.bigsqcup=re(Se,"\\bigsqcup ","&#8852;"),f.bigvee=re(Se,"\\bigvee ","&#8744;"),f.bigwedge=re(Se,"\\bigwedge ","&#8743;"),f.bigodot=re(Se,"\\bigodot ","&#8857;"),f.bigotimes=re(Se,"\\bigotimes ","&#8855;"),f.bigoplus=re(Se,"\\bigoplus ","&#8853;"),f.biguplus=re(Se,"\\biguplus ","&#8846;"),f.lfloor=re(Se,"\\lfloor ","&#8970;"),f.rfloor=re(Se,"\\rfloor ","&#8971;"),f.lceil=re(Se,"\\lceil ","&#8968;"),f.rceil=re(Se,"\\rceil ","&#8969;"),f.opencurlybrace=f.lbrace=re(Se,"\\lbrace ","{"),f.closecurlybrace=f.rbrace=re(Se,"\\rbrace ","}"),f.lbrack=re(Se,"["),f.rbrack=re(Se,"]"),f.slash=re(Se,"/"),f.vert=re(Se,"|"),f.perp=f.perpendicular=re(Se,"\\perp ","&perp;"),f.nabla=f.del=re(Se,"\\nabla ","&nabla;"),f.hbar=re(Se,"\\hbar ","&#8463;"),f.AA=f.Angstrom=f.angstrom=re(Se,"\\text\\AA ","&#8491;"),f.ring=f.circ=f.circle=re(Se,"\\circ ","&#8728;"),f.bull=f.bullet=re(Se,"\\bullet ","&bull;"),f.setminus=f.smallsetminus=re(Se,"\\setminus ","&#8726;"),f.not=f["\xAC"]=f.neg=re(Se,"\\neg ","&not;"),f["\u2026"]=f.dots=f.ellip=f.hellip=f.ellipsis=f.hellipsis=re(Se,"\\dots ","&hellip;"),f.converges=f.darr=f.dnarr=f.dnarrow=f.downarrow=re(Se,"\\downarrow ","&darr;"),f.dArr=f.dnArr=f.dnArrow=f.Downarrow=re(Se,"\\Downarrow ","&dArr;"),f.diverges=f.uarr=f.uparrow=re(Se,"\\uparrow ","&uarr;"),f.uArr=f.Uparrow=re(Se,"\\Uparrow ","&uArr;"),f.to=re(De,"\\to ","&rarr;"),f.rarr=f.rightarrow=re(Se,"\\rightarrow ","&rarr;"),f.implies=re(De,"\\Rightarrow ","&rArr;"),f.rArr=f.Rightarrow=re(Se,"\\Rightarrow ","&rArr;"),f.gets=re(De,"\\gets ","&larr;"),f.larr=f.leftarrow=re(Se,"\\leftarrow ","&larr;"),f.impliedby=re(De,"\\Leftarrow ","&lArr;"),f.lArr=f.Leftarrow=re(Se,"\\Leftarrow ","&lArr;"),f.harr=f.lrarr=f.leftrightarrow=re(Se,"\\leftrightarrow ","&harr;"),f.iff=re(De,"\\Leftrightarrow ","&hArr;"),f.hArr=f.lrArr=f.Leftrightarrow=re(Se,"\\Leftrightarrow ","&hArr;"),f.Re=f.Real=f.real=re(Se,"\\Re ","&real;"),f.Im=f.imag=f.image=f.imagin=f.imaginary=f.Imaginary=re(Se,"\\Im ","&image;"),f.part=f.partial=re(Se,"\\partial ","&part;"),f.infty=f.infin=f.infinity=re(Se,"\\infty ","&infin;"),f.alef=f.alefsym=f.aleph=f.alephsym=re(Se,"\\aleph ","&alefsym;"),f.xist=f.xists=f.exist=f.exists=re(Se,"\\exists ","&exist;"),f.nexists=f.nexist=re(Se,"\\nexists ","&#8708;"),f.and=f.land=f.wedge=re(De,"\\wedge ","&and;"),f.or=f.lor=f.vee=re(De,"\\vee ","&or;"),f.o=f.O=f.empty=f.emptyset=f.oslash=f.Oslash=f.nothing=f.varnothing=re(De,"\\varnothing ","&empty;"),f.cup=f.union=re(De,"\\cup ","&cup;"),f.cap=f.intersect=f.intersection=re(De,"\\cap ","&cap;"),f.deg=f.degree=re(Se,"\\degree ","&deg;"),f.ang=f.angle=re(Se,"\\angle ","&ang;"),f.measuredangle=re(Se,"\\measuredangle ","&#8737;"),Me=u(Se,function(s,r){s.createLeftOf=function(e){e.options.autoSubscriptNumerals&&e.parent!==e.parent.parent.sub&&(e[ie]instanceof ze&&!1!==e[ie].isItalic||e[ie]instanceof Wt&&e[ie][ie]instanceof ze&&!1!==e[ie][ie].isItalic)?(f._().createLeftOf(e),r.createLeftOf.call(this,e),e.insRightOf(e.parent.parent)):r.createLeftOf.call(this,e)}}),ze=u(_e,function(s,r){s.init=function(e,t){r.init.call(this,e,"<var>"+(t||e)+"</var>")},s.text=function(){var e=this.ctrlSeq;return this.isPartOfOperator?"\\"==e[0]?e=e.slice(1,e.length):" "==e[e.length-1]&&(e=e.slice(0,-1)):(!this[ie]||this[ie]instanceof ze||this[ie]instanceof De||"\\ "===this[ie].ctrlSeq||(e="*"+e),!this[oe]||this[oe]instanceof De||this[oe]instanceof Wt||(e+="*")),e}}),ge.p.autoCommands={_maxLength:0},qe.autoCommands=function(a){var t,l,o,p,d;if(!/^[a-z]+(?: [a-z]+)*$/i.test(a))throw"\""+a+"\" not a space-delimited list of only letters";for(t=a.split(" "),l={},o=0,p=0;p<t.length;p+=1){if(d=t[p],2>d.length)throw"autocommand \""+d+"\" not minimum length of 2";if(f[d]===Ue)throw"\""+d+"\" is a built-in operator name";l[d]=1,o=zt(o,d.length)}return l._maxLength=o,l},Fe=u(ze,function(s,a){function e(e){return!e||e instanceof De||e instanceof Ht}s.init=function(e){return a.init.call(this,this.letter=e)},s.createLeftOf=function(e){var t,l,p,d,c;if(a.createLeftOf.apply(this,arguments),t=e.options.autoCommands,l=t._maxLength,0<l){for(p="",d=this,c=0;d instanceof Fe&&d.ctrlSeq===d.letter&&c<l;){p=d.letter+p,d=d[ie],c+=1}for(;p.length;){if(t.hasOwnProperty(p)){for(c=1,d=this;c<p.length;c+=1,d=d[ie]){}return ce(d,this).remove(),e[ie]=d[ie],f[p](p).createLeftOf(e)}p=p.slice(1)}}},s.italicize=function(e){return this.isItalic=e,this.isPartOfOperator=!e,this.jQ.toggleClass("mq-operator-name",!e),this},s.finalizeTree=s.siblingDeleted=s.siblingCreated=function(s,t){t!==ie&&this[oe]instanceof Fe||this.autoUnItalicize(s)},s.autoUnItalicize=function(n){var t,m,w,g,q,b,x,y,O,v,Q,j,k=n.autoOperatorNames;if(0!==k._maxLength){for(t=this.letter,m=this[ie];m instanceof Fe;m=m[ie]){t=m.letter+t}for(w=this[oe];w instanceof Fe;w=w[oe]){t+=w.letter}ce(m[oe]||this.parent.ends[ie],w[ie]||this.parent.ends[oe]).each(function(e){e.italicize(!0).jQ.removeClass("mq-first mq-last mq-followed-by-supsub"),e.ctrlSeq=e.letter});t:for(g=0,q=m[oe]||this.parent.ends[ie];g<t.length;g+=1,q=q[oe]){for(b=It(k._maxLength,t.length-g);0<b;b-=1){if(x=t.slice(g,g+b),k.hasOwnProperty(x)){for(y=0,O=q;y<b;y+=1,O=O[oe]){O.italicize(!1),v=O}Q=Ne.hasOwnProperty(x),q.ctrlSeq=(Q?"\\":"\\operatorname{")+q.ctrlSeq,v.ctrlSeq+=Q?" ":"}",$e.hasOwnProperty(x)&&v[ie][ie][ie].jQ.addClass("mq-last"),e(q[ie])||q.jQ.addClass("mq-first"),e(v[oe])||(v[oe]instanceof Wt?(j=v[oe],(j.siblingCreated=j.siblingDeleted=function(){j.jQ.toggleClass("mq-after-operator-name",!(j[oe]instanceof Zt))})()):v.jQ.toggleClass("mq-last",!(v[oe]instanceof Zt))),g+=b-1,q=v;continue t}}}}}}),Ne={},Pe=ge.p.autoOperatorNames={_maxLength:9},$e={limsup:1,liminf:1,projlim:1,injlim:1},function(){var r,a,l,o,p=["arg","deg","det","dim","exp","gcd","hom","inf","ker","lg","lim","ln","log","max","min","sup","limsup","liminf","injlim","projlim","Pr"];for(r=0;r<p.length;r+=1){Ne[p[r]]=Pe[p[r]]=1}for(a=["sin","cos","tan","arcsin","arccos","arctan","sinh","cosh","tanh","sec","csc","cot","coth"],r=0;r<a.length;r+=1){Ne[a[r]]=1}for(l=["sin","cos","tan","sec","cosec","csc","cotan","cot","ctg"],r=0;r<l.length;r+=1){Pe[l[r]]=Pe["arc"+l[r]]=Pe[l[r]+"h"]=Pe["ar"+l[r]+"h"]=Pe["arc"+l[r]+"h"]=1}for(o=["gcf","hcf","lcm","proj","span"],r=0;r<o.length;r+=1){Pe[o[r]]=1}}(),qe.autoOperatorNames=function(a){var t,l,o,p,d;if(!/^[a-z]+(?: [a-z]+)*$/i.test(a))throw"\""+a+"\" not a space-delimited list of only letters";for(t=a.split(" "),l={},o=0,p=0;p<t.length;p+=1){if(d=t[p],2>d.length)throw"\""+d+"\" not minimum length of 2";l[d]=1,o=zt(o,d.length)}return l._maxLength=o,l},Ue=u(_e,function(e){e.init=function(e){this.ctrlSeq=e},e.createLeftOf=function(s){var t,r=this.ctrlSeq;for(t=0;t<r.length;t+=1){Fe(r.charAt(t)).createLeftOf(s)}},e.parser=function(){var s,r=this.ctrlSeq,e=Ee();for(s=0;s<r.length;s+=1){Fe(r.charAt(s)).adopt(e,e.ends[oe],0)}return Qe.succeed(e.children())}});for(We in Pe){Pe.hasOwnProperty(We)&&(f[We]=Ue)}f.operatorname=u(Ce,function(t){t.createLeftOf=ee,t.numBlocks=function(){return 1},t.parser=function(){return ke.block.map(function(e){return e.children()})}}),f.f=u(Fe,function(s,r){s.init=function(){_e.p.init.call(this,this.letter="f","<var class=\"mq-f\">f</var>")},s.italicize=function(e){return this.jQ.html("f").toggleClass("mq-f",e),r.italicize.apply(this,arguments)}}),f[" "]=f.space=re(Se,"\\ ","&nbsp;"),f["'"]=f.prime=re(Se,"'","&prime;"),f["\u2033"]=f.dprime=re(Se,"\u2033","&Prime;"),f.backslash=re(Se,"\\backslash ","\\"),me["\\"]||(me["\\"]=f.backslash),f.$=re(Se,"\\$","$"),He=u(_e,function(s,r){s.init=function(e,t){r.init.call(this,e,"<span class=\"mq-nonSymbola\">"+(t||e)+"</span>")}}),f["@"]=He,f["&"]=re(He,"\\&","&amp;"),f["%"]=re(He,"\\%","%"),f.alpha=f.beta=f.gamma=f.delta=f.zeta=f.eta=f.theta=f.iota=f.kappa=f.mu=f.nu=f.xi=f.rho=f.sigma=f.tau=f.chi=f.psi=f.omega=u(ze,function(s,r){s.init=function(e){r.init.call(this,"\\"+e+" ","&"+e+";")}}),f.phi=re(ze,"\\phi ","&#981;"),f.phiv=f.varphi=re(ze,"\\varphi ","&phi;"),f.epsilon=re(ze,"\\epsilon ","&#1013;"),f.epsiv=f.varepsilon=re(ze,"\\varepsilon ","&epsilon;"),f.piv=f.varpi=re(ze,"\\varpi ","&piv;"),f.sigmaf=f.sigmav=f.varsigma=re(ze,"\\varsigma ","&sigmaf;"),f.thetav=f.vartheta=f.thetasym=re(ze,"\\vartheta ","&thetasym;"),f.upsilon=f.upsi=re(ze,"\\upsilon ","&upsilon;"),f.gammad=f.Gammad=f.digamma=re(ze,"\\digamma ","&#989;"),f.kappav=f.varkappa=re(ze,"\\varkappa ","&#1008;"),f.rhov=f.varrho=re(ze,"\\varrho ","&#1009;"),f.pi=f.=re(He,"\\pi ","&pi;"),f.lambda=re(He,"\\lambda ","&lambda;"),f.Upsilon=f.Upsi=f.upsih=f.Upsih=re(_e,"\\Upsilon ","<var style=\"font-family: serif\">&upsih;</var>"),f.Gamma=f.Delta=f.Theta=f.Lambda=f.Xi=f.Pi=f.Sigma=f.Phi=f.Psi=f.Omega=f.forall=u(Se,function(s,r){s.init=function(e){r.init.call(this,"\\"+e+" ","&"+e+";")}}),Ve=u(Ce,function(e){e.init=function(e){this.latex=e},e.createLeftOf=function(s){var t=ke.parse(this.latex);t.children().adopt(s.parent,s[ie],s[oe]),s[ie]=t.ends[oe],t.jQize().insertBefore(s.jQ),t.finalizeInsert(s.options,s),t.ends[oe][oe].siblingCreated&&t.ends[oe][oe].siblingCreated(s.options,ie),t.ends[ie][ie].siblingCreated&&t.ends[ie][ie].siblingCreated(s.options,oe),s.parent.bubble("reflow")},e.parser=function(){var e=ke.parse(this.latex).children();return Qe.succeed(e)}}),f["\xB9"]=re(Ve,"^1"),f["\xB2"]=re(Ve,"^2"),f["\xB3"]=re(Ve,"^3"),f["\xBC"]=re(Ve,"\\frac14"),f["\xBD"]=re(Ve,"\\frac12"),f["\xBE"]=re(Ve,"\\frac34"),Ge=u(De,function(e){e.init=Se.prototype.init,e.contactWeld=e.siblingCreated=e.siblingDeleted=function(s,t){function e(s){return s[ie]?s[ie]instanceof De||/^[,;:\(\[]$/.test(s[ie].ctrlSeq)?"":"mq-binary-operator":s.parent&&s.parent.parent&&s.parent.parent.isStyleBlock()?e(s.parent.parent):""}if(t!==oe)return this.jQ[0].className=e(this),this}}),f["+"]=re(Ge,"+","+"),f["\u2013"]=f["-"]=re(Ge,"-","&minus;"),f["\xB1"]=f.pm=f.plusmn=f.plusminus=re(Ge,"\\pm ","&plusmn;"),f.mp=f.mnplus=f.minusplus=re(Ge,"\\mp ","&#8723;"),me["*"]=f.sdot=f.cdot=re(De,"\\cdot ","&middot;","*"),Ke=u(De,function(s,r){s.init=function(e,t){this.data=e,this.strict=t;var s=t?"Strict":"";r.init.call(this,e["ctrlSeq"+s],e["html"+s],e["text"+s])},s.swap=function(s){this.strict=s;var t=s?"Strict":"";this.ctrlSeq=this.data["ctrlSeq"+t],this.jQ.html(this.data["html"+t]),this.textTemplate=[this.data["text"+t]]},s.deleteTowards=function(e){if(e===ie&&!this.strict)return this.swap(!0),void this.bubble("reflow");r.deleteTowards.apply(this,arguments)}}),Ye={ctrlSeq:"\\le ",html:"&le;",text:"\u2264",ctrlSeqStrict:"<",htmlStrict:"&lt;",textStrict:"<"},Xe={ctrlSeq:"\\ge ",html:"&ge;",text:"\u2265",ctrlSeqStrict:">",htmlStrict:"&gt;",textStrict:">"},f["<"]=f.lt=re(Ke,Ye,!0),f[">"]=f.gt=re(Ke,Xe,!0),f["\u2264"]=f.le=f.leq=re(Ke,Ye,!1),f["\u2265"]=f.ge=f.geq=re(Ke,Xe,!1),Ze=u(De,function(s,r){s.init=function(){r.init.call(this,"=","=")},s.createLeftOf=function(e){if(e[ie]instanceof Ke&&e[ie].strict)return e[ie].swap(!1),void e[ie].bubble("reflow");r.createLeftOf.apply(this,arguments)}}),f["="]=Ze,f["\xD7"]=f.times=re(De,"\\times ","&times;","[x]"),f["\xF7"]=f.div=f.divide=f.divides=re(De,"\\div ","&divide;","[/]"),me["~"]=f.sim=re(De,"\\sim ","~","~"),Rt=ee,Bt=document.createElement("div"),Ft=Bt.style,Nt={transform:1,WebkitTransform:1,MozTransform:1,OTransform:1,msTransform:1};for($t in Nt){if($t in Ft){Pt=$t;break}}Pt?Je=function(s,t,e){s.css(Pt,"scale("+t+","+e+")")}:"filter"in Ft?(Rt=function(e){e.className=e.className},Je=function(a,t,l){function n(){a.css("marginRight",(i.width()-1)*(t-1)/t+"px")}var i,o;t/=1+(l-1)/2,a.css("fontSize",l+"em"),a.hasClass("mq-matrixed-container")||a.addClass("mq-matrixed-container").wrapInner("<span class=\"mq-matrixed\"></span>"),i=a.children().css("filter","progid:DXImageTransform.Microsoft.Matrix(M11="+t+",SizingMethod='auto expand')"),n(),o=setInterval(n),pe(window).load(function(){clearTimeout(o),n()})}):Je=function(s,t,e){s.css("fontSize",e+"em")},Ut=u(Ce,function(s,r){s.init=function(e,t,s){r.init.call(this,e,"<"+t+" "+s+">&0</"+t+">")}}),f.mathrm=re(Ut,"\\mathrm","span","class=\"mq-roman mq-font\""),f.mathit=re(Ut,"\\mathit","i","class=\"mq-font\""),f.mathbf=re(Ut,"\\mathbf","b","class=\"mq-font\""),f.mathsf=re(Ut,"\\mathsf","span","class=\"mq-sans-serif mq-font\""),f.mathtt=re(Ut,"\\mathtt","span","class=\"mq-monospace mq-font\""),f.underline=re(Ut,"\\underline","span","class=\"mq-non-leaf mq-underline\""),f.overline=f.bar=re(Ut,"\\overline","span","class=\"mq-non-leaf mq-overline\""),f.overrightarrow=re(Ut,"\\overrightarrow","span","class=\"mq-non-leaf mq-overarrow mq-arrow-right\""),f.overleftarrow=re(Ut,"\\overleftarrow","span","class=\"mq-non-leaf mq-overarrow mq-arrow-left\""),f.overleftrightarrow=re(Ut,"\\overleftrightarrow","span","class=\"mq-non-leaf mq-overarrow mq-arrow-both\""),f.overarc=re(Ut,"\\overarc","span","class=\"mq-non-leaf mq-overarc\""),f.dot=u(Ce,function(s,t){s.init=function(){t.init.call(this,"\\dot","<span class=\"mq-non-leaf\"><span class=\"mq-dot-recurring-inner\"><span class=\"mq-dot-recurring\">&#x2d9;</span><span class=\"mq-empty-box\">&0</span></span></span>")}}),f.textcolor=u(Ce,function(s,r){s.setColor=function(e){this.color=e,this.htmlTemplate="<span class=\"mq-textcolor\" style=\"color:"+e+"\">&0</span>"},s.latex=function(){return"\\textcolor{"+this.color+"}{"+this.blocks[0].latex()+"}"},s.parser=function(){var e=this,t=Qe.optWhitespace,n=Qe.string,a=Qe.regex;return t.then(n("{")).then(a(/^[#\w\s.,()%-]*/)).skip(n("}")).then(function(t){return e.setColor(t),r.parser.call(e)})},s.isStyleBlock=function(){return!0}}),f.class=u(Ce,function(s,r){s.parser=function(){var e=this,t=Qe.string,s=Qe.regex;return Qe.optWhitespace.then(t("{")).then(s(/^[-\w\s\\\xA0-\xFF]*/)).skip(t("}")).then(function(t){return e.cls=t||"",e.htmlTemplate="<span class=\"mq-class "+t+"\">&0</span>",r.parser.call(e)})},s.latex=function(){return"\\class{"+this.cls+"}{"+this.blocks[0].latex()+"}"},s.isStyleBlock=function(){return!0}}),Wt=u(Ce,function(s,r){s.ctrlSeq="_{...}^{...}",s.createLeftOf=function(e){if(this.replacedFragment||e[ie]||!e.options.supSubsRequireOperand)return r.createLeftOf.apply(this,arguments)},s.contactWeld=function(a){var l,t,p,d,c,m;for(l=ie;l;l=l===ie&&oe){if(this[l]instanceof Wt){for(t="sub";t;t="sub"===t&&"sup"){p=this[t],d=this[l][t],p&&(d?p.isEmpty()?m=h(d,0,d.ends[ie]):(p.jQ.children().insAtDirEnd(-l,d.jQ),c=p.children().disown(),m=h(d,c.ends[oe],d.ends[ie]),l===ie?c.adopt(d,d.ends[oe],0):c.adopt(d,0,d.ends[ie])):this[l].addBlock(p.disown()),this.placeCursor=function(e,t){return function(s){s.insAtDirEnd(-l,e||t)}}(d,p))}this.remove(),a&&a[ie]===this&&(l===oe&&m?m[ie]?a.insRightOf(m[ie]):a.insAtLeftEnd(m.parent):a.insRightOf(this[l]));break}}},ge.p.charsThatBreakOutOfSupSub="",s.finalizeTree=function(){this.ends[ie].write=function(s,t){if(s.options.autoSubscriptNumerals&&this===this.parent.sub){if("_"===t)return;var e=this.chToCmd(t,s.options);return e instanceof _e?s.deleteSelection():s.clearSelection().insRightOf(this.parent),e.createLeftOf(s.show())}s[ie]&&!s[oe]&&!s.selection&&-1<s.options.charsThatBreakOutOfSupSub.indexOf(t)&&s.insRightOf(this.parent),Ee.p.write.apply(this,arguments)}},s.moveTowards=function(e,t){t.options.autoSubscriptNumerals&&!this.sup?t.insDirOf(e,this):r.moveTowards.apply(this,arguments)},s.deleteTowards=function(e,t){if(t.options.autoSubscriptNumerals&&this.sub){var s=this.sub.ends[-e];s instanceof _e?s.remove():s&&s.deleteTowards(e,t.insAtDirEnd(-e,this.sub)),this.sub.isEmpty()&&(this.sub.deleteOutOf(ie,t.insAtLeftEnd(this.sub)),this.sup&&t.insDirOf(-e,this))}else r.deleteTowards.apply(this,arguments)},s.latex=function(){function e(s,t){var e=t&&t.latex();return t?s+(1===e.length?e:"{"+(e||" ")+"}"):""}return e("_",this.sub)+e("^",this.sup)},s.addBlock=function(s){"sub"===this.supsub?(this.sup=this.upInto=this.sub.upOutOf=s,s.adopt(this,this.sub,0).downOutOf=this.sub,s.jQ=pe("<span class=\"mq-sup\"/>").append(s.jQ.children()).attr("mathquill-block-id",s.id).prependTo(this.jQ)):(this.sub=this.downInto=this.sup.downOutOf=s,s.adopt(this,0,this.sup).upOutOf=this.sup,s.jQ=pe("<span class=\"mq-sub\"></span>").append(s.jQ.children()).attr("mathquill-block-id",s.id).appendTo(this.jQ.removeClass("mq-sup-only")),this.jQ.append("<span style=\"display:inline-block;width:0\">&#8203;</span>"));for(var t=0;2>t;t+=1){!function(a,t,e,n){a[t].deleteOutOf=function(l,s){if(s.insDirOf(this[l]?-l:l,this.parent),!this.isEmpty()){var r=this.ends[l];this.children().disown().withDirAdopt(l,s.parent,s[l],s[-l]).jQ.insDirOf(-l,s.jQ),s[-l]=r}a.supsub=e,delete a[t],delete a[n+"Into"],a[e][n+"OutOf"]=c,delete a[e].deleteOutOf,"sub"===t&&pe(a.jQ.addClass("mq-sup-only")[0].lastChild).remove(),this.remove()}}(this,["sub","sup"][t],["sup","sub"][t],["down","up"][t])}}}),f.subscript=f._=u(Wt,function(s,t){s.supsub="sub",s.htmlTemplate="<span class=\"mq-supsub mq-non-leaf\"><span class=\"mq-sub\">&0</span><span style=\"display:inline-block;width:0\">&#8203;</span></span>",s.textTemplate=["_"],s.finalizeTree=function(){this.downInto=this.sub=this.ends[ie],this.sub.upOutOf=c,t.finalizeTree.call(this)}}),f.superscript=f.supscript=f["^"]=u(Wt,function(s,t){s.supsub="sup",s.htmlTemplate="<span class=\"mq-supsub mq-non-leaf mq-sup-only\"><span class=\"mq-sup\">&0</span></span>",s.textTemplate=["^"],s.finalizeTree=function(){this.upInto=this.sup=this.ends[oe],this.sup.downOutOf=c,t.finalizeTree.call(this)},s.reflow=function(){var s=this.jQ,t=s.prev().innerHeight();t*=.6,s.css("vertical-align",t+"px")}}),Ht=u(Ce,function(s,r){s.init=function(s,t){_e.prototype.init.call(this,s,"<span class=\"mq-large-operator mq-non-leaf\"><span class=\"mq-to\"><span>&1</span></span><big>"+t+"</big><span class=\"mq-from\"><span>&0</span></span></span>")},s.createLeftOf=function(e){r.createLeftOf.apply(this,arguments),e.options.sumStartsWithNEquals&&(Fe("n").createLeftOf(e),Ze().createLeftOf(e))},s.latex=function(){function e(e){return 1===e.length?e:"{"+(e||" ")+"}"}return this.ctrlSeq+"_"+e(this.ends[ie].latex())+"^"+e(this.ends[oe].latex())},s.parser=function(){var a,l=Qe.string,e=Qe.optWhitespace,n=Qe.succeed,i=ke.block,s=this,r=s.blocks=[Ee(),Ee()];for(a=0;a<r.length;a+=1){r[a].adopt(s,s.ends[oe],0)}return e.then(l("_").or(l("^"))).then(function(a){var l=r["_"===a?0:1];return i.then(function(e){return e.children().adopt(l,l.ends[oe],0),n(s)})}).many().result(s)},s.finalizeTree=function(){this.downInto=this.ends[ie],this.upInto=this.ends[oe],this.ends[ie].upOutOf=this.ends[oe],this.ends[oe].downOutOf=this.ends[ie]}}),f["\u2211"]=f.sum=f.summation=re(Ht,"\\sum ","&sum;"),f["\u220F"]=f.prod=f.product=re(Ht,"\\prod ","&prod;"),f.coprod=f.coproduct=re(Ht,"\\coprod ","&#8720;"),f["\u222B"]=f.int=f.integral=u(Ht,function(e){e.init=function(){_e.prototype.init.call(this,"\\int ","<span class=\"mq-int mq-non-leaf\"><big>&int;</big><span class=\"mq-supsub mq-non-leaf\"><span class=\"mq-sup\"><span class=\"mq-sup-inner\">&1</span></span><span class=\"mq-sub\">&0</span><span style=\"display:inline-block;width:0\">&#8203</span></span></span>")},e.createLeftOf=Ce.p.createLeftOf}),Vt=f.frac=f.dfrac=f.cfrac=f.fraction=u(Ce,function(e){e.ctrlSeq="\\frac",e.htmlTemplate="<span class=\"mq-fraction mq-non-leaf\"><span class=\"mq-numerator\">&0</span><span class=\"mq-denominator\">&1</span><span style=\"display:inline-block;width:0\">&#8203;</span></span>",e.textTemplate=["(",")/(",")"],e.finalizeTree=function(){this.upInto=this.ends[oe].upOutOf=this.ends[ie],this.downInto=this.ends[ie].downOutOf=this.ends[oe]}}),Gt=f.over=me["/"]=u(Vt,function(t,s){t.createLeftOf=function(t){if(!this.replacedFragment){for(var e=t[ie];e&&!(e instanceof De||e instanceof(f.text||ee)||e instanceof Ht||"\\ "===e.ctrlSeq||/^[,;:]$/.test(e.ctrlSeq));){e=e[ie]}e instanceof Ht&&e[oe]instanceof Wt&&(e=e[oe],e[oe]instanceof Wt&&e[oe].ctrlSeq!=e.ctrlSeq&&(e=e[oe])),e!==t[ie]&&(this.replaces(ce(e[oe]||t.parent.ends[ie],t[ie])),t[ie]=e)}s.createLeftOf.call(this,t)}}),Kt=f.sqrt=f["\u221A"]=u(Ce,function(s,t){s.ctrlSeq="\\sqrt",s.htmlTemplate="<span class=\"mq-non-leaf\"><span class=\"mq-scaled mq-sqrt-prefix\">&radic;</span><span class=\"mq-non-leaf mq-sqrt-stem\">&0</span></span>",s.textTemplate=["sqrt(",")"],s.parser=function(){return ke.optBlock.then(function(s){return ke.block.map(function(t){var e=Yt();return e.blocks=[s,t],s.adopt(e,0,0),t.adopt(e,s,0),e})}).or(t.parser.call(this))},s.reflow=function(){var e=this.ends[oe].jQ;Je(e.prev(),1,e.innerHeight()/+e.css("fontSize").slice(0,-2)-.1)}}),f.hat=u(Ce,function(e){e.ctrlSeq="\\hat",e.htmlTemplate="<span class=\"mq-non-leaf\"><span class=\"mq-hat-prefix\">^</span><span class=\"mq-hat-stem\">&0</span></span>",e.textTemplate=["hat(",")"]}),Yt=f.nthroot=u(Kt,function(e){e.htmlTemplate="<sup class=\"mq-nthroot mq-non-leaf\">&0</sup><span class=\"mq-scaled\"><span class=\"mq-sqrt-prefix mq-scaled\">&radic;</span><span class=\"mq-sqrt-stem mq-non-leaf\">&1</span></span>",e.textTemplate=["sqrt[","](",")"],e.latex=function(){return"\\sqrt["+this.ends[ie].latex()+"]{"+this.ends[oe].latex()+"}"}}),Xt=u(Ce,function(s,r){s.init=function(e,t,s){r.init.call(this,e,"<span class=\"mq-non-leaf\"><span class=\"mq-diacritic-above\">"+t+"</span><span class=\"mq-diacritic-stem\">&0</span></span>",s)}}),f.vec=re(Xt,"\\vec","&rarr;",["vec(",")"]),f.tilde=re(Xt,"\\tilde","~",["tilde(",")"]),Zt=u(u(Ce,i),function(t,a){t.init=function(n,t,e,l,s){a.init.call(this,"\\left"+l,p,[t,e]),this.side=n,this.sides={},this.sides[ie]={ch:t,ctrlSeq:l},this.sides[oe]={ch:e,ctrlSeq:s}},t.numBlocks=function(){return 1},t.html=function(){return this.htmlTemplate="<span class=\"mq-non-leaf\"><span class=\"mq-scaled mq-paren"+(this.side===oe?" mq-ghost":"")+"\">"+this.sides[ie].ch+"</span><span class=\"mq-non-leaf\">&0</span><span class=\"mq-scaled mq-paren"+(this.side===ie?" mq-ghost":"")+"\">"+this.sides[oe].ch+"</span></span>",a.html.call(this)},t.latex=function(){return"\\left"+this.sides[ie].ctrlSeq+this.ends[ie].latex()+"\\right"+this.sides[oe].ctrlSeq},t.matchBrack=function(s,t,e){return e instanceof Zt&&e.side&&e.side!==-t&&(!s.restrictMismatchedBrackets||Jt[this.sides[this.side].ch]===e.sides[e.side].ch||{"(":"]","[":")"}[this.sides[ie].ch]===e.sides[oe].ch)&&e},t.closeOpposing=function(e){e.side=0,e.sides[this.side]=this.sides[this.side],e.delimjQs.eq(this.side===ie?0:1).removeClass("mq-ghost").html(this.sides[this.side].ch)},t.createLeftOf=function(r){var t,n,l;this.replacedFragment||(t=r.options,n="|"===this.sides[ie].ch?this.matchBrack(t,oe,r[oe])||this.matchBrack(t,ie,r[ie])||this.matchBrack(t,0,r.parent.parent):this.matchBrack(t,-this.side,r[-this.side])||this.matchBrack(t,-this.side,r.parent.parent)),n?(l=this.side=-n.side,this.closeOpposing(n),n===r.parent.parent&&r[l]&&ce(r[l],r.parent.ends[l],-l).disown().withDirAdopt(-l,n.parent,n,n[l]).jQ.insDirOf(l,n.jQ),n.bubble("reflow")):(n=this,l=n.side,n.replacedFragment?n.side=0:r[-l]&&(n.replaces(ce(r[-l],r.parent.ends[-l],l)),r[-l]=0),a.createLeftOf.call(n,r)),l===ie?r.insAtLeftEnd(n.ends[ie]):r.insRightOf(n)},t.placeCursor=ee,t.unwrap=function(){this.ends[ie].children().disown().adopt(this.parent,this,this[oe]).jQ.insertAfter(this.jQ),this.remove()},t.deleteSide=function(p,t,e){var n,d,c,m=this.parent,o=this[p],a=m.ends[p];if(p===this.side)return this.unwrap(),void(o?e.insDirOf(-p,o):e.insAtDirEnd(p,m));if(n=e.options,d=!this.side,this.side=-p,this.matchBrack(n,p,this.ends[ie].ends[this.side]))this.closeOpposing(this.ends[ie].ends[this.side]),c=this.ends[ie].ends[p],this.unwrap(),c.siblingCreated&&c.siblingCreated(e.options,p),o?e.insDirOf(-p,o):e.insAtDirEnd(p,m);else{if(this.matchBrack(n,p,this.parent.parent))this.parent.parent.closeOpposing(this),this.parent.parent.unwrap();else{if(t&&d)return this.unwrap(),void(o?e.insDirOf(-p,o):e.insAtDirEnd(p,m));this.sides[p]={ch:Jt[this.sides[this.side].ch],ctrlSeq:Jt[this.sides[this.side].ctrlSeq]},this.delimjQs.removeClass("mq-ghost").eq(p===ie?0:1).addClass("mq-ghost").html(this.sides[p].ch)}o?(c=this.ends[ie].ends[p],ce(o,a,-p).disown().withDirAdopt(-p,this.ends[ie],c,0).jQ.insAtDirEnd(p,this.ends[ie].jQ.removeClass("mq-empty")),c.siblingCreated&&c.siblingCreated(e.options,p),e.insDirOf(-p,o)):t?e.insDirOf(p,this):e.insAtDirEnd(p,this.ends[ie])}},t.deleteTowards=function(s,t){this.deleteSide(-s,!1,t)},t.finalizeTree=function(){this.ends[ie].deleteOutOf=function(s,t){this.parent.deleteSide(s,!0,t)},this.finalizeTree=this.intentionalBlur=function(){this.delimjQs.eq(this.side===ie?1:0).removeClass("mq-ghost"),this.side=0}},t.siblingCreated=function(s,t){t===-this.side&&this.finalizeTree()}}),Jt={"(":")",")":"(","[":"]","]":"[","{":"}","}":"{","\\{":"\\}","\\}":"\\{","&lang;":"&rang;","&rang;":"&lang;","\\langle ":"\\rangle ","\\rangle ":"\\langle ","|":"|","\\lVert ":"\\rVert ","\\rVert ":"\\lVert "},o("("),o("["),o("{","\\{"),f.langle=re(Zt,ie,"&lang;","&rang;","\\langle ","\\rangle "),f.rangle=re(Zt,oe,"&lang;","&rang;","\\langle ","\\rangle "),me["|"]=re(Zt,ie,"|","|","|","|"),f.lVert=re(Zt,ie,"&#8741;","&#8741;","\\lVert ","\\rVert "),f.rVert=re(Zt,oe,"&#8741;","&#8741;","\\lVert ","\\rVert "),f.left=u(Ce,function(e){e.parser=function(){var a=Qe.regex,t=Qe.string,e=(Qe.succeed,Qe.optWhitespace);return e.then(a(/^(?:[([|]|\\\{|\\langle\b|\\lVert\b)/)).then(function(l){var o="\\"===l.charAt(0)?l.slice(1):l;return"\\langle"==l&&(o="&lang;",l+=" "),"\\lVert"==l&&(o="&#8741;",l+=" "),ke.then(function(s){return t("\\right").skip(e).then(a(/^(?:[\])|]|\\\}|\\rangle\b|\\rVert\b)/)).map(function(r){var a,i="\\"===r.charAt(0)?r.slice(1):r;return"\\rangle"==r&&(i="&rang;",r+=" "),"\\rVert"==r&&(i="&#8741;",r+=" "),a=Zt(0,o,i,l,r),a.blocks=[s],s.adopt(a,0,0),a})})})}}),f.right=u(Ce,function(e){e.parser=function(){return Qe.fail("unmatched \\right")}}),es=f.binom=f.binomial=u(u(Ce,i),function(e){e.ctrlSeq="\\binom",e.htmlTemplate="<span class=\"mq-non-leaf\"><span class=\"mq-paren mq-scaled\">(</span><span class=\"mq-non-leaf\"><span class=\"mq-array mq-non-leaf\"><span>&0</span><span>&1</span></span></span><span class=\"mq-paren mq-scaled\">)</span></span>",e.textTemplate=["choose(",",",")"]}),f.choose=u(es,function(e){e.createLeftOf=Gt.prototype.createLeftOf}),f.editable=f.MathQuillMathField=u(Ce,function(s,r){s.ctrlSeq="\\MathQuillMathField",s.htmlTemplate="<span class=\"mq-editable-field\"><span class=\"mq-root-block\">&0</span></span>",s.parser=function(){var a=this,e=Qe.string,t=Qe.regex,n=Qe.succeed;return e("[").then(t(/^[a-z][a-z0-9]*/i)).skip(e("]")).map(function(t){a.name=t}).or(n()).then(r.parser.call(a))},s.finalizeTree=function(s){var t=fe(this.ends[ie],this.jQ,s);t.KIND_OF_MQ="MathField",t.editable=!0,t.createTextarea(),t.editablesTextareaEvents(),t.cursor.insAtRightEnd(t.root),l(t.root)},s.registerInnerField=function(s,t){s.push(s[this.name]=t(this.ends[ie].controller))},s.latex=function(){return this.ends[ie].latex()},s.text=function(){return this.ends[ie].text()}}),ts=f.embed=u(_e,function(e){e.setOptions=function(s){function t(){return""}return this.text=s.text||t,this.htmlTemplate=s.htmlString||"",this.latex=s.latex||t,this},e.parser=function(){var r=this,t=Qe.string,e=Qe.regex,n=Qe.succeed;return t("{").then(e(/^[a-z][a-z0-9]*/i)).skip(t("}")).then(function(a){return t("[").then(e(/^[-\w\s]*/)).skip(t("]")).or(n()).map(function(t){return r.setOptions(xe[a](t))})})}}),ss=e(1);for(rs in ss){!function(s,t){"function"==typeof t?(n[s]=function(){return r(),t.apply(this,arguments)},n[s].prototype=t.prototype):n[s]=t}(rs,ss[rs])}}();var r=MathQuill;e.default=r;return e.default});
//# sourceMappingURL=mathquill.min.js.map
