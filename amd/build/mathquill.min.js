function _typeof(e){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(e){return typeof e}}else{_typeof=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}}return _typeof(e)}define ("qtype_shortmath/mathquill",["jquery"],function(){!function(){function ee(){}function te(s){var t=s.length-1;return function(){var e=d.call(arguments,0,t),r=d.call(arguments,t);return s.apply(this,e.concat([r]))}}function se(s){return te(function(r,a){"function"!=typeof r&&(r=c(r));var t=function(e){return r.apply(e,[e].concat(a))};return s.call(this,t)})}function re(s){var t=d.call(arguments,1);return function(){return s.apply(this,t)}}function ne(s,t){if(!t)throw new Error("prayer failed: "+s)}function ae(e){ne("a direction was passed",e===le||e===oe)}function ie(s,t,e){ne("a parent is always present",s),ne("leftward is properly set up",function(){return t?t[oe]===e&&t.parent===s:s.ends[le]===e}()),ne("rightward is properly set up",function(){return e?e[le]===t&&e.parent===s:s.ends[oe]===t}())}function s(){window.console&&console.warn("You are using the MathQuill API without specifying an interface version, which will fail in v1.0.0. Easiest fix is to do the following before doing anything else:\n\n    MathQuill = MathQuill.getInterface(1);\n    // now MathQuill.MathField() works like it used to\n\nSee also the \"`dev` branch (2014\u20132015) \u2192 v0.10.0 Migration Guide\" at\n  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide")}function r(e){return s(),ts(e)}function e(l){function e(s){var t,r;return s&&s.nodeType?(t=pe(s).children(".mq-root-block").attr(At),r=t&&de.byId[t].controller,r?a[r.KIND_OF_MQ](r):null):null}function n(s,t){var e,l,o;t&&t.handlers&&(t.handlers={fns:t.handlers,APIClasses:a});for(e in t){t.hasOwnProperty(e)&&(l=t[e],o=ge[e],s[e]=o?o(l):l)}}var a,t,i;if(!(xe<=l&&l<=ye))throw"Only interface versions between "+xe+" and "+ye+" supported. You specified: "+l;a={},e.L=le,e.R=oe,e.saneKeyboardEvents=Qe,e.config=function(e){return n(we.p,e),this},e.registerEmbed=function(s,t){if(!/^[a-z][a-z0-9]*$/i.test(s))throw"Embed name must start with letter and be only letters and digits";be[s]=t},t=a.AbstractMathQuill=m(qe,function(e){e.init=function(e){this.__controller=e,this.__options=e.options,this.id=e.id,this.data=e.data},e.__mathquillify=function(r){var t,a=this.__controller,n=a.root,i=a.container;a.createTextarea(),t=i.addClass(r).contents().detach(),n.jQ=pe("<span class=\"mq-root-block\"/>").attr(At,n.id).appendTo(i),this.latex(t.text()),this.revert=function(){return i.empty().unbind(".mathquill").removeClass("mq-editable-field mq-math-mode mq-text-mode").append(t)}},e.config=function(e){return n(this.__options,e),this},e.el=function(){return this.__controller.container[0]},e.text=function(){return this.__controller.exportText()},e.latex=function(e){return 0<arguments.length?(this.__controller.renderLatexMath(e),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()},e.html=function(){return this.__controller.root.jQ.html().replace(/ mathquill-(?:command|block)-id="?\d+"?/g,"").replace(/<span class="?mq-cursor( mq-blink)?"?>.?<\/span>/i,"").replace(/ mq-hasCursor|mq-hasCursor ?/,"").replace(/ class=(""|(?= |>))/g,"")},e.reflow=function(){return this.__controller.root.postOrder("reflow"),this}}),e.prototype=t.prototype,a.EditableField=m(t,function(t,e){t.__mathquillify=function(){return e.__mathquillify.apply(this,arguments),this.__controller.editable=!0,this.__controller.delegateMouseEvents(),this.__controller.editablesTextareaEvents(),this},t.focus=function(){return this.__controller.textarea.focus(),this},t.blur=function(){return this.__controller.textarea.blur(),this},t.write=function(e){return this.__controller.writeLatex(e),this.__controller.scrollHoriz(),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this},t.empty=function(){var s=this.__controller.root,t=this.__controller.cursor;return s.eachChild("postOrder","dispose"),s.ends[le]=s.ends[oe]=0,s.jQ.empty(),delete t.selection,t.insAtRightEnd(s),this},t.cmd=function(s){var r,a=this.__controller.notify(),n=a.cursor;return /^\\[a-z]+$/i.test(s)?(s=s.slice(1),(r=u[s])&&(s=r(s),n.selection&&s.replaces(n.replaceSelection()),s.createLeftOf(n.show()),this.__controller.scrollHoriz())):n.parent.write(n,s),a.blurred&&n.hide().parent.blur(),this},t.select=function(){var e=this.__controller;for(e.notify("move").cursor.insAtRightEnd(e.root);e.cursor[le];){e.selectLeft()}return this},t.clearSelection=function(){return this.__controller.cursor.clearSelection(),this},t.moveToDirEnd=function(e){return this.__controller.notify("move").cursor.insAtDirEnd(e,this.__controller.root),this},t.moveToLeftEnd=function(){return this.moveToDirEnd(le)},t.moveToRightEnd=function(){return this.moveToDirEnd(oe)},t.keystroke=function(t){var s;for(t=t.replace(/^\s+|\s+$/g,"").split(/\s+/),s=0;s<t.length;s+=1){this.__controller.keystroke(t[s],{preventDefault:ee})}return this},t.typedText=function(s){for(var t=0;t<s.length;t+=1){this.__controller.typedText(s.charAt(t))}return this},t.dropEmbedded=function(a,t,e){var n,l=a-pe(window).scrollLeft(),s=t-pe(window).scrollTop(),r=document.elementFromPoint(l,s);this.__controller.seek(pe(r),a,t),n=es().setOptions(e),n.createLeftOf(this.__controller.cursor)},t.clickAt=function(r,t,e){e=e||document.elementFromPoint(r,t);var a=this.__controller,i=a.root;return rs.contains(i.jQ[0],e)||(e=i.jQ[0]),a.seek(pe(e),r+pageXOffset,t+pageYOffset),a.blurred&&this.focus(),this},t.ignoreNextMousedown=function(e){return this.__controller.cursor.options.ignoreNextMousedown=e,this}}),e.EditableField=function(){throw"wtf don't call me, I'm 'abstract'"},e.EditableField.prototype=a.EditableField.prototype;for(i in fe){!function(n,t){var p=a[n]=t(a);e[n]=function(t,r){var s,i=e(t);return i instanceof p||!t||!t.nodeType?i:(s=he(p.RootBlock(),pe(t),we()),s.KIND_OF_MQ=n,p(s).__mathquillify(r,l))},e[n].prototype=p.prototype}(i,fe[i])}return e}function n(s){var t,r=["moveOutOf","deleteOutOf","selectOutOf","upOutOf","downOutOf"];for(t=0;t<r.length;t+=1){!function(r){s[r]=function(e){this.controller.handle(r,e)}}(r[t])}s.reflow=function(){this.controller.handle("reflow"),this.controller.handle("edited"),this.controller.handle("edit")}}function t(s,t,e){return m(Le,{ctrlSeq:s,htmlTemplate:"<"+t+" "+e+">&0</"+t+">"})}function l(s){var t=this.parent,e=s;do{if(e[oe])return s.insLeftOf(t);e=e.parent.parent}while(e!==t);s.insRightOf(t)}function i(s,t){s.jQadd=function(){t.jQadd.apply(this,arguments),this.delimjQs=this.jQ.children(":first").add(this.jQ.children(":last")),this.contentjQ=this.jQ.children(":eq(1)")},s.reflow=function(){var e=this.contentjQ.outerHeight()/parseFloat(this.contentjQ.css("fontSize"));Ze(this.delimjQs,It(1+.2*(e-1),1.2),1.2*e)}}function o(r,t){var t=t||r,a=Zt[r],n=Zt[t];f[r]=re(Xt,le,r,a,t,n),f[a]=re(Xt,oe,r,a,t,n)}var p,d,c,m,le,oe,pe,h,de,ce,u,f,me,ue,he,fe,we,ge,qe,be,xe,ye,Oe,ve,Qe,je,ke,Te,Ce,_e,Se,De,Ee,Le,Ae,Re,Ie,Be,Me,ze,Fe,Ne,Pe,$e,Ue,We,He,Ve,Ge,Ke,Ye,Xe,Ze,Je,Rt,Bt,Ft,Nt,Pt,$t,Ut,Wt,Ht,Vt,Gt,Kt,Yt,Xt,Zt,Jt,es,ts,ss,rs=window.jQuery,At="mathquill-block-id",It=Math.min,zt=Math.max;if(!rs)throw"MathQuill requires jQuery 1.5.2+ to be loaded first";d=[].slice,c=te(function(s,t){return te(function(r,e){if(s in r)return r[s].apply(r,t.concat(e))})}),m=function(n,t){function e(e){return"object"==_typeof(e)}function i(e){return"function"==typeof e}function s(){}return function r(p,d){function m(){var e=new a;return i(e.init)&&e.init.apply(e,arguments),e}function a(){}var l,f,w;return void 0===d&&(d=p,p=Object),m.Bare=a,l=s.prototype=p.prototype,f=a.prototype=m.prototype=m.p=new s,f.constructor=m,m.extend=function(t){return r(m,t)},(m.open=function(s){if(w={},i(s)?w=s.call(m,f,l,m,p):e(s)&&(w=s),e(w))for(var n in w){t.call(w,n)&&(f[n]=w[n])}return i(f.init)||(f.init=p),m})(d)}}(0,{}.hasOwnProperty),le=-1,oe=1,pe=m(rs,function(e){e.insDirOf=function(s,t){return s===le?this.insertBefore(t.first()):this.insertAfter(t.last())},e.insAtDirEnd=function(s,t){return s===le?this.prependTo(t):this.appendTo(t)}}),h=m(function(e){e.parent=0,e[le]=0,e[oe]=0,e.init=function(s,t,e){this.parent=s,this[le]=t,this[oe]=e},this.copy=function(e){return h(e.parent,e[le],e[oe])}}),de=m(function(s){function t(){return e+=1}s[le]=0,s[oe]=0,s.parent=0;var e=0;this.byId={},s.init=function(){this.id=t(),de.byId[this.id]=this,this.ends={},this.ends[le]=0,this.ends[oe]=0},s.dispose=function(){delete de.byId[this.id]},s.toString=function(){return"{{ MathQuill Node #"+this.id+" }}"},s.jQ=pe(),s.jQadd=function(e){return this.jQ=this.jQ.add(e)},s.jQize=function(s){function r(e){var s,a;for(e.getAttribute&&(s=e.getAttribute("mathquill-command-id"),a=e.getAttribute("mathquill-block-id"),s&&de.byId[s].jQadd(e),a&&de.byId[a].jQadd(e)),e=e.firstChild;e;e=e.nextSibling){r(e)}}var e;for(s=pe(s||this.html()),e=0;e<s.length;e+=1){r(s[e])}return s},s.createDir=function(s,t){ae(s);var e=this;return e.jQize(),e.jQ.insDirOf(s,t.jQ),t[s]=e.adopt(t.parent,t[le],t[oe]),e},s.createLeftOf=function(e){return this.createDir(le,e)},s.selectChildren=function(s,t){return ue(s,t)},s.bubble=se(function(s){var t;for(t=this;t&&!1!==s(t);t=t.parent){}return this}),s.postOrder=se(function(s){return function t(e){e.eachChild(t),s(e)}(this),this}),s.isEmpty=function(){return 0===this.ends[le]&&0===this.ends[oe]},s.isStyleBlock=function(){return!1},s.children=function(){return ce(this.ends[le],this.ends[oe])},s.eachChild=function(){var e=this.children();return e.each.apply(e,arguments),this},s.foldChildren=function(s,t){return this.children().fold(s,t)},s.withDirAdopt=function(s,t,e,r){return ce(this,this).withDirAdopt(s,t,e,r),this},s.adopt=function(s,t,e){return ce(this,this).adopt(s,t,e),this},s.disown=function(){return ce(this,this).disown(),this},s.remove=function(){return this.jQ.remove(),this.postOrder("dispose"),this.disown()}}),ce=m(function(e){e.init=function(s,t,e){if(e===p&&(e=le),ae(e),ne("no half-empty fragments",!s==!t),this.ends={},s){ne("withDir is passed to Fragment",s instanceof de),ne("oppDir is passed to Fragment",t instanceof de),ne("withDir and oppDir have the same parent",s.parent===t.parent),this.ends[e]=s,this.ends[-e]=t;var r=this.fold([],function(s,t){return s.push.apply(s,t.jQ.get()),s});this.jQ=this.jQ.add(r)}},e.jQ=pe(),e.withDirAdopt=function(s,t,e,r){return s===le?this.adopt(t,e,r):this.adopt(t,r,e)},e.adopt=function(a,t,l){var n,o,p;return ie(a,t,l),n=this,n.disowned=!1,(o=n.ends[le])?(p=n.ends[oe],t||(a.ends[le]=o),l?l[le]=p:a.ends[oe]=p,n.ends[oe][oe]=l,n.each(function(e){e[le]=t,e.parent=a,t&&(t[oe]=e),t=e}),n):this},e.disown=function(){var s,r,a=this,n=a.ends[le];return!n||a.disowned?a:(a.disowned=!0,s=a.ends[oe],r=n.parent,ie(r,n[le],n),ie(r,s,s[oe]),n[le]?n[le][oe]=s[oe]:r.ends[le]=s[oe],s[oe]?s[oe][le]=n[le]:r.ends[oe]=n[le],a)},e.remove=function(){return this.jQ.remove(),this.each("postOrder","dispose"),this.disown()},e.each=se(function(s){var t=this,e=t.ends[le];if(!e)return t;for(;e!==t.ends[oe][oe]&&!1!==s(e);e=e[oe]){}return t}),e.fold=function(s,r){return this.each(function(e){s=r.call(this,s,e)}),s}}),u={},f={},me=m(h,function(e){e.init=function(s,t){this.parent=s,this.options=t;var e=this.jQ=this._jQ=pe("<span class=\"mq-cursor\">&#8203;</span>");this.blink=function(){e.toggleClass("mq-blink")},this.upDownCache={}},e.show=function(){return this.jQ=this._jQ.removeClass("mq-blink"),"intervalId"in this?clearInterval(this.intervalId):(this[oe]?this.selection&&this.selection.ends[le][le]===this[le]?this.jQ.insertBefore(this.selection.jQ):this.jQ.insertBefore(this[oe].jQ.first()):this.jQ.appendTo(this.parent.jQ),this.parent.focus()),this.intervalId=setInterval(this.blink,500),this},e.hide=function(){return"intervalId"in this&&clearInterval(this.intervalId),delete this.intervalId,this.jQ.detach(),this.jQ=pe(),this},e.withDirInsertAt=function(r,t,e,n){var a=this.parent;this.parent=t,this[r]=e,this[-r]=n,a!==t&&a.blur&&a.blur(this)},e.insDirOf=function(s,t){return ae(s),this.jQ.insDirOf(s,t.jQ),this.withDirInsertAt(s,t.parent,t[s],t),this.parent.jQ.addClass("mq-hasCursor"),this},e.insLeftOf=function(e){return this.insDirOf(le,e)},e.insRightOf=function(e){return this.insDirOf(oe,e)},e.insAtDirEnd=function(s,t){return ae(s),this.jQ.insAtDirEnd(s,t.jQ),this.withDirInsertAt(s,t,0,t.ends[s]),t.focus(),this},e.insAtLeftEnd=function(e){return this.insAtDirEnd(le,e)},e.insAtRightEnd=function(e){return this.insAtDirEnd(oe,e)},e.jumpUpDown=function(r,t){var e,a,l=this;l.upDownCache[r.id]=h.copy(l),e=l.upDownCache[t.id],e?e[oe]?l.insLeftOf(e[oe]):l.insAtRightEnd(e.parent):(a=l.offset().left,t.seek(a,l))},e.offset=function(){var s=this,t=s.jQ.removeClass("mq-cursor").offset();return s.jQ.addClass("mq-cursor"),t},e.unwrapGramp=function(){var r=this.parent.parent,t=r.parent,e=r[oe],n=this,a=r[le];if(r.disown().eachChild(function(s){s.isEmpty()||(s.children().adopt(t,a,e).each(function(t){t.jQ.insertBefore(r.jQ.first())}),a=s.ends[oe])}),!this[oe])if(this[le])this[oe]=this[le][oe];else for(;!this[oe];){if(this.parent=this.parent[oe],!this.parent){this[oe]=r[oe],this.parent=t;break}this[oe]=this.parent.ends[le]}this[oe]?this.insLeftOf(this[oe]):this.insAtRightEnd(t),r.jQ.remove(),r[le].siblingDeleted&&r[le].siblingDeleted(n.options,oe),r[oe].siblingDeleted&&r[oe].siblingDeleted(n.options,le)},e.startSelection=function(){var s,r=this.anticursor=h.copy(this),e=r.ancestors={};for(s=r;s.parent;s=s.parent){e[s.parent.id]=s}},e.endSelection=function(){delete this.anticursor},e.select=function(){var s,p,d,c,m,u,f,w=this.anticursor;if(this[le]===w[le]&&this.parent===w.parent)return!1;for(s=this;s.parent;s=s.parent){if(s.parent.id in w.ancestors){p=s.parent;break}}if(ne("cursor and anticursor in the same tree",p),d=w.ancestors[p.id],u=oe,s[le]!==d)for(f=s;f;f=f[oe]){if(f[oe]===d[oe]){u=le,c=s,m=d;break}}return u===oe&&(c=d,m=s),c instanceof h&&(c=c[oe]),m instanceof h&&(m=m[le]),this.hide().selection=p.selectChildren(c,m),this.insDirOf(u,this.selection.ends[u]),this.selectionChanged(),!0},e.clearSelection=function(){return this.selection&&(this.selection.clear(),delete this.selection,this.selectionChanged()),this},e.deleteSelection=function(){this.selection&&(this[le]=this.selection.ends[le][le],this[oe]=this.selection.ends[oe][oe],this.selection.remove(),this.selectionChanged(),delete this.selection)},e.replaceSelection=function(){var e=this.selection;return e&&(this[le]=e.ends[le][le],this[oe]=e.ends[oe][oe],delete this.selection),e}}),ue=m(ce,function(s,t){s.init=function(){t.init.apply(this,arguments),this.jQ=this.jQ.wrapAll("<span class=\"mq-selection\"></span>").parent()},s.adopt=function(){return this.jQ.replaceWith(this.jQ=this.jQ.children()),t.adopt.apply(this,arguments)},s.clear=function(){return this.jQ.replaceWith(this.jQ[0].childNodes),this},s.join=function(s){return this.fold("",function(t,e){return t+e[s]()})}}),he=m(function(s){s.init=function(s,t,e){this.id=s.id,this.data={},this.root=s,this.container=t,this.options=e,s.controller=this,this.cursor=s.cursor=me(s,e)},s.handle=function(s,t){var e,r=this.options.handlers;r&&r.fns[s]&&(e=r.APIClasses[this.KIND_OF_MQ](this),t===le||t===oe?r.fns[s](t,e):r.fns[s](e))};var r=[];this.onNotify=function(e){r.push(e)},s.notify=function(){for(var e=0;e<r.length;e+=1){r[e].apply(this.cursor,arguments)}return this}}),fe={},we=m(),ge={},qe=m(),be={},r.prototype=qe.p,r.VERSION="v0.10.1",r.interfaceVersion=function(e){if(1!==e)throw"Only interface version 1 supported. You specified: "+e;return s=function(){window.console&&console.warn("You called MathQuill.interfaceVersion(1); to specify the interface version, which will fail in v1.0.0. You can fix this easily by doing this before doing anything else:\n\n    MathQuill = MathQuill.getInterface(1);\n    // now MathQuill.MathField() works like it used to\n\nSee also the \"`dev` branch (2014\u20132015) \u2192 v0.10.0 Migration Guide\" at\n  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide")},s(),r},r.getInterface=e,xe=e.MIN=1,ye=e.MAX=2,r.noConflict=function(){return window.MathQuill=Oe,r},Oe=window.MathQuill,window.MathQuill=r,ve=m(function(s,t,l){function n(s,r){throw s=s?"'"+s+"'":"EOF","Parse Error: "+r+" at "+s}var e,i,p;s.init=function(e){this._=e},s.parse=function(s){function t(s,t){return t}return this.skip(p)._(""+s,t,n)},s.or=function(r){ne("or is passed a parser",r instanceof l);var t=this;return l(function(e,n,a){return t._(e,n,function(){return r._(e,n,a)})})},s.then=function(s){var t=this;return l(function(e,n,r){function i(t,e){var i=s instanceof l?s:s(e);return ne("a parser is returned",i instanceof l),i._(t,n,r)}return t._(e,i,r)})},s.many=function(){var n=this;return l(function(a,t){function i(e,t){return a=e,r.push(t),!0}function s(){return!1}for(var r=[];n._(a,i,s);){}return t(a,r)})},s.times=function(s,t){2>arguments.length&&(t=s);var p=this;return l(function(i,e,d){function r(s,t){return w.push(t),i=s,!0}function o(s,t){return l=t,i=s,!1}function a(){return!1}var l,m,w=[],h=!0;for(m=0;m<s;m+=1){if(!(h=p._(i,r,o)))return d(i,l)}for(;m<t&&h;m+=1){h=p._(i,r,a)}return e(i,w)})},s.result=function(e){return this.then(i(e))},s.atMost=function(e){return this.times(0,e)},s.atLeast=function(s){var r=this;return r.times(s).then(function(s){return r.many().map(function(t){return s.concat(t)})})},s.map=function(s){return this.then(function(t){return i(s(t))})},s.skip=function(s){return this.then(function(t){return s.result(t)})},this.string=function(a){var t=a.length;return l(function(e,n,s){var r=e.slice(0,t);return r===a?n(e.slice(t),r):s(e,"expected '"+a+"'")})},e=this.regex=function(e){ne("regexp parser is anchored","^"===e.toString().charAt(1));return l(function(t,n,a){var s,i=e.exec(t);return i?(s=i[0],n(t.slice(s.length),s)):a(t,"expected "+e)})},i=l.succeed=function(s){return l(function(t,e){return e(t,s)})},l.fail=function(s){return l(function(t,e,r){return r(t,s)})},l.letter=e(/^[a-z]/i),l.letters=e(/^[a-z]*/i),l.digit=e(/^[0-9]/),l.digits=e(/^[0-9]*/),l.whitespace=e(/^\s+/),l.optWhitespace=e(/^\s*/),l.any=l(function(s,t,e){return s?t(s.slice(1),s.charAt(0)):e(s,"expected any character")}),l.all=l(function(s,t){return t("",s)}),p=l.eof=l(function(s,t,e){return s?e(s,"expected EOF"):t(s,s)})}),Qe=function(){function t(n){var t,l=n.which||n.keyCode,i=a[l],s=[];return n.ctrlKey&&s.push("Ctrl"),n.originalEvent&&n.originalEvent.metaKey&&s.push("Meta"),n.altKey&&s.push("Alt"),n.shiftKey&&s.push("Shift"),t=i||String.fromCharCode(l),s.length||i?(s.push(t),s.join("-")):t}var a={8:"Backspace",9:"Tab",10:"Enter",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",144:"NumLock"};return function(e,n){function i(e){x=e,clearTimeout(m),m=setTimeout(e)}function s(t){i(function(e){x=ee,clearTimeout(m),t(e)})}function r(t){x(),x=ee,clearTimeout(m),Q.val(t),t&&Q[0].select&&Q[0].select(),h=!!t}function o(){var e=Q[0];return"selectionStart"in e&&e.selectionStart!==e.selectionEnd}function a(){n.keystroke(t(f),f)}function l(e){f=e,O=null,h&&s(function(e){e&&"focusout"===e.type||!Q[0].select||Q[0].select()}),a()}function p(e){f&&O&&a(),O=e,i(c)}function d(){f&&!O&&i(c)}function c(){if(!o()){var e=Q.val();1===e.length?(Q.val(""),n.typedText(e)):e&&Q[0].select&&Q[0].select()}}function u(){var e=Q.val();Q.val(""),e&&n.paste(e)}var m,h,f=null,O=null,Q=rs(e),q=rs(n.container||Q),x=ee;return q.bind("keydown keypress input keyup focusout paste",function(e){x(e)}),h=!1,q.bind({keydown:l,keypress:p,keyup:d,focusout:function(){f=O=null},cut:function cut(){s(function(){n.cut()})},copy:function copy(){s(function(){n.copy()})},paste:function(){Q.focus(),i(u)}}),{select:r}}}(),he.open(function(e){e.exportText=function(){return this.root.foldChildren("",function(s,t){return s+t.text()})}}),he.open(function(e){e.focusBlurEvents=function(){function a(){clearTimeout(e),s.selection&&s.selection.jQ.addClass("mq-blur"),t()}function t(){s.hide().parent.blur(),l.container.removeClass("mq-focused"),pe(window).unbind("blur",a)}var e,l=this,i=l.root,s=l.cursor;l.textarea.focus(function(){l.blurred=!1,clearTimeout(e),l.container.addClass("mq-focused"),s.parent||s.insAtRightEnd(i),s.selection?(s.selection.jQ.removeClass("mq-blur"),l.selectionChanged()):s.show()}).blur(function(){l.blurred=!0,e=setTimeout(function(){i.postOrder("intentionalBlur"),s.clearSelection().endSelection(),t()}),pe(window).bind("blur",a)}),l.blurred=!0,s.hide().parent.blur()}}),he.open(function(e){e.keystroke=function(s,t){this.cursor.parent.keystroke(s,t,this)}}),de.open(function(e){e.keystroke=function(s,t,e){var r=e.cursor;switch(s){case"Ctrl-Shift-Backspace":case"Ctrl-Backspace":e.ctrlDeleteDir(le);break;case"Shift-Backspace":case"Backspace":e.backspace();break;case"Esc":case"Tab":return void e.escapeDir(oe,s,t);case"Shift-Tab":case"Shift-Esc":return void e.escapeDir(le,s,t);case"End":e.notify("move").cursor.insAtRightEnd(r.parent);break;case"Ctrl-End":e.notify("move").cursor.insAtRightEnd(e.root);break;case"Shift-End":for(;r[oe];){e.selectRight()}break;case"Ctrl-Shift-End":for(;r[oe]||r.parent!==e.root;){e.selectRight()}break;case"Home":e.notify("move").cursor.insAtLeftEnd(r.parent);break;case"Ctrl-Home":e.notify("move").cursor.insAtLeftEnd(e.root);break;case"Shift-Home":for(;r[le];){e.selectLeft()}break;case"Ctrl-Shift-Home":for(;r[le]||r.parent!==e.root;){e.selectLeft()}break;case"Left":e.moveLeft();break;case"Shift-Left":e.selectLeft();break;case"Ctrl-Left":break;case"Right":e.moveRight();break;case"Shift-Right":e.selectRight();break;case"Ctrl-Right":break;case"Up":e.moveUp();break;case"Down":e.moveDown();break;case"Shift-Up":if(r[le])for(;r[le];){e.selectLeft()}else e.selectLeft();case"Shift-Down":if(r[oe])for(;r[oe];){e.selectRight()}else e.selectRight();case"Ctrl-Up":case"Ctrl-Down":break;case"Ctrl-Shift-Del":case"Ctrl-Del":e.ctrlDeleteDir(oe);break;case"Shift-Del":case"Del":e.deleteForward();break;case"Meta-A":case"Ctrl-A":for(e.notify("move").cursor.insAtRightEnd(e.root);r[le];){e.selectLeft()}break;default:return;}t.preventDefault(),e.scrollHoriz()},e.moveOutOf=e.moveTowards=e.deleteOutOf=e.deleteTowards=e.unselectInto=e.selectOutOf=e.selectTowards=function(){ne("overridden or never called on this node")}}),he.open(function(s){function t(r,t){var a=r.notify("upDown").cursor,e=t+"Into",n=t+"OutOf";return a[oe][e]?a.insAtLeftEnd(a[oe][e]):a[le][e]?a.insAtRightEnd(a[le][e]):a.parent.bubble(function(s){var t=s[n];if(t&&("function"==typeof t&&(t=s[n](a)),t instanceof de&&a.jumpUpDown(s,t),!0!==t))return!1}),r}this.onNotify(function(e){"move"!==e&&"upDown"!==e||this.show().clearSelection()}),s.escapeDir=function(s,t,e){ae(s);var r=this.cursor;if(r.parent!==this.root&&e.preventDefault(),r.parent!==this.root)return r.parent.moveOutOf(s,r),this.notify("move")},ge.leftRightIntoCmdGoes=function(e){if(e&&"up"!==e&&"down"!==e)throw"\"up\" or \"down\" required for leftRightIntoCmdGoes option, got \""+e+"\"";return e},s.moveDir=function(s){ae(s);var t=this.cursor,e=t.options.leftRightIntoCmdGoes;return t.selection?t.insDirOf(s,t.selection.ends[s]):t[s]?t[s].moveTowards(s,t,e):t.parent.moveOutOf(s,t,e),this.notify("move")},s.moveLeft=function(){return this.moveDir(le)},s.moveRight=function(){return this.moveDir(oe)},s.moveUp=function(){return t(this,"up")},s.moveDown=function(){return t(this,"down")},this.onNotify(function(e){"upDown"!==e&&(this.upDownCache={})}),this.onNotify(function(e){"edit"===e&&this.show().deleteSelection()}),s.deleteDir=function(s){var t,r;return ae(s),t=this.cursor,r=t.selection,this.notify("edit"),r||(t[s]?t[s].deleteTowards(s,t):t.parent.deleteOutOf(s,t)),t[le].siblingDeleted&&t[le].siblingDeleted(t.options,oe),t[oe].siblingDeleted&&t[oe].siblingDeleted(t.options,le),t.parent.bubble("reflow"),this},s.ctrlDeleteDir=function(s){ae(s);var t=this.cursor;return!t[s]||t.selection?this.deleteDir(s):(this.notify("edit"),s===le?ce(t.parent.ends[le],t[le]).remove():ce(t[oe],t.parent.ends[oe]).remove(),t.insAtDirEnd(s,t.parent),t[le].siblingDeleted&&t[le].siblingDeleted(t.options,oe),t[oe].siblingDeleted&&t[oe].siblingDeleted(t.options,le),t.parent.bubble("reflow"),this)},s.backspace=function(){return this.deleteDir(le)},s.deleteForward=function(){return this.deleteDir(oe)},this.onNotify(function(e){"select"!==e&&this.endSelection()}),s.selectDir=function(s){var t,r=this.notify("select").cursor,n=r.selection;ae(s),r.anticursor||r.startSelection(),t=r[s],t?n&&n.ends[s]===t&&r.anticursor[-s]!==t?t.unselectInto(s,r):t.selectTowards(s,r):r.parent.selectOutOf(s,r),r.clearSelection(),r.select()||r.show()},s.selectLeft=function(){return this.selectDir(le)},s.selectRight=function(){return this.selectDir(oe)}}),je=function(){function w(s){var t=De();return s.adopt(t,0,0),t}function t(s){var t,r=s[0]||De();for(t=1;t<s.length;t+=1){s[t].children().adopt(r,r.ends[oe],0)}return r}var e=ve.string,n=ve.regex,i=ve.letter,s=ve.any,r=ve.optWhitespace,o=ve.succeed,a=ve.fail,l=i.map(function(e){return ze(e)}),c=n(/^[^${}\\_^]/).map(function(e){return _e(e)}),q=n(/^[^\\a-eg-zA-Z]/).or(e("\\").then(n(/^[a-z]+/i).or(n(/^\s+/).result(" ")).or(s))).then(function(s){var t=u[s];return t?t(s).parser():a("unknown command: \\"+s)}),h=q.or(l).or(c),f=e("{").then(function(){return d}).skip(e("}")),p=r.then(f.or(h.map(w))),d=p.many().map(t).skip(r),m=e("[").then(p.then(function(e){return"]"!==e.join("latex")?o(e):a()}).many().map(t).skip(r)).skip(e("]")),g=d;return g.block=p,g.optBlock=m,g}(),he.open(function(e){e.exportLatex=function(){return this.root.latex().replace(/(\\[a-z]+) (?![a-z])/gi,"$1")},e.writeLatex=function(a){var t,l=this.notify("edit").cursor,n=ve.all,i=ve.eof,s=je.skip(i).or(n.result(!1)).parse(a);return s&&!s.isEmpty()&&(s.children().adopt(l.parent,l[le],l[oe]),t=s.jQize(),t.insertBefore(l.jQ),l[le]=s.ends[oe],s.finalizeInsert(l.options,l),s.ends[oe][oe].siblingCreated&&s.ends[oe][oe].siblingCreated(l.options,le),s.ends[le][le].siblingCreated&&s.ends[le][le].siblingCreated(l.options,oe),l.parent.bubble("reflow")),this},e.renderLatexMath=function(l){var t,p,d=this.root,i=this.cursor,s=ve.all,r=ve.eof,o=je.skip(r).or(s.result(!1)).parse(l);d.eachChild("postOrder","dispose"),d.ends[le]=d.ends[oe]=0,o&&o.children().adopt(d,0,0),t=d.jQ,o?(p=o.join("html"),t.html(p),d.jQize(t.children()),d.finalizeInsert(i.options)):t.empty(),delete i.selection,i.insAtRightEnd(d)},e.renderLatexText=function(p){var t,d,m,w,g,q,b,x,y,O,v=this.root,h=this.cursor;if(v.jQ.children().slice(1).remove(),v.eachChild("postOrder","dispose"),v.ends[le]=v.ends[oe]=0,delete h.selection,h.show().insAtRightEnd(v),t=ve.regex,d=ve.string,m=ve.eof,w=ve.all,g=d("$").then(je).skip(d("$").or(m)).map(function(s){var t,r=Re(h);return r.createBlocks(),t=r.ends[le],s.children().adopt(t,0,0),r}),q=d("\\$").result("$"),b=q.or(t(/^[^$]/)).map(_e),x=g.or(b).many(),y=x.skip(m).or(w.result(!1)).parse(p)){for(O=0;O<y.length;O+=1){y[O].adopt(v,v.ends[oe],0)}v.jQize().appendTo(v.jQ),v.finalizeInsert(h.options)}}}),he.open(function(t){we.p.ignoreNextMousedown=ee,t.delegateMouseEvents=function(){var t=this.root.jQ;this.container.bind("mousedown.mathquill",function(e){function n(e){r=pe(e.target)}function i(e){c.anticursor||c.startSelection(),l.seek(r,e.pageX,e.pageY).cursor.select(),r=p}function s(e){c.blink=m,c.selection||(l.editable?c.show():u.detach()),d.unbind("mousemove",n),pe(e.target.ownerDocument).unbind("mousemove",i).unbind("mouseup",s)}var r,d=pe(e.target).closest(".mq-root-block"),a=de.byId[d.attr("mathquill-block-id")||t.attr("mathquill-block-id")],l=a.controller,c=l.cursor,m=c.blink,u=l.textareaSpan,h=l.textarea;e.preventDefault(),e.target.unselectable=!0,c.options.ignoreNextMousedown(e)||(c.options.ignoreNextMousedown=ee,l.blurred&&(l.editable||d.prepend(u),h.focus()),c.blink=ee,l.seek(pe(e.target),e.pageX,e.pageY).cursor.startSelection(),d.mousemove(n),pe(e.target.ownerDocument).mousemove(i).mouseup(s))})}}),he.open(function(e){e.seek=function(s,t){var e,n,l,p=this.notify("select").cursor;return s&&((e=s.attr("mathquill-block-id")||s.attr("mathquill-command-id"))||(n=s.parent(),e=n.attr("mathquill-block-id")||n.attr("mathquill-command-id"))),l=e?de.byId[e]:this.root,ne("nodeId is the id of some Node that exists",l),p.clearSelection().show(),l.seek(t,p),this.scrollHoriz(),this}}),he.open(function(e){e.scrollHoriz=function(){var l,p,d,c,m,u=this.cursor,r=u.selection,o=this.root.jQ[0].getBoundingClientRect();if(r){if(d=r.jQ[0].getBoundingClientRect(),c=d.left-(o.left+20),m=d.right-(o.right-20),r.ends[le]===u[oe]){if(0>c)p=c;else{if(!(0<m))return;p=d.left-m<o.left+20?c:m}}else if(0<m)p=m;else{if(!(0>c))return;p=d.right-c>o.right-20?m:c}}else if((l=u.jQ[0].getBoundingClientRect().left)>o.right-20)p=l-(o.right-20);else{if(!(l<o.left+20))return;p=l-(o.left+20)}this.root.jQ.stop().animate({scrollLeft:"+="+p},100)}}),he.open(function(e){we.p.substituteTextarea=function(){return pe("<textarea autocapitalize=off autocomplete=off autocorrect=off spellcheck=false x-palm-disable-ste-all=true />")[0]},e.createTextarea=function(){var s,r=this.textareaSpan=pe("<span class=\"mq-textarea\"></span>"),e=this.options.substituteTextarea();if(!e.nodeType)throw"substituteTextarea() must return a DOM element, got "+e;e=this.textarea=pe(e).appendTo(r),s=this,s.cursor.selectionChanged=function(){s.selectionChanged()}},e.selectionChanged=function(){var e=this;Je(e.container[0]),e.textareaSelectionTimeout===p&&(e.textareaSelectionTimeout=setTimeout(function(){e.setTextareaSelection()}))},e.setTextareaSelection=function(){this.textareaSelectionTimeout=p;var e="";this.cursor.selection&&(e=this.cursor.selection.join("latex"),this.options.statelessClipboard&&(e="$"+e+"$")),this.selectFn(e)},e.staticMathTextareaEvents=function(){function r(){a.detach(),t.blurred=!0}var t=this,e=(t.root,t.cursor),n=t.textarea,a=t.textareaSpan;this.container.prepend(rs("<span class=\"mq-selectable\">").text("$"+t.exportLatex()+"$")),t.blurred=!0,n.bind("cut paste",!1).bind("copy",function(){t.setTextareaSelection()}).focus(function(){t.blurred=!1}).blur(function(){e.selection&&e.selection.clear(),setTimeout(r)}),t.selectFn=function(e){n.val(e),e&&n.select()}},we.p.substituteKeyboardEvents=Qe,e.editablesTextareaEvents=function(){var s=this,t=s.textarea,e=s.textareaSpan,r=this.options.substituteKeyboardEvents(t,this);this.selectFn=function(e){r.select(e)},this.container.prepend(e),this.focusBlurEvents()},e.typedText=function(s){if("\n"===s)return this.handle("enter");var t=this.notify().cursor;t.parent.write(t,s),this.scrollHoriz()},e.cut=function(){var s=this,t=s.cursor;t.selection&&setTimeout(function(){s.notify("edit"),t.parent.bubble("reflow")})},e.copy=function(){this.setTextareaSelection()},e.paste=function(e){this.options.statelessClipboard&&(e="$"===e.slice(0,1)&&"$"===e.slice(-1)?e.slice(1,-1):"\\text{"+e+"}"),this.writeLatex(e).cursor.show()}}),ke=m(de,function(e){e.finalizeInsert=function(s,t){var e=this;e.postOrder("finalizeTree",s),e.postOrder("contactWeld",t),e.postOrder("blur"),e.postOrder("reflow"),e[oe].siblingCreated&&e[oe].siblingCreated(s,le),e[le].siblingCreated&&e[le].siblingCreated(s,oe),e.bubble("reflow")}}),Te=m(ke,function(s,r){s.init=function(e,t,n){var a=this;r.init.call(a),a.ctrlSeq||(a.ctrlSeq=e),t&&(a.htmlTemplate=t),n&&(a.textTemplate=n)},s.replaces=function(e){e.disown(),this.replacedFragment=e},s.isEmpty=function(){return this.foldChildren(!0,function(s,t){return s&&t.isEmpty()})},s.parser=function(){var s=je.block,r=this;return s.times(r.numBlocks()).map(function(e){r.blocks=e;for(var t=0;t<e.length;t+=1){e[t].adopt(r,r.ends[oe],0)}return r})},s.createLeftOf=function(e){var t=this,s=t.replacedFragment;t.createBlocks(),r.createLeftOf.call(t,e),s&&(s.adopt(t.ends[le],0,0),s.jQ.appendTo(t.ends[le].jQ)),t.finalizeInsert(e.options),t.placeCursor(e)},s.createBlocks=function(){var r,a,l=this,n=l.numBlocks(),i=l.blocks=Array(n);for(r=0;r<n;r+=1){a=i[r]=De(),a.adopt(l,l.ends[oe],0)}},s.placeCursor=function(e){e.insAtRightEnd(this.foldChildren(this.ends[le],function(s,t){return s.isEmpty()?s:t}))},s.moveTowards=function(s,t,e){var r=e&&this[e+"Into"];t.insAtDirEnd(-s,r||this.ends[-s])},s.deleteTowards=function(s,t){this.isEmpty()?t[s]=this.remove()[s]:this.moveTowards(s,t,null)},s.selectTowards=function(s,t){t[-s]=this,t[s]=this[s]},s.selectChildren=function(){return ue(this,this)},s.unselectInto=function(s,t){t.insAtDirEnd(-s,t.anticursor.ancestors[this.id])},s.seek=function(l,t){function e(s){var t={};return t[le]=s.jQ.offset().left,t[oe]=t[le]+s.jQ.outerWidth(),t}var n,p=this,s=e(p);return l<s[le]?t.insLeftOf(p):l>s[oe]?t.insRightOf(p):(n=s[le],void p.eachChild(function(r){var i=e(r);return l<i[le]?(l-n<i[le]-l?r[le]?t.insAtRightEnd(r[le]):t.insLeftOf(p):t.insAtLeftEnd(r),!1):l>i[oe]?void(r[oe]?n=i[oe]:s[oe]-l<l-i[oe]?t.insRightOf(p):t.insAtRightEnd(r)):(r.seek(l,t),!1)}))},s.numBlocks=function(){var e=this.htmlTemplate.match(/&\d+/g);return e?e.length:0},s.html=function(){var s,l,p,d=this,i=d.blocks,r=" mathquill-command-id="+d.id,o=d.htmlTemplate.match(/<[^<>]+>|[^<>]+/g);for(ne("no unmatched angle brackets",o.join("")===this.htmlTemplate),s=0,l=o[0];l;s+=1,l=o[s]){if("/>"===l.slice(-2))o[s]=l.slice(0,-2)+r+"/>";else if("<"===l.charAt(0)){ne("not an unmatched top-level close tag","/"!==l.charAt(1)),o[s]=l.slice(0,-1)+r+">",p=1;do{s+=1,l=o[s],ne("no missing close tags",l),"</"===l.slice(0,2)?p-=1:"<"===l.charAt(0)&&"/>"!==l.slice(-2)&&(p+=1)}while(0<p)}}return o.join("").replace(/>&(\d+)/g,function(s,t){return" mathquill-block-id="+i[t].id+">"+i[t].join("html")})},s.latex=function(){return this.foldChildren(this.ctrlSeq,function(s,t){return s+"{"+(t.latex()||" ")+"}"})},s.textTemplate=[""],s.text=function(){var r=this,t=0;return r.foldChildren(r.textTemplate[t],function(e,n){t+=1;var a=n.text();return e&&"("===r.textTemplate[t]&&"("===a[0]&&")"===a.slice(-1)?e+a.slice(1,-1)+r.textTemplate[t]:e+n.text()+(r.textTemplate[t]||"")})}}),Ce=m(Te,function(t,s){t.init=function(r,t,e){e||(e=r&&1<r.length?r.slice(1):r),s.init.call(this,r,t,[e])},t.parser=function(){return ve.succeed(this)},t.numBlocks=function(){return 0},t.replaces=function(e){e.remove()},t.createBlocks=ee,t.moveTowards=function(s,t){t.jQ.insDirOf(s,this.jQ),t[-s]=this,t[s]=this[s]},t.deleteTowards=function(s,t){t[s]=this.remove()[s]},t.seek=function(s,t){s-this.jQ.offset().left<this.jQ.outerWidth()/2?t.insLeftOf(this):t.insRightOf(this)},t.latex=function(){return this.ctrlSeq},t.text=function(){return this.textTemplate},t.placeCursor=ee,t.isEmpty=function(){return!0}}),_e=m(Ce,function(s,r){s.init=function(e,t){r.init.call(this,e,"<span>"+(t||e)+"</span>")}}),Se=m(Ce,function(s,r){s.init=function(e,t,s){r.init.call(this,e,"<span class=\"mq-binary-operator\">"+t+"</span>",s)}}),De=m(ke,function(s,r){s.join=function(s){return this.foldChildren("",function(t,e){return t+e[s]()})},s.html=function(){return this.join("html")},s.latex=function(){return this.join("latex")},s.text=function(){return this.ends[le]===this.ends[oe]&&0!==this.ends[le]?this.ends[le].text():this.join("text")},s.keystroke=function(e,t,s){return!s.options.spaceBehavesLikeTab||"Spacebar"!==e&&"Shift-Spacebar"!==e?r.keystroke.apply(this,arguments):(t.preventDefault(),void s.escapeDir("Shift-Spacebar"===e?le:oe,e,t))},s.moveOutOf=function(s,t,e){e&&this.parent[e+"Into"]||!this[s]?t.insDirOf(s,this.parent):t.insAtDirEnd(-s,this[s])},s.selectOutOf=function(s,t){t.insDirOf(s,this.parent)},s.deleteOutOf=function(s,t){t.unwrapGramp()},s.seek=function(s,t){var e=this.ends[oe];if(!e||e.jQ.offset().left+e.jQ.outerWidth()<s)return t.insAtRightEnd(this);if(s<this.ends[le].jQ.offset().left)return t.insAtLeftEnd(this);for(;s<e.jQ.offset().left;){e=e[le]}return e.seek(s,t)},s.chToCmd=function(s,t){var e;return s.match(/^[a-eg-zA-Z]$/)?ze(s):/^\d$/.test(s)?Be(s):t&&t.typingSlashWritesDivisionSymbol&&"/"===s?u["\xF7"](s):t&&t.typingAsteriskWritesTimesSymbol&&"*"===s?u["\xD7"](s):(e=f[s]||u[s])?e(s):_e(s)},s.write=function(s,t){var e=this.chToCmd(t,s.options);s.selection&&e.replaces(s.replaceSelection()),e.createLeftOf(s.show())},s.focus=function(){return this.jQ.addClass("mq-hasCursor"),this.jQ.removeClass("mq-empty"),this},s.blur=function(){return this.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.jQ.addClass("mq-empty"),this}}),fe.StaticMath=function(s){return m(s.AbstractMathQuill,function(t,r){this.RootBlock=De,t.__mathquillify=function(e){return this.config(e),r.__mathquillify.call(this,"mq-math-mode"),this.__controller.delegateMouseEvents(),this.__controller.staticMathTextareaEvents(),this},t.init=function(){r.init.apply(this,arguments),this.__controller.root.postOrder("registerInnerField",this.innerFields=[],s.MathField)},t.latex=function(){var t=r.latex.apply(this,arguments);return 0<arguments.length&&this.__controller.root.postOrder("registerInnerField",this.innerFields=[],s.MathField),t}})},Ee=m(De,n),fe.MathField=function(t){return m(t.EditableField,function(t,s){this.RootBlock=Ee,t.__mathquillify=function(t,e){return this.config(t),1<e&&(this.__controller.root.reflow=ee),s.__mathquillify.call(this,"mq-editable-field mq-math-mode"),delete this.__controller.root.reflow,this}})},Le=m(de,function(s,r){function p(s){var t,r;if(s.jQ[0].normalize(),t=s.jQ[0].firstChild)return ne("only node in TextBlock span is Text node",3===t.nodeType),r=Ae(t.data),r.jQadd(t),s.children().disown(),r.adopt(s,0,0)}s.ctrlSeq="\\text",s.replaces=function(e){e instanceof ce?this.replacedText=e.remove().jQ.text():"string"==typeof e&&(this.replacedText=e)},s.jQadd=function(e){r.jQadd.call(this,e),this.ends[le]&&this.ends[le].jQadd(this.jQ[0].firstChild)},s.createLeftOf=function(e){var t,s=this;if(r.createLeftOf.call(this,e),s[oe].siblingCreated&&s[oe].siblingCreated(e.options,le),s[le].siblingCreated&&s[le].siblingCreated(e.options,oe),s.bubble("reflow"),e.insAtRightEnd(s),s.replacedText)for(t=0;t<s.replacedText.length;t+=1){s.write(e,s.replacedText.charAt(t))}},s.parser=function(){var s=this,t=ve.string,e=ve.regex;return ve.optWhitespace.then(t("{")).then(e(/^[^}]*/)).skip(t("}")).map(function(t){return 0===t.length?ce():(Ae(t).adopt(s,0,0),s)})},s.textContents=function(){return this.foldChildren("",function(s,t){return s+t.text})},s.text=function(){return"\""+this.textContents()+"\""},s.latex=function(){var e=this.textContents();return 0===e.length?"":"\\text{"+e.replace(/\\/g,"\\backslash ").replace(/[{}]/g,"\\$&")+"}"},s.html=function(){return"<span class=\"mq-text-mode\" mathquill-command-id="+this.id+">"+this.textContents()+"</span>"},s.moveTowards=function(s,t){t.insAtDirEnd(-s,this)},s.moveOutOf=function(s,t){t.insDirOf(s,this)},s.unselectInto=s.moveTowards,s.selectTowards=Te.prototype.selectTowards,s.deleteTowards=Te.prototype.deleteTowards,s.selectOutOf=function(s,t){t.insDirOf(s,this)},s.deleteOutOf=function(s,t){this.isEmpty()&&t.insRightOf(this)},s.write=function(e,t){var n,a;e.show().deleteSelection(),"$"!==t?e[le]?e[le].appendText(t):Ae(t).createLeftOf(e):this.isEmpty()?(e.insRightOf(this),_e("\\$","$").createLeftOf(e)):e[oe]?e[le]?(n=Le(),a=this.ends[le],a.disown().jQ.detach(),a.adopt(n,0,0),e.insLeftOf(this),r.createLeftOf.call(n,e)):e.insLeftOf(this):e.insRightOf(this)},s.seek=function(n,t){var e,d,m,f,w,g,q,b;for(t.hide(),e=p(this),d=this.jQ.width()/this.text.length,m=Math.round((n-this.jQ.offset().left)/d),0>=m?t.insAtLeftEnd(this):m>=e.text.length?t.insAtRightEnd(this):t.insLeftOf(e.splitRight(m)),f=n-t.show().offset().left,w=f&&0>f?le:oe,g=w;t[w]&&0<f*g;){t[w].moveTowards(w,t),g=f,f=n-t.offset().left}w*f<-w*g&&t[-w].moveTowards(-w,t),t.anticursor?t.anticursor.parent===this&&(q=t[le]&&t[le].text.length,this.anticursorPosition===q?t.anticursor=h.copy(t):(this.anticursorPosition<q?(b=t[le].splitRight(this.anticursorPosition),t[le]=b):b=t[oe].splitRight(this.anticursorPosition-q),t.anticursor=h(this,b[le],b))):this.anticursorPosition=t[le]&&t[le].text.length},s.blur=function(e){De.prototype.blur.call(this),e&&(""===this.textContents()?(this.remove(),e[le]===this?e[le]=this[le]:e[oe]===this&&(e[oe]=this[oe])):p(this))},s.focus=De.prototype.focus}),Ae=m(de,function(s,r){function l(s,t){return t.charAt(s===le?0:-1+t.length)}s.init=function(e){r.init.call(this),this.text=e},s.jQadd=function(e){this.dom=e,this.jQ=pe(e)},s.jQize=function(){return this.jQadd(document.createTextNode(this.text))},s.appendText=function(e){this.text+=e,this.dom.appendData(e)},s.prependText=function(e){this.text=e+this.text,this.dom.insertData(0,e)},s.insTextAtDirEnd=function(s,t){ae(t),t===oe?this.appendText(s):this.prependText(s)},s.splitRight=function(s){var t=Ae(this.text.slice(s)).adopt(this.parent,this,this[oe]);return t.jQadd(this.dom.splitText(s)),this.text=this.text.slice(0,s),t},s.moveTowards=function(r,t){var e,n;return ae(r),e=l(-r,this.text),n=this[-r],n?n.insTextAtDirEnd(e,r):Ae(e).createDir(-r,t),this.deleteTowards(r,t)},s.latex=function(){return this.text},s.deleteTowards=function(s,t){1<this.text.length?s===oe?(this.dom.deleteData(0,1),this.text=this.text.slice(1)):(this.dom.deleteData(-1+this.text.length,1),this.text=this.text.slice(0,-1)):(this.remove(),this.jQ.remove(),t[s]=this[s])},s.selectTowards=function(r,t){var e,n,p,d;return ae(r),e=t.anticursor,n=l(-r,this.text),e[r]===this?(p=Ae(n).createDir(r,t),e[r]=p,t.insDirOf(r,p)):(d=this[-r],d?d.insTextAtDirEnd(n,r):(p=Ae(n).createDir(-r,t),p.jQ.insDirOf(-r,t.selection.jQ)),1===this.text.length&&e[-r]===this&&(e[-r]=this[-r])),this.deleteTowards(r,t)}}),u.text=u.textnormal=u.textrm=u.textup=u.textmd=Le,u.em=u.italic=u.italics=u.emph=u.textit=u.textsl=t("\\textit","i","class=\"mq-text-mode\""),u.strong=u.bold=u.textbf=t("\\textbf","b","class=\"mq-text-mode\""),u.sf=u.textsf=t("\\textsf","span","class=\"mq-sans-serif mq-text-mode\""),u.tt=u.texttt=t("\\texttt","span","class=\"mq-monospace mq-text-mode\""),u.textsc=t("\\textsc","span","style=\"font-variant:small-caps\" class=\"mq-text-mode\""),u.uppercase=t("\\uppercase","span","style=\"text-transform:uppercase\" class=\"mq-text-mode\""),u.lowercase=t("\\lowercase","span","style=\"text-transform:lowercase\" class=\"mq-text-mode\""),Re=m(Te,function(s,r){s.init=function(e){r.init.call(this,"$"),this.cursor=e},s.htmlTemplate="<span class=\"mq-math-mode\">&0</span>",s.createBlocks=function(){r.createBlocks.call(this),this.ends[le].cursor=this.cursor,this.ends[le].write=function(s,t){"$"!==t?De.prototype.write.call(this,s,t):this.isEmpty()?(s.insRightOf(this.parent),this.parent.deleteTowards(dir,s),_e("\\$","$").createLeftOf(s.show())):s[oe]?s[le]?De.prototype.write.call(this,s,t):s.insLeftOf(this.parent):s.insRightOf(this.parent)}},s.latex=function(){return"$"+this.ends[le].latex()+"$"}}),Ie=m(Ee,function(s,r){s.keystroke=function(e){if("Spacebar"!==e&&"Shift-Spacebar"!==e)return r.keystroke.apply(this,arguments)},s.write=function(s,t){if(s.show().deleteSelection(),"$"===t)Re(s).createLeftOf(s);else{var e;"<"===t?e="&lt;":">"==t&&(e="&gt;"),_e(t,e).createLeftOf(s)}}}),fe.TextField=function(e){return m(e.EditableField,function(s,t){this.RootBlock=Ie,s.__mathquillify=function(){return t.__mathquillify.call(this,"mq-editable-field mq-text-mode")},s.latex=function(e){return 0<arguments.length?(this.__controller.renderLatexText(e),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()}})},f["\\"]=m(Te,function(s,r){s.ctrlSeq="\\",s.replaces=function(e){this._replacedFragment=e.disown(),this.isEmpty=function(){return!1}},s.htmlTemplate="<span class=\"mq-latex-command-input mq-non-leaf\">\\<span>&0</span></span>",s.textTemplate=["\\"],s.createBlocks=function(){r.createBlocks.call(this),this.ends[le].focus=function(){return this.parent.jQ.addClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.removeClass("mq-empty"),this},this.ends[le].blur=function(){return this.parent.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.addClass("mq-empty"),this},this.ends[le].write=function(s,t){s.show().deleteSelection(),t.match(/[a-z]/i)?_e(t).createLeftOf(s):(this.parent.renderCommand(s),"\\"===t&&this.isEmpty()||s.parent.write(s,t))},this.ends[le].keystroke=function(e,t,s){return"Tab"===e||"Enter"===e||"Spacebar"===e?(this.parent.renderCommand(s.cursor),void t.preventDefault()):r.keystroke.apply(this,arguments)}},s.createLeftOf=function(e){if(r.createLeftOf.call(this,e),this._replacedFragment){var s=this.jQ[0];this.jQ=this._replacedFragment.jQ.addClass("mq-blur").bind("mousedown mousemove",function(e){return pe(e.target=s).trigger(e),!1}).insertBefore(this.jQ).add(this.jQ)}},s.latex=function(){return"\\"+this.ends[le].latex()+" "},s.renderCommand=function(s){var t,r;this.jQ=this.jQ.last(),this.remove(),this[oe]?s.insLeftOf(this[oe]):s.insAtRightEnd(this.parent),t=this.ends[le].latex(),t||(t=" "),r=u[t],r?(r=r(t),this._replacedFragment&&r.replaces(this._replacedFragment),r.createLeftOf(s)):(r=Le(),r.replaces(t),r.createLeftOf(s),s.insRightOf(r),this._replacedFragment&&this._replacedFragment.remove())}}),u.notin=u.cong=u.equiv=u.oplus=u.otimes=m(Se,function(s,r){s.init=function(e){r.init.call(this,"\\"+e+" ","&"+e+";")}}),u["\u2260"]=u.ne=u.neq=re(Se,"\\ne ","&ne;"),u["\u2217"]=u.ast=u.star=u.loast=u.lowast=re(Se,"\\ast ","&lowast;"),u.therefor=u.therefore=re(Se,"\\therefore ","&there4;"),u.cuz=u.because=re(Se,"\\because ","&#8757;"),u.prop=u.propto=re(Se,"\\propto ","&prop;"),u["\u2248"]=u.asymp=u.approx=re(Se,"\\approx ","&asymp;"),u.isin=u.in=re(Se,"\\in ","&isin;"),u.ni=u.contains=re(Se,"\\ni ","&ni;"),u.notni=u.niton=u.notcontains=u.doesnotcontain=re(Se,"\\not\\ni ","&#8716;"),u.sub=u.subset=re(Se,"\\subset ","&sub;"),u.sup=u.supset=u.superset=re(Se,"\\supset ","&sup;"),u.nsub=u.notsub=u.nsubset=u.notsubset=re(Se,"\\not\\subset ","&#8836;"),u.nsup=u.notsup=u.nsupset=u.notsupset=u.nsuperset=u.notsuperset=re(Se,"\\not\\supset ","&#8837;"),u.sube=u.subeq=u.subsete=u.subseteq=re(Se,"\\subseteq ","&sube;"),u.supe=u.supeq=u.supsete=u.supseteq=u.supersete=u.superseteq=re(Se,"\\supseteq ","&supe;"),u.nsube=u.nsubeq=u.notsube=u.notsubeq=u.nsubsete=u.nsubseteq=u.notsubsete=u.notsubseteq=re(Se,"\\not\\subseteq ","&#8840;"),u.nsupe=u.nsupeq=u.notsupe=u.notsupeq=u.nsupsete=u.nsupseteq=u.notsupsete=u.notsupseteq=u.nsupersete=u.nsuperseteq=u.notsupersete=u.notsuperseteq=re(Se,"\\not\\supseteq ","&#8841;"),u.N=u.naturals=u.Naturals=re(_e,"\\mathbb{N}","&#8469;"),u.P=u.primes=u.Primes=u.projective=u.Projective=u.probability=u.Probability=re(_e,"\\mathbb{P}","&#8473;"),u.Z=u.integers=u.Integers=re(_e,"\\mathbb{Z}","&#8484;"),u.Q=u.rationals=u.Rationals=re(_e,"\\mathbb{Q}","&#8474;"),u.R=u.reals=u.Reals=re(_e,"\\mathbb{R}","&#8477;"),u.C=u.complex=u.Complex=u.complexes=u.Complexes=u.complexplane=u.Complexplane=u.ComplexPlane=re(_e,"\\mathbb{C}","&#8450;"),u.H=u.Hamiltonian=u.quaternions=u.Quaternions=re(_e,"\\mathbb{H}","&#8461;"),u.quad=u.emsp=re(_e,"\\quad ","    "),u.qquad=re(_e,"\\qquad ","        "),u.diamond=re(_e,"\\diamond ","&#9671;"),u.bigtriangleup=re(_e,"\\bigtriangleup ","&#9651;"),u.ominus=re(_e,"\\ominus ","&#8854;"),u.uplus=re(_e,"\\uplus ","&#8846;"),u.bigtriangledown=re(_e,"\\bigtriangledown ","&#9661;"),u.sqcap=re(_e,"\\sqcap ","&#8851;"),u.triangleleft=re(_e,"\\triangleleft ","&#8882;"),u.sqcup=re(_e,"\\sqcup ","&#8852;"),u.triangleright=re(_e,"\\triangleright ","&#8883;"),u.odot=u.circledot=re(_e,"\\odot ","&#8857;"),u.bigcirc=re(_e,"\\bigcirc ","&#9711;"),u.dagger=re(_e,"\\dagger ","&#0134;"),u.ddagger=re(_e,"\\ddagger ","&#135;"),u.wr=re(_e,"\\wr ","&#8768;"),u.amalg=re(_e,"\\amalg ","&#8720;"),u.models=re(_e,"\\models ","&#8872;"),u.prec=re(_e,"\\prec ","&#8826;"),u.succ=re(_e,"\\succ ","&#8827;"),u.preceq=re(_e,"\\preceq ","&#8828;"),u.succeq=re(_e,"\\succeq ","&#8829;"),u.simeq=re(_e,"\\simeq ","&#8771;"),u.mid=re(_e,"\\mid ","&#8739;"),u.ll=re(_e,"\\ll ","&#8810;"),u.gg=re(_e,"\\gg ","&#8811;"),u.parallel=re(_e,"\\parallel ","&#8741;"),u.nparallel=re(_e,"\\nparallel ","&#8742;"),u.bowtie=re(_e,"\\bowtie ","&#8904;"),u.sqsubset=re(_e,"\\sqsubset ","&#8847;"),u.sqsupset=re(_e,"\\sqsupset ","&#8848;"),u.smile=re(_e,"\\smile ","&#8995;"),u.sqsubseteq=re(_e,"\\sqsubseteq ","&#8849;"),u.sqsupseteq=re(_e,"\\sqsupseteq ","&#8850;"),u.doteq=re(_e,"\\doteq ","&#8784;"),u.frown=re(_e,"\\frown ","&#8994;"),u.vdash=re(_e,"\\vdash ","&#8870;"),u.dashv=re(_e,"\\dashv ","&#8867;"),u.nless=re(_e,"\\nless ","&#8814;"),u.ngtr=re(_e,"\\ngtr ","&#8815;"),u.longleftarrow=re(_e,"\\longleftarrow ","&#8592;"),u.longrightarrow=re(_e,"\\longrightarrow ","&#8594;"),u.Longleftarrow=re(_e,"\\Longleftarrow ","&#8656;"),u.Longrightarrow=re(_e,"\\Longrightarrow ","&#8658;"),u.longleftrightarrow=re(_e,"\\longleftrightarrow ","&#8596;"),u.updownarrow=re(_e,"\\updownarrow ","&#8597;"),u.Longleftrightarrow=re(_e,"\\Longleftrightarrow ","&#8660;"),u.Updownarrow=re(_e,"\\Updownarrow ","&#8661;"),u.mapsto=re(_e,"\\mapsto ","&#8614;"),u.nearrow=re(_e,"\\nearrow ","&#8599;"),u.hookleftarrow=re(_e,"\\hookleftarrow ","&#8617;"),u.hookrightarrow=re(_e,"\\hookrightarrow ","&#8618;"),u.searrow=re(_e,"\\searrow ","&#8600;"),u.leftharpoonup=re(_e,"\\leftharpoonup ","&#8636;"),u.rightharpoonup=re(_e,"\\rightharpoonup ","&#8640;"),u.swarrow=re(_e,"\\swarrow ","&#8601;"),u.leftharpoondown=re(_e,"\\leftharpoondown ","&#8637;"),u.rightharpoondown=re(_e,"\\rightharpoondown ","&#8641;"),u.nwarrow=re(_e,"\\nwarrow ","&#8598;"),u.ldots=re(_e,"\\ldots ","&#8230;"),u.cdots=re(_e,"\\cdots ","&#8943;"),u.vdots=re(_e,"\\vdots ","&#8942;"),u.ddots=re(_e,"\\ddots ","&#8945;"),u.surd=re(_e,"\\surd ","&#8730;"),u.triangle=re(_e,"\\triangle ","&#9651;"),u.ell=re(_e,"\\ell ","&#8467;"),u.top=re(_e,"\\top ","&#8868;"),u.flat=re(_e,"\\flat ","&#9837;"),u.natural=re(_e,"\\natural ","&#9838;"),u.sharp=re(_e,"\\sharp ","&#9839;"),u.wp=re(_e,"\\wp ","&#8472;"),u.bot=re(_e,"\\bot ","&#8869;"),u.clubsuit=re(_e,"\\clubsuit ","&#9827;"),u.diamondsuit=re(_e,"\\diamondsuit ","&#9826;"),u.heartsuit=re(_e,"\\heartsuit ","&#9825;"),u.spadesuit=re(_e,"\\spadesuit ","&#9824;"),u.parallelogram=re(_e,"\\parallelogram ","&#9649;"),u.square=re(_e,"\\square ","&#11036;"),u.oint=re(_e,"\\oint ","&#8750;"),u.bigcap=re(_e,"\\bigcap ","&#8745;"),u.bigcup=re(_e,"\\bigcup ","&#8746;"),u.bigsqcup=re(_e,"\\bigsqcup ","&#8852;"),u.bigvee=re(_e,"\\bigvee ","&#8744;"),u.bigwedge=re(_e,"\\bigwedge ","&#8743;"),u.bigodot=re(_e,"\\bigodot ","&#8857;"),u.bigotimes=re(_e,"\\bigotimes ","&#8855;"),u.bigoplus=re(_e,"\\bigoplus ","&#8853;"),u.biguplus=re(_e,"\\biguplus ","&#8846;"),u.lfloor=re(_e,"\\lfloor ","&#8970;"),u.rfloor=re(_e,"\\rfloor ","&#8971;"),u.lceil=re(_e,"\\lceil ","&#8968;"),u.rceil=re(_e,"\\rceil ","&#8969;"),u.opencurlybrace=u.lbrace=re(_e,"\\lbrace ","{"),u.closecurlybrace=u.rbrace=re(_e,"\\rbrace ","}"),u.lbrack=re(_e,"["),u.rbrack=re(_e,"]"),u.slash=re(_e,"/"),u.vert=re(_e,"|"),u.perp=u.perpendicular=re(_e,"\\perp ","&perp;"),u.nabla=u.del=re(_e,"\\nabla ","&nabla;"),u.hbar=re(_e,"\\hbar ","&#8463;"),u.AA=u.Angstrom=u.angstrom=re(_e,"\\text\\AA ","&#8491;"),u.ring=u.circ=u.circle=re(_e,"\\circ ","&#8728;"),u.bull=u.bullet=re(_e,"\\bullet ","&bull;"),u.setminus=u.smallsetminus=re(_e,"\\setminus ","&#8726;"),u.not=u["\xAC"]=u.neg=re(_e,"\\neg ","&not;"),u["\u2026"]=u.dots=u.ellip=u.hellip=u.ellipsis=u.hellipsis=re(_e,"\\dots ","&hellip;"),u.converges=u.darr=u.dnarr=u.dnarrow=u.downarrow=re(_e,"\\downarrow ","&darr;"),u.dArr=u.dnArr=u.dnArrow=u.Downarrow=re(_e,"\\Downarrow ","&dArr;"),u.diverges=u.uarr=u.uparrow=re(_e,"\\uparrow ","&uarr;"),u.uArr=u.Uparrow=re(_e,"\\Uparrow ","&uArr;"),u.to=re(Se,"\\to ","&rarr;"),u.rarr=u.rightarrow=re(_e,"\\rightarrow ","&rarr;"),u.implies=re(Se,"\\Rightarrow ","&rArr;"),u.rArr=u.Rightarrow=re(_e,"\\Rightarrow ","&rArr;"),u.gets=re(Se,"\\gets ","&larr;"),u.larr=u.leftarrow=re(_e,"\\leftarrow ","&larr;"),u.impliedby=re(Se,"\\Leftarrow ","&lArr;"),u.lArr=u.Leftarrow=re(_e,"\\Leftarrow ","&lArr;"),u.harr=u.lrarr=u.leftrightarrow=re(_e,"\\leftrightarrow ","&harr;"),u.iff=re(Se,"\\Leftrightarrow ","&hArr;"),u.hArr=u.lrArr=u.Leftrightarrow=re(_e,"\\Leftrightarrow ","&hArr;"),u.Re=u.Real=u.real=re(_e,"\\Re ","&real;"),u.Im=u.imag=u.image=u.imagin=u.imaginary=u.Imaginary=re(_e,"\\Im ","&image;"),u.part=u.partial=re(_e,"\\partial ","&part;"),u.infty=u.infin=u.infinity=re(_e,"\\infty ","&infin;"),u.alef=u.alefsym=u.aleph=u.alephsym=re(_e,"\\aleph ","&alefsym;"),u.xist=u.xists=u.exist=u.exists=re(_e,"\\exists ","&exist;"),u.nexists=u.nexist=re(_e,"\\nexists ","&#8708;"),u.and=u.land=u.wedge=re(Se,"\\wedge ","&and;"),u.or=u.lor=u.vee=re(Se,"\\vee ","&or;"),u.o=u.O=u.empty=u.emptyset=u.oslash=u.Oslash=u.nothing=u.varnothing=re(Se,"\\varnothing ","&empty;"),u.cup=u.union=re(Se,"\\cup ","&cup;"),u.cap=u.intersect=u.intersection=re(Se,"\\cap ","&cap;"),u.deg=u.degree=re(_e,"\\degree ","&deg;"),u.ang=u.angle=re(_e,"\\angle ","&ang;"),u.measuredangle=re(_e,"\\measuredangle ","&#8737;"),Be=m(_e,function(s,r){s.createLeftOf=function(e){e.options.autoSubscriptNumerals&&e.parent!==e.parent.parent.sub&&(e[le]instanceof Me&&!1!==e[le].isItalic||e[le]instanceof Ut&&e[le][le]instanceof Me&&!1!==e[le][le].isItalic)?(u._().createLeftOf(e),r.createLeftOf.call(this,e),e.insRightOf(e.parent.parent)):r.createLeftOf.call(this,e)}}),Me=m(Ce,function(s,r){s.init=function(e,t){r.init.call(this,e,"<var>"+(t||e)+"</var>")},s.text=function(){var e=this.ctrlSeq;return this.isPartOfOperator?"\\"==e[0]?e=e.slice(1,e.length):" "==e[e.length-1]&&(e=e.slice(0,-1)):(!this[le]||this[le]instanceof Me||this[le]instanceof Se||"\\ "===this[le].ctrlSeq||(e="*"+e),!this[oe]||this[oe]instanceof Se||this[oe]instanceof Ut||(e+="*")),e}}),we.p.autoCommands={_maxLength:0},ge.autoCommands=function(a){var t,l,o,p,d;if(!/^[a-z]+(?: [a-z]+)*$/i.test(a))throw"\""+a+"\" not a space-delimited list of only letters";for(t=a.split(" "),l={},o=0,p=0;p<t.length;p+=1){if(d=t[p],2>d.length)throw"autocommand \""+d+"\" not minimum length of 2";if(u[d]===$e)throw"\""+d+"\" is a built-in operator name";l[d]=1,o=zt(o,d.length)}return l._maxLength=o,l},ze=m(Me,function(s,a){function e(e){return!e||e instanceof Se||e instanceof Wt}s.init=function(e){return a.init.call(this,this.letter=e)},s.createLeftOf=function(e){var t,l,p,d,c;if(a.createLeftOf.apply(this,arguments),t=e.options.autoCommands,l=t._maxLength,0<l){for(p="",d=this,c=0;d instanceof ze&&d.ctrlSeq===d.letter&&c<l;){p=d.letter+p,d=d[le],c+=1}for(;p.length;){if(t.hasOwnProperty(p)){for(c=1,d=this;c<p.length;c+=1,d=d[le]){}return ce(d,this).remove(),e[le]=d[le],u[p](p).createLeftOf(e)}p=p.slice(1)}}},s.italicize=function(e){return this.isItalic=e,this.isPartOfOperator=!e,this.jQ.toggleClass("mq-operator-name",!e),this},s.finalizeTree=s.siblingDeleted=s.siblingCreated=function(s,t){t!==le&&this[oe]instanceof ze||this.autoUnItalicize(s)},s.autoUnItalicize=function(n){var t,m,w,g,q,b,x,y,O,v,Q,j,k=n.autoOperatorNames;if(0!==k._maxLength){for(t=this.letter,m=this[le];m instanceof ze;m=m[le]){t=m.letter+t}for(w=this[oe];w instanceof ze;w=w[oe]){t+=w.letter}ce(m[oe]||this.parent.ends[le],w[le]||this.parent.ends[oe]).each(function(e){e.italicize(!0).jQ.removeClass("mq-first mq-last mq-followed-by-supsub"),e.ctrlSeq=e.letter});t:for(g=0,q=m[oe]||this.parent.ends[le];g<t.length;g+=1,q=q[oe]){for(b=It(k._maxLength,t.length-g);0<b;b-=1){if(x=t.slice(g,g+b),k.hasOwnProperty(x)){for(y=0,O=q;y<b;y+=1,O=O[oe]){O.italicize(!1),v=O}Q=Fe.hasOwnProperty(x),q.ctrlSeq=(Q?"\\":"\\operatorname{")+q.ctrlSeq,v.ctrlSeq+=Q?" ":"}",Pe.hasOwnProperty(x)&&v[le][le][le].jQ.addClass("mq-last"),e(q[le])||q.jQ.addClass("mq-first"),e(v[oe])||(v[oe]instanceof Ut?(j=v[oe],(j.siblingCreated=j.siblingDeleted=function(){j.jQ.toggleClass("mq-after-operator-name",!(j[oe]instanceof Xt))})()):v.jQ.toggleClass("mq-last",!(v[oe]instanceof Xt))),g+=b-1,q=v;continue t}}}}}}),Fe={},Ne=we.p.autoOperatorNames={_maxLength:9},Pe={limsup:1,liminf:1,projlim:1,injlim:1},function(){var r,a,l,o,p=["arg","deg","det","dim","exp","gcd","hom","inf","ker","lg","lim","ln","log","max","min","sup","limsup","liminf","injlim","projlim","Pr"];for(r=0;r<p.length;r+=1){Fe[p[r]]=Ne[p[r]]=1}for(a=["sin","cos","tan","arcsin","arccos","arctan","sinh","cosh","tanh","sec","csc","cot","coth"],r=0;r<a.length;r+=1){Fe[a[r]]=1}for(l=["sin","cos","tan","sec","cosec","csc","cotan","cot","ctg"],r=0;r<l.length;r+=1){Ne[l[r]]=Ne["arc"+l[r]]=Ne[l[r]+"h"]=Ne["ar"+l[r]+"h"]=Ne["arc"+l[r]+"h"]=1}for(o=["gcf","hcf","lcm","proj","span"],r=0;r<o.length;r+=1){Ne[o[r]]=1}}(),ge.autoOperatorNames=function(a){var t,l,o,p,d;if(!/^[a-z]+(?: [a-z]+)*$/i.test(a))throw"\""+a+"\" not a space-delimited list of only letters";for(t=a.split(" "),l={},o=0,p=0;p<t.length;p+=1){if(d=t[p],2>d.length)throw"\""+d+"\" not minimum length of 2";l[d]=1,o=zt(o,d.length)}return l._maxLength=o,l},$e=m(Ce,function(e){e.init=function(e){this.ctrlSeq=e},e.createLeftOf=function(s){var t,r=this.ctrlSeq;for(t=0;t<r.length;t+=1){ze(r.charAt(t)).createLeftOf(s)}},e.parser=function(){var s,r=this.ctrlSeq,e=De();for(s=0;s<r.length;s+=1){ze(r.charAt(s)).adopt(e,e.ends[oe],0)}return ve.succeed(e.children())}});for(Ue in Ne){Ne.hasOwnProperty(Ue)&&(u[Ue]=$e)}u.operatorname=m(Te,function(t){t.createLeftOf=ee,t.numBlocks=function(){return 1},t.parser=function(){return je.block.map(function(e){return e.children()})}}),u.f=m(ze,function(s,r){s.init=function(){Ce.p.init.call(this,this.letter="f","<var class=\"mq-f\">f</var>")},s.italicize=function(e){return this.jQ.html("f").toggleClass("mq-f",e),r.italicize.apply(this,arguments)}}),u[" "]=u.space=re(_e,"\\ ","&nbsp;"),u["'"]=u.prime=re(_e,"'","&prime;"),u["\u2033"]=u.dprime=re(_e,"\u2033","&Prime;"),u.backslash=re(_e,"\\backslash ","\\"),f["\\"]||(f["\\"]=u.backslash),u.$=re(_e,"\\$","$"),We=m(Ce,function(s,r){s.init=function(e,t){r.init.call(this,e,"<span class=\"mq-nonSymbola\">"+(t||e)+"</span>")}}),u["@"]=We,u["&"]=re(We,"\\&","&amp;"),u["%"]=re(We,"\\%","%"),u.alpha=u.beta=u.gamma=u.delta=u.zeta=u.eta=u.theta=u.iota=u.kappa=u.mu=u.nu=u.xi=u.rho=u.sigma=u.tau=u.chi=u.psi=u.omega=m(Me,function(s,r){s.init=function(e){r.init.call(this,"\\"+e+" ","&"+e+";")}}),u.phi=re(Me,"\\phi ","&#981;"),u.phiv=u.varphi=re(Me,"\\varphi ","&phi;"),u.epsilon=re(Me,"\\epsilon ","&#1013;"),u.epsiv=u.varepsilon=re(Me,"\\varepsilon ","&epsilon;"),u.piv=u.varpi=re(Me,"\\varpi ","&piv;"),u.sigmaf=u.sigmav=u.varsigma=re(Me,"\\varsigma ","&sigmaf;"),u.thetav=u.vartheta=u.thetasym=re(Me,"\\vartheta ","&thetasym;"),u.upsilon=u.upsi=re(Me,"\\upsilon ","&upsilon;"),u.gammad=u.Gammad=u.digamma=re(Me,"\\digamma ","&#989;"),u.kappav=u.varkappa=re(Me,"\\varkappa ","&#1008;"),u.rhov=u.varrho=re(Me,"\\varrho ","&#1009;"),u.pi=u.π=re(We,"\\pi ","&pi;"),u.lambda=re(We,"\\lambda ","&lambda;"),u.Upsilon=u.Upsi=u.upsih=u.Upsih=re(Ce,"\\Upsilon ","<var style=\"font-family: serif\">&upsih;</var>"),u.Gamma=u.Delta=u.Theta=u.Lambda=u.Xi=u.Pi=u.Sigma=u.Phi=u.Psi=u.Omega=u.forall=m(_e,function(s,r){s.init=function(e){r.init.call(this,"\\"+e+" ","&"+e+";")}}),He=m(Te,function(e){e.init=function(e){this.latex=e},e.createLeftOf=function(s){var t=je.parse(this.latex);t.children().adopt(s.parent,s[le],s[oe]),s[le]=t.ends[oe],t.jQize().insertBefore(s.jQ),t.finalizeInsert(s.options,s),t.ends[oe][oe].siblingCreated&&t.ends[oe][oe].siblingCreated(s.options,le),t.ends[le][le].siblingCreated&&t.ends[le][le].siblingCreated(s.options,oe),s.parent.bubble("reflow")},e.parser=function(){var e=je.parse(this.latex).children();return ve.succeed(e)}}),u["\xB9"]=re(He,"^1"),u["\xB2"]=re(He,"^2"),u["\xB3"]=re(He,"^3"),u["\xBC"]=re(He,"\\frac14"),u["\xBD"]=re(He,"\\frac12"),u["\xBE"]=re(He,"\\frac34"),Ve=m(Se,function(e){e.init=_e.prototype.init,e.contactWeld=e.siblingCreated=e.siblingDeleted=function(s,t){function e(s){return s[le]?s[le]instanceof Se||/^[,;:\(\[]$/.test(s[le].ctrlSeq)?"":"mq-binary-operator":s.parent&&s.parent.parent&&s.parent.parent.isStyleBlock()?e(s.parent.parent):""}if(t!==oe)return this.jQ[0].className=e(this),this}}),u["+"]=re(Ve,"+","+"),u["\u2013"]=u["-"]=re(Ve,"-","&minus;"),u["\xB1"]=u.pm=u.plusmn=u.plusminus=re(Ve,"\\pm ","&plusmn;"),u.mp=u.mnplus=u.minusplus=re(Ve,"\\mp ","&#8723;"),f["*"]=u.sdot=u.cdot=re(Se,"\\cdot ","&middot;","*"),Ge=m(Se,function(s,r){s.init=function(e,t){this.data=e,this.strict=t;var s=t?"Strict":"";r.init.call(this,e["ctrlSeq"+s],e["html"+s],e["text"+s])},s.swap=function(s){this.strict=s;var t=s?"Strict":"";this.ctrlSeq=this.data["ctrlSeq"+t],this.jQ.html(this.data["html"+t]),this.textTemplate=[this.data["text"+t]]},s.deleteTowards=function(e){if(e===le&&!this.strict)return this.swap(!0),void this.bubble("reflow");r.deleteTowards.apply(this,arguments)}}),Ke={ctrlSeq:"\\le ",html:"&le;",text:"\u2264",ctrlSeqStrict:"<",htmlStrict:"&lt;",textStrict:"<"},Ye={ctrlSeq:"\\ge ",html:"&ge;",text:"\u2265",ctrlSeqStrict:">",htmlStrict:"&gt;",textStrict:">"},u["<"]=u.lt=re(Ge,Ke,!0),u[">"]=u.gt=re(Ge,Ye,!0),u["\u2264"]=u.le=u.leq=re(Ge,Ke,!1),u["\u2265"]=u.ge=u.geq=re(Ge,Ye,!1),Xe=m(Se,function(s,r){s.init=function(){r.init.call(this,"=","=")},s.createLeftOf=function(e){if(e[le]instanceof Ge&&e[le].strict)return e[le].swap(!1),void e[le].bubble("reflow");r.createLeftOf.apply(this,arguments)}}),u["="]=Xe,u["\xD7"]=u.times=re(Se,"\\times ","&times;","[x]"),u["\xF7"]=u.div=u.divide=u.divides=re(Se,"\\div ","&divide;","[/]"),f["~"]=u.sim=re(Se,"\\sim ","~","~"),Je=ee,Rt=document.createElement("div"),Bt=Rt.style,Ft={transform:1,WebkitTransform:1,MozTransform:1,OTransform:1,msTransform:1};for(Pt in Ft){if(Pt in Bt){Nt=Pt;break}}Nt?Ze=function(s,t,e){s.css(Nt,"scale("+t+","+e+")")}:"filter"in Bt?(Je=function(e){e.className=e.className},Ze=function(a,t,l){function n(){a.css("marginRight",(i.width()-1)*(t-1)/t+"px")}var i,o;t/=1+(l-1)/2,a.css("fontSize",l+"em"),a.hasClass("mq-matrixed-container")||a.addClass("mq-matrixed-container").wrapInner("<span class=\"mq-matrixed\"></span>"),i=a.children().css("filter","progid:DXImageTransform.Microsoft.Matrix(M11="+t+",SizingMethod='auto expand')"),n(),o=setInterval(n),pe(window).load(function(){clearTimeout(o),n()})}):Ze=function(s,t,e){s.css("fontSize",e+"em")},$t=m(Te,function(s,r){s.init=function(e,t,s){r.init.call(this,e,"<"+t+" "+s+">&0</"+t+">")}}),u.mathrm=re($t,"\\mathrm","span","class=\"mq-roman mq-font\""),u.mathit=re($t,"\\mathit","i","class=\"mq-font\""),u.mathbf=re($t,"\\mathbf","b","class=\"mq-font\""),u.mathsf=re($t,"\\mathsf","span","class=\"mq-sans-serif mq-font\""),u.mathtt=re($t,"\\mathtt","span","class=\"mq-monospace mq-font\""),u.underline=re($t,"\\underline","span","class=\"mq-non-leaf mq-underline\""),u.overline=u.bar=re($t,"\\overline","span","class=\"mq-non-leaf mq-overline\""),u.overrightarrow=re($t,"\\overrightarrow","span","class=\"mq-non-leaf mq-overarrow mq-arrow-right\""),u.overleftarrow=re($t,"\\overleftarrow","span","class=\"mq-non-leaf mq-overarrow mq-arrow-left\""),u.overleftrightarrow=re($t,"\\overleftrightarrow","span","class=\"mq-non-leaf mq-overarrow mq-arrow-both\""),u.overarc=re($t,"\\overarc","span","class=\"mq-non-leaf mq-overarc\""),u.dot=m(Te,function(s,t){s.init=function(){t.init.call(this,"\\dot","<span class=\"mq-non-leaf\"><span class=\"mq-dot-recurring-inner\"><span class=\"mq-dot-recurring\">&#x2d9;</span><span class=\"mq-empty-box\">&0</span></span></span>")}}),u.textcolor=m(Te,function(s,r){s.setColor=function(e){this.color=e,this.htmlTemplate="<span class=\"mq-textcolor\" style=\"color:"+e+"\">&0</span>"},s.latex=function(){return"\\textcolor{"+this.color+"}{"+this.blocks[0].latex()+"}"},s.parser=function(){var e=this,t=ve.optWhitespace,n=ve.string,a=ve.regex;return t.then(n("{")).then(a(/^[#\w\s.,()%-]*/)).skip(n("}")).then(function(t){return e.setColor(t),r.parser.call(e)})},s.isStyleBlock=function(){return!0}}),u.class=m(Te,function(s,r){s.parser=function(){var e=this,t=ve.string,s=ve.regex;return ve.optWhitespace.then(t("{")).then(s(/^[-\w\s\\\xA0-\xFF]*/)).skip(t("}")).then(function(t){return e.cls=t||"",e.htmlTemplate="<span class=\"mq-class "+t+"\">&0</span>",r.parser.call(e)})},s.latex=function(){return"\\class{"+this.cls+"}{"+this.blocks[0].latex()+"}"},s.isStyleBlock=function(){return!0}}),Ut=m(Te,function(s,r){s.ctrlSeq="_{...}^{...}",s.createLeftOf=function(e){if(this.replacedFragment||e[le]||!e.options.supSubsRequireOperand)return r.createLeftOf.apply(this,arguments)},s.contactWeld=function(a){var l,t,p,d,c,m;for(l=le;l;l=l===le&&oe){if(this[l]instanceof Ut){for(t="sub";t;t="sub"===t&&"sup"){p=this[t],d=this[l][t],p&&(d?p.isEmpty()?m=h(d,0,d.ends[le]):(p.jQ.children().insAtDirEnd(-l,d.jQ),c=p.children().disown(),m=h(d,c.ends[oe],d.ends[le]),l===le?c.adopt(d,d.ends[oe],0):c.adopt(d,0,d.ends[le])):this[l].addBlock(p.disown()),this.placeCursor=function(e,t){return function(s){s.insAtDirEnd(-l,e||t)}}(d,p))}this.remove(),a&&a[le]===this&&(l===oe&&m?m[le]?a.insRightOf(m[le]):a.insAtLeftEnd(m.parent):a.insRightOf(this[l]));break}}},we.p.charsThatBreakOutOfSupSub="",s.finalizeTree=function(){this.ends[le].write=function(s,t){if(s.options.autoSubscriptNumerals&&this===this.parent.sub){if("_"===t)return;var e=this.chToCmd(t,s.options);return e instanceof Ce?s.deleteSelection():s.clearSelection().insRightOf(this.parent),e.createLeftOf(s.show())}s[le]&&!s[oe]&&!s.selection&&-1<s.options.charsThatBreakOutOfSupSub.indexOf(t)&&s.insRightOf(this.parent),De.p.write.apply(this,arguments)}},s.moveTowards=function(e,t){t.options.autoSubscriptNumerals&&!this.sup?t.insDirOf(e,this):r.moveTowards.apply(this,arguments)},s.deleteTowards=function(e,t){if(t.options.autoSubscriptNumerals&&this.sub){var s=this.sub.ends[-e];s instanceof Ce?s.remove():s&&s.deleteTowards(e,t.insAtDirEnd(-e,this.sub)),this.sub.isEmpty()&&(this.sub.deleteOutOf(le,t.insAtLeftEnd(this.sub)),this.sup&&t.insDirOf(-e,this))}else r.deleteTowards.apply(this,arguments)},s.latex=function(){function e(s,t){var e=t&&t.latex();return t?s+(1===e.length?e:"{"+(e||" ")+"}"):""}return e("_",this.sub)+e("^",this.sup)},s.addBlock=function(s){"sub"===this.supsub?(this.sup=this.upInto=this.sub.upOutOf=s,s.adopt(this,this.sub,0).downOutOf=this.sub,s.jQ=pe("<span class=\"mq-sup\"/>").append(s.jQ.children()).attr("mathquill-block-id",s.id).prependTo(this.jQ)):(this.sub=this.downInto=this.sup.downOutOf=s,s.adopt(this,0,this.sup).upOutOf=this.sup,s.jQ=pe("<span class=\"mq-sub\"></span>").append(s.jQ.children()).attr("mathquill-block-id",s.id).appendTo(this.jQ.removeClass("mq-sup-only")),this.jQ.append("<span style=\"display:inline-block;width:0\">&#8203;</span>"));for(var t=0;2>t;t+=1){!function(a,t,e,n){a[t].deleteOutOf=function(i,s){if(s.insDirOf(this[i]?-i:i,this.parent),!this.isEmpty()){var r=this.ends[i];this.children().disown().withDirAdopt(i,s.parent,s[i],s[-i]).jQ.insDirOf(-i,s.jQ),s[-i]=r}a.supsub=e,delete a[t],delete a[n+"Into"],a[e][n+"OutOf"]=l,delete a[e].deleteOutOf,"sub"===t&&pe(a.jQ.addClass("mq-sup-only")[0].lastChild).remove(),this.remove()}}(this,["sub","sup"][t],["sup","sub"][t],["down","up"][t])}}}),u.subscript=u._=m(Ut,function(s,t){s.supsub="sub",s.htmlTemplate="<span class=\"mq-supsub mq-non-leaf\"><span class=\"mq-sub\">&0</span><span style=\"display:inline-block;width:0\">&#8203;</span></span>",s.textTemplate=["_"],s.finalizeTree=function(){this.downInto=this.sub=this.ends[le],this.sub.upOutOf=l,t.finalizeTree.call(this)}}),u.superscript=u.supscript=u["^"]=m(Ut,function(s,t){s.supsub="sup",s.htmlTemplate="<span class=\"mq-supsub mq-non-leaf mq-sup-only\"><span class=\"mq-sup\">&0</span></span>",s.textTemplate=["^"],s.finalizeTree=function(){this.upInto=this.sup=this.ends[oe],this.sup.downOutOf=l,t.finalizeTree.call(this)},s.reflow=function(){var s=this.jQ,t=s.prev().innerHeight();t*=.6,s.css("vertical-align",t+"px")}}),Wt=m(Te,function(s,r){s.init=function(s,t){Ce.prototype.init.call(this,s,"<span class=\"mq-large-operator mq-non-leaf\"><span class=\"mq-to\"><span>&1</span></span><big>"+t+"</big><span class=\"mq-from\"><span>&0</span></span></span>")},s.createLeftOf=function(e){r.createLeftOf.apply(this,arguments),e.options.sumStartsWithNEquals&&(ze("n").createLeftOf(e),Xe().createLeftOf(e))},s.latex=function(){function e(e){return 1===e.length?e:"{"+(e||" ")+"}"}return this.ctrlSeq+"_"+e(this.ends[le].latex())+"^"+e(this.ends[oe].latex())},s.parser=function(){var a,l=ve.string,e=ve.optWhitespace,n=ve.succeed,i=je.block,s=this,r=s.blocks=[De(),De()];for(a=0;a<r.length;a+=1){r[a].adopt(s,s.ends[oe],0)}return e.then(l("_").or(l("^"))).then(function(a){var l=r["_"===a?0:1];return i.then(function(e){return e.children().adopt(l,l.ends[oe],0),n(s)})}).many().result(s)},s.finalizeTree=function(){this.downInto=this.ends[le],this.upInto=this.ends[oe],this.ends[le].upOutOf=this.ends[oe],this.ends[oe].downOutOf=this.ends[le]}}),u["\u2211"]=u.sum=u.summation=re(Wt,"\\sum ","&sum;"),u["\u220F"]=u.prod=u.product=re(Wt,"\\prod ","&prod;"),u.coprod=u.coproduct=re(Wt,"\\coprod ","&#8720;"),u["\u222B"]=u.int=u.integral=m(Wt,function(e){e.init=function(){Ce.prototype.init.call(this,"\\int ","<span class=\"mq-int mq-non-leaf\"><big>&int;</big><span class=\"mq-supsub mq-non-leaf\"><span class=\"mq-sup\"><span class=\"mq-sup-inner\">&1</span></span><span class=\"mq-sub\">&0</span><span style=\"display:inline-block;width:0\">&#8203</span></span></span>")},e.createLeftOf=Te.p.createLeftOf}),Ht=u.frac=u.dfrac=u.cfrac=u.fraction=m(Te,function(e){e.ctrlSeq="\\frac",e.htmlTemplate="<span class=\"mq-fraction mq-non-leaf\"><span class=\"mq-numerator\">&0</span><span class=\"mq-denominator\">&1</span><span style=\"display:inline-block;width:0\">&#8203;</span></span>",e.textTemplate=["(",")/(",")"],e.finalizeTree=function(){this.upInto=this.ends[oe].upOutOf=this.ends[le],this.downInto=this.ends[le].downOutOf=this.ends[oe]}}),Vt=u.over=f["/"]=m(Ht,function(t,s){t.createLeftOf=function(t){if(!this.replacedFragment){for(var e=t[le];e&&!(e instanceof Se||e instanceof(u.text||ee)||e instanceof Wt||"\\ "===e.ctrlSeq||/^[,;:]$/.test(e.ctrlSeq));){e=e[le]}e instanceof Wt&&e[oe]instanceof Ut&&(e=e[oe],e[oe]instanceof Ut&&e[oe].ctrlSeq!=e.ctrlSeq&&(e=e[oe])),e!==t[le]&&(this.replaces(ce(e[oe]||t.parent.ends[le],t[le])),t[le]=e)}s.createLeftOf.call(this,t)}}),Gt=u.sqrt=u["\u221A"]=m(Te,function(s,t){s.ctrlSeq="\\sqrt",s.htmlTemplate="<span class=\"mq-non-leaf\"><span class=\"mq-scaled mq-sqrt-prefix\">&radic;</span><span class=\"mq-non-leaf mq-sqrt-stem\">&0</span></span>",s.textTemplate=["sqrt(",")"],s.parser=function(){return je.optBlock.then(function(s){return je.block.map(function(t){var e=Kt();return e.blocks=[s,t],s.adopt(e,0,0),t.adopt(e,s,0),e})}).or(t.parser.call(this))},s.reflow=function(){var e=this.ends[oe].jQ;Ze(e.prev(),1,e.innerHeight()/+e.css("fontSize").slice(0,-2)-.1)}}),u.hat=m(Te,function(e){e.ctrlSeq="\\hat",e.htmlTemplate="<span class=\"mq-non-leaf\"><span class=\"mq-hat-prefix\">^</span><span class=\"mq-hat-stem\">&0</span></span>",e.textTemplate=["hat(",")"]}),Kt=u.nthroot=m(Gt,function(e){e.htmlTemplate="<sup class=\"mq-nthroot mq-non-leaf\">&0</sup><span class=\"mq-scaled\"><span class=\"mq-sqrt-prefix mq-scaled\">&radic;</span><span class=\"mq-sqrt-stem mq-non-leaf\">&1</span></span>",e.textTemplate=["sqrt[","](",")"],e.latex=function(){return"\\sqrt["+this.ends[le].latex()+"]{"+this.ends[oe].latex()+"}"}}),Yt=m(Te,function(s,r){s.init=function(e,t,s){r.init.call(this,e,"<span class=\"mq-non-leaf\"><span class=\"mq-diacritic-above\">"+t+"</span><span class=\"mq-diacritic-stem\">&0</span></span>",s)}}),u.vec=re(Yt,"\\vec","&rarr;",["vec(",")"]),u.tilde=re(Yt,"\\tilde","~",["tilde(",")"]),Xt=m(m(Te,i),function(t,a){t.init=function(n,t,e,i,s){a.init.call(this,"\\left"+i,p,[t,e]),this.side=n,this.sides={},this.sides[le]={ch:t,ctrlSeq:i},this.sides[oe]={ch:e,ctrlSeq:s}},t.numBlocks=function(){return 1},t.html=function(){return this.htmlTemplate="<span class=\"mq-non-leaf\"><span class=\"mq-scaled mq-paren"+(this.side===oe?" mq-ghost":"")+"\">"+this.sides[le].ch+"</span><span class=\"mq-non-leaf\">&0</span><span class=\"mq-scaled mq-paren"+(this.side===le?" mq-ghost":"")+"\">"+this.sides[oe].ch+"</span></span>",a.html.call(this)},t.latex=function(){return"\\left"+this.sides[le].ctrlSeq+this.ends[le].latex()+"\\right"+this.sides[oe].ctrlSeq},t.matchBrack=function(s,t,e){return e instanceof Xt&&e.side&&e.side!==-t&&(!s.restrictMismatchedBrackets||Zt[this.sides[this.side].ch]===e.sides[e.side].ch||{"(":"]","[":")"}[this.sides[le].ch]===e.sides[oe].ch)&&e},t.closeOpposing=function(e){e.side=0,e.sides[this.side]=this.sides[this.side],e.delimjQs.eq(this.side===le?0:1).removeClass("mq-ghost").html(this.sides[this.side].ch)},t.createLeftOf=function(r){var t,n,l;this.replacedFragment||(t=r.options,n="|"===this.sides[le].ch?this.matchBrack(t,oe,r[oe])||this.matchBrack(t,le,r[le])||this.matchBrack(t,0,r.parent.parent):this.matchBrack(t,-this.side,r[-this.side])||this.matchBrack(t,-this.side,r.parent.parent)),n?(l=this.side=-n.side,this.closeOpposing(n),n===r.parent.parent&&r[l]&&ce(r[l],r.parent.ends[l],-l).disown().withDirAdopt(-l,n.parent,n,n[l]).jQ.insDirOf(l,n.jQ),n.bubble("reflow")):(n=this,l=n.side,n.replacedFragment?n.side=0:r[-l]&&(n.replaces(ce(r[-l],r.parent.ends[-l],l)),r[-l]=0),a.createLeftOf.call(n,r)),l===le?r.insAtLeftEnd(n.ends[le]):r.insRightOf(n)},t.placeCursor=ee,t.unwrap=function(){this.ends[le].children().disown().adopt(this.parent,this,this[oe]).jQ.insertAfter(this.jQ),this.remove()},t.deleteSide=function(p,t,e){var n,d,c,m=this.parent,o=this[p],a=m.ends[p];if(p===this.side)return this.unwrap(),void(o?e.insDirOf(-p,o):e.insAtDirEnd(p,m));if(n=e.options,d=!this.side,this.side=-p,this.matchBrack(n,p,this.ends[le].ends[this.side]))this.closeOpposing(this.ends[le].ends[this.side]),c=this.ends[le].ends[p],this.unwrap(),c.siblingCreated&&c.siblingCreated(e.options,p),o?e.insDirOf(-p,o):e.insAtDirEnd(p,m);else{if(this.matchBrack(n,p,this.parent.parent))this.parent.parent.closeOpposing(this),this.parent.parent.unwrap();else{if(t&&d)return this.unwrap(),void(o?e.insDirOf(-p,o):e.insAtDirEnd(p,m));this.sides[p]={ch:Zt[this.sides[this.side].ch],ctrlSeq:Zt[this.sides[this.side].ctrlSeq]},this.delimjQs.removeClass("mq-ghost").eq(p===le?0:1).addClass("mq-ghost").html(this.sides[p].ch)}o?(c=this.ends[le].ends[p],ce(o,a,-p).disown().withDirAdopt(-p,this.ends[le],c,0).jQ.insAtDirEnd(p,this.ends[le].jQ.removeClass("mq-empty")),c.siblingCreated&&c.siblingCreated(e.options,p),e.insDirOf(-p,o)):t?e.insDirOf(p,this):e.insAtDirEnd(p,this.ends[le])}},t.deleteTowards=function(s,t){this.deleteSide(-s,!1,t)},t.finalizeTree=function(){this.ends[le].deleteOutOf=function(s,t){this.parent.deleteSide(s,!0,t)},this.finalizeTree=this.intentionalBlur=function(){this.delimjQs.eq(this.side===le?1:0).removeClass("mq-ghost"),this.side=0}},t.siblingCreated=function(s,t){t===-this.side&&this.finalizeTree()}}),Zt={"(":")",")":"(","[":"]","]":"[","{":"}","}":"{","\\{":"\\}","\\}":"\\{","&lang;":"&rang;","&rang;":"&lang;","\\langle ":"\\rangle ","\\rangle ":"\\langle ","|":"|","\\lVert ":"\\rVert ","\\rVert ":"\\lVert "},o("("),o("["),o("{","\\{"),u.langle=re(Xt,le,"&lang;","&rang;","\\langle ","\\rangle "),u.rangle=re(Xt,oe,"&lang;","&rang;","\\langle ","\\rangle "),f["|"]=re(Xt,le,"|","|","|","|"),u.lVert=re(Xt,le,"&#8741;","&#8741;","\\lVert ","\\rVert "),u.rVert=re(Xt,oe,"&#8741;","&#8741;","\\lVert ","\\rVert "),u.left=m(Te,function(e){e.parser=function(){var a=ve.regex,t=ve.string,e=(ve.succeed,ve.optWhitespace);return e.then(a(/^(?:[([|]|\\\{|\\langle\b|\\lVert\b)/)).then(function(l){var o="\\"===l.charAt(0)?l.slice(1):l;return"\\langle"==l&&(o="&lang;",l+=" "),"\\lVert"==l&&(o="&#8741;",l+=" "),je.then(function(s){return t("\\right").skip(e).then(a(/^(?:[\])|]|\\\}|\\rangle\b|\\rVert\b)/)).map(function(r){var a,i="\\"===r.charAt(0)?r.slice(1):r;return"\\rangle"==r&&(i="&rang;",r+=" "),"\\rVert"==r&&(i="&#8741;",r+=" "),a=Xt(0,o,i,l,r),a.blocks=[s],s.adopt(a,0,0),a})})})}}),u.right=m(Te,function(e){e.parser=function(){return ve.fail("unmatched \\right")}}),Jt=u.binom=u.binomial=m(m(Te,i),function(e){e.ctrlSeq="\\binom",e.htmlTemplate="<span class=\"mq-non-leaf\"><span class=\"mq-paren mq-scaled\">(</span><span class=\"mq-non-leaf\"><span class=\"mq-array mq-non-leaf\"><span>&0</span><span>&1</span></span></span><span class=\"mq-paren mq-scaled\">)</span></span>",e.textTemplate=["choose(",",",")"]}),u.choose=m(Jt,function(e){e.createLeftOf=Vt.prototype.createLeftOf}),u.editable=u.MathQuillMathField=m(Te,function(s,r){s.ctrlSeq="\\MathQuillMathField",s.htmlTemplate="<span class=\"mq-editable-field\"><span class=\"mq-root-block\">&0</span></span>",s.parser=function(){var a=this,e=ve.string,t=ve.regex,n=ve.succeed;return e("[").then(t(/^[a-z][a-z0-9]*/i)).skip(e("]")).map(function(t){a.name=t}).or(n()).then(r.parser.call(a))},s.finalizeTree=function(s){var t=he(this.ends[le],this.jQ,s);t.KIND_OF_MQ="MathField",t.editable=!0,t.createTextarea(),t.editablesTextareaEvents(),t.cursor.insAtRightEnd(t.root),n(t.root)},s.registerInnerField=function(s,t){s.push(s[this.name]=t(this.ends[le].controller))},s.latex=function(){return this.ends[le].latex()},s.text=function(){return this.ends[le].text()}}),es=u.embed=m(Ce,function(e){e.setOptions=function(s){function t(){return""}return this.text=s.text||t,this.htmlTemplate=s.htmlString||"",this.latex=s.latex||t,this},e.parser=function(){var r=this,t=ve.string,e=ve.regex,n=ve.succeed;return t("{").then(e(/^[a-z][a-z0-9]*/i)).skip(t("}")).then(function(a){return t("[").then(e(/^[-\w\s]*/)).skip(t("]")).or(n()).map(function(t){return r.setOptions(be[a](t))})})}}),ts=e(1);for(ss in ts){!function(n,t){"function"==typeof t?(r[n]=function(){return s(),t.apply(this,arguments)},r[n].prototype=t.prototype):r[n]=t}(ss,ts[ss])}}();return MathQuill});
//# sourceMappingURL=mathquill.min.js.map
