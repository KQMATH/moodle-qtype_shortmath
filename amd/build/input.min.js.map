{"version":3,"sources":["../src/input.js"],"names":["initialize","inputname","readonly","questionId","readOnly","shortanswerInput","document","querySelector","classList","remove","$parent","parentElement","input","VisualMath","Input","$input","style","visibility","onEdit","field","value","latex","dispatchEvent","Event","disabled","length","write","Ajax","call","methodname","args","done","response","controlsWrapper","closest","controls","ControlList","template","JSON","parse","defineDefault","forEach","html","command","define","enableAll","fail","notification","exception"],"mappings":"oNAuBA,OACA,OACA,O,mDAEO,GAAMA,CAAAA,CAAU,CAAG,SAACC,CAAD,CAAYC,CAAZ,CAAsBC,CAAtB,CAAqC,IACvDC,CAAAA,CAAQ,CAAGF,CAD4C,CAEvDG,CAAgB,CAAGC,QAAQ,CAACC,aAAT,YAA2BN,CAA3B,EAFoC,CAI3DI,CAAgB,CAACG,SAAjB,CAA2BC,MAA3B,CAAkC,UAAlC,EAJ2D,GAKvDC,CAAAA,CAAO,CAAGL,CAAgB,CAACM,aAL4B,CAOvDC,CAAK,CAAG,GAAIC,WAAWC,KAAf,CAAqBT,CAArB,CAAuCK,CAAvC,CAP+C,CAS3DE,CAAK,CAACG,MAAN,CAAaC,KAAb,CAAmBC,UAAnB,CAAgC,QAAhC,CAEA,GAAI,CAACf,CAAL,CAAe,CACXU,CAAK,CAACM,MAAN,CAAe,SAAUH,CAAV,CAAkBI,CAAlB,CAAyB,CACpCJ,CAAM,CAACK,KAAP,CAAeD,CAAK,CAACE,KAAN,EAAf,CACAN,CAAM,CAACO,aAAP,CAAqB,GAAIC,CAAAA,KAAJ,CAAU,QAAV,CAArB,CACH,CAEJ,CAND,IAMO,CACHnB,CAAQ,GAAR,CACAQ,CAAK,CAACY,QAAN,GACH,CAED,GAAoC,CAAhC,CAAAnB,CAAgB,CAACe,KAAjB,CAAuBK,MAA3B,CAAuC,CACnCb,CAAK,CAACO,KAAN,CAAYO,KAAZ,CACIrB,CAAgB,CAACe,KADrB,CAGH,CAED,GAAI,CAAChB,CAAL,CAAe,CACXuB,UAAKC,IAAL,CAAU,CAAC,CACPC,UAAU,CAAE,8BADL,CAEPC,IAAI,CAAE,CACF,WAAc3B,CADZ,CAFC,CAAD,CAAV,EAKI,CALJ,EAKO4B,IALP,CAKY,SAAAC,CAAQ,CAAI,IAChBC,CAAAA,CAAe,CAAG5B,CAAgB,CAAC6B,OAAjB,CAAyB,YAAzB,EAAuC3B,aAAvC,CAAqD,mBAArD,CADF,CAEhB4B,CAAQ,CAAG,GAAItB,WAAWuB,WAAf,CAA2BH,CAA3B,CAFK,CAIhBI,CAAQ,CAAGC,IAAI,CAACC,KAAL,CAAWP,CAAQ,SAAnB,CAJK,CAKpB,GAAiB,IAAb,GAAAK,CAAJ,CAAuB,CACnBF,CAAQ,CAACK,aAAT,EACH,CAFD,IAEO,CACHH,CAAQ,CAACI,OAAT,CAAiB,SAAArB,CAAK,CAAI,IAClBsB,CAAAA,CAAI,CAAGtB,CAAK,OADM,CAElBuB,CAAO,CAAGvB,CAAK,WAFG,CAGtBe,CAAQ,CAACS,MAAT,CAAgBD,CAAhB,CAAyBD,CAAzB,CAA+B,SAAAvB,CAAK,QAAIA,CAAAA,CAAK,CAACO,KAAN,CAAYiB,CAAZ,CAAJ,CAApC,CACH,CAJD,CAKH,CAEDR,CAAQ,CAACU,SAAT,EACH,CArBD,EAqBGC,IArBH,CAqBQC,UAAaC,SArBrB,CAsBH,CACJ,CApDM,C","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n\n/**\n * @module     qtype_shortmath/input\n * @package    qtype_shortmath\n * @author     Andr√© Storhaug <andr3.storhaug@gmail.com>\n * @copyright  2018 NTNU\n */\n\nimport Ajax from \"core/ajax\";\nimport notification from \"core/notification\";\nimport VisualMath from \"qtype_shortmath/visual-math-input\";\n\nexport const initialize = (inputname, readonly, questionId) => {\n    var readOnly = readonly;\n    var shortanswerInput = document.querySelector(`#${inputname}`);\n    // Remove class \"d-inline\" added in shortanswer renderer class, which prevents input from being hidden.\n    shortanswerInput.classList.remove('d-inline');\n    var $parent = shortanswerInput.parentElement;\n\n    var input = new VisualMath.Input(shortanswerInput, $parent);\n    // TODO: display none or visibility hidden?\n    input.$input.style.visibility = \"hidden\";\n\n    if (!readonly) {\n        input.onEdit = function ($input, field) {\n            $input.value = field.latex();\n            $input.dispatchEvent(new Event('change')); // Event firing needs to be on a vanilla dom object.\n        };\n\n    } else {\n        readOnly = true;\n        input.disabled = true;\n    }\n\n    if (shortanswerInput.value.length > 0) {\n        input.field.write(\n            shortanswerInput.value\n        );\n    }\n\n    if (!readOnly) {\n        Ajax.call([{\n            methodname: 'qtype_shortmath_get_template',\n            args: {\n                'questionid': questionId\n            }\n        }])[0].done(response => {\n            var controlsWrapper = shortanswerInput.closest('.shortmath').querySelector('.controls_wrapper');\n            var controls = new VisualMath.ControlList(controlsWrapper);\n\n            let template = JSON.parse(response['template']);\n            if (template === null) {\n                controls.defineDefault();\n            } else {\n                template.forEach(value => {\n                    let html = value['button'];\n                    let command = value['expression'];\n                    controls.define(command, html, field => field.write(command));\n                });\n            }\n\n            controls.enableAll();\n        }).fail(notification.exception);\n    }\n};\n"],"file":"input.min.js"}