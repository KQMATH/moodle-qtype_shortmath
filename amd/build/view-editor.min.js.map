{"version":3,"sources":["../src/view-editor.js"],"names":["define","$","VisualMath","Templates","notification","lastFocusedInput","dragged","target","nodes","draggedIndex","EditorInput","input","parent","$textarea","on","$input","field","val","latex","get","dispatchEvent","Event","Input","EditorControl","text","onClick","$element","off","event","preventDefault","blur","console","log","focus","attr","Date","getTime","addClass","Array","from","parentNode","children","indexOf","originalEvent","dataTransfer","setData","id","dropEffect","style","opacity","removeClass","document","getElementById","replaceWith","Control","EditorControlList","wrapper","controls","$wrapper","$btnInput","$expInput","expEditorInput","html","find","remove","command","addControl","value","control","write","enable","append","push","button","expression","initialize","testInputId","btnInputId","expInputId","templateId","templateName","render","then","js","appendNodeContents","$shortanswerInput","escapeSelector","$parent","testInput","hide","change","controlsWrapper","parents","clearData","targetId","hasClass","lastChild","nodeName","targetIndex","empty","createElement","css","contains","removeChild","insertBefore","nextSibling","appendChild","buttonInput","expressionInput","$saveButton","$testBox","isDataVisible","$addButton","isSuccess","add","show","post","M","str","qtype_shortmath","editor_action_path","done","message","data","JSON","parse","forEach","addAll","bind","fail","jqXHR","textStatus","errorThrown","addNotification","type","$templateNameInput","name","trim","stringify","setTimeout","window","location","replace","editor_manager_path","deleteIcon","firstElementChild","placeholder","$backButton"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n\n/**\n * @package    qtype_shortmath\n * @author     André Storhaug <andr3.storhaug@gmail.com>\n * @copyright  2018 NTNU\n */\n\n/**\n * @module qtype_shortmath/input\n */\ndefine(['jquery', 'qtype_shortmath/visual-math-input', 'core/templates', 'core/notification'],\n    function ($, VisualMath, Templates, notification) {\n        let lastFocusedInput = null;\n        let dragged;\n        let target;\n        let nodes;\n        let draggedIndex;\n\n        class EditorInput extends VisualMath.Input {\n\n            constructor(input, parent) {\n                super(input, parent);\n                this.$textarea.on('blur', () => lastFocusedInput = this);\n            }\n\n            change() {\n                super.onEdit = ($input, field) => {\n                    $input.val(field.latex());\n                    $input.get(0).dispatchEvent(new Event('change')); // Event firing needs to be on a vanilla dom object.\n                };\n            }\n\n        }\n\n        class EditorControl extends VisualMath.Control {\n\n            constructor(text, onClick) {\n                super('', text, onClick);\n            }\n\n            enable() {\n                super.enable();\n\n                this.$element.off('click');\n                this.$element.on('click', event => {\n                    event.preventDefault();\n                    $(':focus').blur();\n                    if (lastFocusedInput !== null) {\n                        if (lastFocusedInput.field === undefined) {\n                            console.log('Plain text field');\n                            lastFocusedInput.focus();\n                            return;\n                        }\n                        this.onClick(lastFocusedInput.field);\n                        lastFocusedInput.field.focus();\n                    }\n                });\n\n                this.$element.attr('id', new Date().getTime());\n                this.$element.attr('draggable', true);\n                this.$element.addClass('p-0'); //for uniform look of the toolbar buttons\n\n                this.$element.on('dragstart', event => {\n                    dragged = event.target;\n                    nodes = Array.from(dragged.parentNode.children); //buttons on the control list\n                    draggedIndex = nodes.indexOf(dragged);\n                    // Add the target element's id to the data transfer object\n                    event.originalEvent.dataTransfer.setData(\"text\", event.target.id);\n                    event.originalEvent.dataTransfer.dropEffect = \"move\";\n                    event.target.style.opacity = 0.5;\n                    $('.delete-icon').removeClass('d-none');\n                });\n\n                this.$element.on('dragend', event => {\n                    event.target.style.opacity = \"\";\n                    $(':focus').blur();\n                    if (document.getElementById('placeholder') !== null) {\n                        document.getElementById('placeholder').replaceWith(dragged);\n                    }\n                    $('.delete-icon').addClass('d-none');\n                });\n\n            }\n\n        }\n\n        class EditorControlList {\n\n            constructor(wrapper) {\n                this.controls = [];\n                this.$wrapper = $(wrapper);\n                this.$wrapper.addClass('visual-math-input-wrapper');\n                // this.defineDefault();\n            }\n\n            add($btnInput, $expInput, expEditorInput) {\n                $(':focus').blur();\n                if ($btnInput.val() === '' || $expInput.val() === '') {\n                    console.log('Enter all values!');\n                    return false;\n                }\n\n                let html = `<div class=\"mq-math-mode\" style=\"cursor:pointer;font-size:100%; id=${new Date().getTime()}\">`;\n                html += '<span class=\"mq-root-block\">';\n                html += $btnInput.parent('.answer').children('div').children('.mq-root-block').html();\n                html += '</span></div>';\n                html = $(html);\n                html.find('.mq-empty').remove(); // Removes white space from buttons\n                html = html.html();\n\n                let command = expEditorInput.field.latex();\n                this.addControl(html, command);\n                return true;\n            }\n\n            addAll(value) {\n                let html = value['button'];\n                let command = value['expression'];\n                this.addControl(html, command)\n            }\n\n            addControl(html, command) {\n                let control = new EditorControl(html, field => field.write(command));\n                control.enable();\n                this.$wrapper.append(control.$element);\n                this.controls.push({button: html, expression: command});\n            }\n\n        }\n\n        return {\n            /**\n             *\n             * @param testInputId\n             * @param btnInputId\n             * @param expInputId\n             * @param templateId\n             * @param templateName\n             * @param testInputId\n             */\n            initialize: function (testInputId, btnInputId, expInputId, templateId, templateName) {\n\n                const context = {\n                    \"testInputLabel\": \"Test:\",\n                    \"inputSize\": 30,\n                    \"inputBoxTitle\": \"Add Buttons\",\n                    \"testBoxTitle\": \"Test Buttons/Save Template\",\n                    \"buttonInputLabel\": \"Button:\",\n                    \"inputSpanClass\": \"answer\",\n                    \"expressionInputLabel\": \"Expression:\",\n                    \"buttonClass\": \"btn btn-primary\",\n                    \"addButtonValue\": \"Add\",\n                    \"deleteIconClass\": \"fa fa-trash fa-2x\",\n                    \"nameInputLabel\": \"Name:\",\n                    \"saveButtonValue\": \"Save\",\n                    \"backButtonValue\": \"Go Back\"\n                };\n\n                Templates.render('qtype_shortmath/editor', context)\n                    .then(function (html, js) {\n                        Templates.appendNodeContents('div[role=\\'main\\']', html, js);\n\n                        var $shortanswerInput = $('#' + $.escapeSelector(testInputId));\n                        // Remove class \"d-inline\" added in shortanswer renderer class, which prevents input from being hidden.\n                        $shortanswerInput.removeClass('d-inline');\n                        var $parent = $('#' + $.escapeSelector(testInputId)).parent('.answer');\n\n                        var testInput = new EditorInput($shortanswerInput, $parent);\n                        testInput.$input.hide();\n                        testInput.change();\n\n                        if ($shortanswerInput.val()) {\n                            testInput.field.write(\n                                $shortanswerInput.val()\n                            );\n                        }\n\n                        var controlsWrapper = $('#' + $.escapeSelector(testInputId)).parents('.shortmath').find('.controls_wrapper');\n\n                        controlsWrapper.addClass('visual-math-input-wrapper');\n                        controlsWrapper.attr('id', 'target');\n\n                        controlsWrapper.on('drop', event => {\n                            event.preventDefault();\n\n                            if (target.id === dragged.id) {\n                                event.originalEvent.dataTransfer.clearData();\n                                return;\n                            }\n\n                            document.getElementById('placeholder').replaceWith(dragged);\n                            event.originalEvent.dataTransfer.clearData();\n                        });\n\n                        controlsWrapper.on('dragover', event => {\n                            event.preventDefault();\n                            event.originalEvent.dataTransfer.dropEffect = \"move\";\n                        });\n\n                        controlsWrapper.on('dragenter', event => {\n\n                            let targetId;\n                            if ($(event.target).hasClass('visual-math-input-wrapper')) {\n                                targetId = event.target.lastChild.id;\n                            } else if (event.target.nodeName !== 'BUTTON') {\n                                targetId = $(event.target).parents('button').attr('id');\n                            } else {\n                                targetId = event.target.id;\n                            }\n\n                            if (targetId === 'placeholder') {\n                                return;\n                            }\n\n                            target = document.getElementById(targetId);\n\n                            let targetIndex = nodes.indexOf(target);\n                            if (draggedIndex === targetIndex) { //movement within button\n                                return;\n                            }\n\n                            let empty = document.createElement('button');\n                            $(empty).html('');\n                            $(empty).addClass('visual-math-input-control btn btn-primary');\n                            $(empty).attr('draggable', true);\n                            $(empty).attr('id', 'placeholder');\n                            $(empty).css('border', '2px solid red');\n\n                            if (target.parentNode.contains(dragged)) {\n                                target.parentNode.removeChild(dragged);\n                            } else {\n                                target.parentNode.removeChild(document.getElementById('placeholder'));\n                            }\n\n                            if (draggedIndex < targetIndex) {\n                                if (target.parentNode.lastChild !== target) {\n                                    target.parentNode.insertBefore(empty, target.nextSibling); //left to right\n                                } else {\n                                    target.parentNode.appendChild(empty);\n                                }\n                            } else {\n                                target.parentNode.insertBefore(empty, target); //right to left\n                            }\n\n                            nodes = Array.from(target.parentNode.children);\n                            draggedIndex = nodes.indexOf(empty);\n                        });\n\n                        let $btnInput = $('#' + $.escapeSelector(btnInputId));\n                        // Remove class \"d-inline\" added in shortanswer renderer class, which prevents input from being hidden.\n                        $btnInput.removeClass('d-inline');\n                        $parent = $('#' + $.escapeSelector(btnInputId)).parent('.answer');\n\n                        let buttonInput = new EditorInput($btnInput, $parent);\n                        buttonInput.$input.hide();\n                        buttonInput.change();\n\n                        let $expInput = $('#' + $.escapeSelector(expInputId));\n                        // Remove class \"d-inline\" added in shortanswer renderer class, which prevents input from being hidden.\n                        $expInput.removeClass('d-inline');\n                        $parent = $('#' + $.escapeSelector(expInputId)).parent('.answer');\n\n                        let expressionInput = new EditorInput($expInput, $parent);\n                        expressionInput.$input.hide();\n                        expressionInput.change();\n\n                        let $saveButton = $('#' + $.escapeSelector('save'));\n\n                        let $testBox = $('.test-box');\n\n                        // To prevent calls to show test box repeatedly\n                        let isDataVisible = false;\n\n                        let $addButton = $('#' + $.escapeSelector('add'));\n                        let controls = new EditorControlList(controlsWrapper);\n\n                        $addButton.on('click', event => {\n                            event.preventDefault();\n\n                            let isSuccess = controls.add($btnInput, $expInput, expressionInput);\n                            if (isSuccess && !isDataVisible) {\n                                $testBox.show();\n                                isDataVisible = true;\n                            }\n\n                            //clear inputs\n                            $btnInput.parent('.answer').children('div').children('.mq-root-block').html('');\n                            $expInput.parent('.answer').children('div').children('.mq-root-block').html('');\n\n                            buttonInput.field.latex('');\n                            expressionInput.field.latex('');\n\n                        });\n\n                        if (templateId === 0) {\n                            $testBox.hide();\n                        } else {\n                            $.post(M.str.qtype_shortmath.editor_action_path,\n                                {\n                                    'id': templateId,\n                                    'type': 'get'\n                                }\n                            ).done(message => {\n                                let data = JSON.parse(message);\n                                isDataVisible = true;\n                                JSON.parse(data['template']).forEach(controls.addAll.bind(controls));\n                            }).fail((jqXHR, textStatus, errorThrown) => {\n                                notification.addNotification({\n                                    message: textStatus + ': ' + errorThrown,\n                                    type: \"error\"\n                                });\n                            });\n                        }\n\n                        let $templateNameInput = $('#' + $.escapeSelector('name'));\n                        $templateNameInput.val(templateName);\n                        $templateNameInput.on('blur', () => {\n                            lastFocusedInput = $templateNameInput;\n                        });\n\n                        $saveButton.on('click', event => {\n                            event.preventDefault();\n\n                            // Clear notifications\n                            $('#' + $.escapeSelector('user-notifications')).children().remove();\n                            let name = $templateNameInput.val().trim();\n                            if (name === '') {\n                                notification.addNotification({\n                                    message: \"Name cannot be blank!\",\n                                    type: \"error\"\n                                });\n                                $templateNameInput.focus();\n                                return;\n                            }\n                            $.post(M.str.qtype_shortmath.editor_action_path,\n                                {\n                                    'data': JSON.stringify(controls.controls),\n                                    'name': name,\n                                    'id': templateId\n                                }\n                            ).done(message => {\n                                if (message > 0) {\n                                    notification.addNotification({\n                                        message: \"Configuration saved!\",\n                                        type: \"success\"\n                                    });\n                                    if (templateId > 0) {\n                                        $('#' + $.escapeSelector('overlay-div')).show();\n                                        setTimeout(() => {\n                                            window.location.replace(M.str.qtype_shortmath.editor_manager_path);\n                                        }, 5000);\n                                    } else {\n                                        controlsWrapper.html('');\n                                        controls = new EditorControlList(controlsWrapper);\n                                        $templateNameInput.val('');\n                                        testInput.field.latex('');\n                                        $testBox.hide();\n                                        isDataVisible = false;\n                                    }\n                                } else {\n                                    notification.addNotification({\n                                        message: \"Something went wrong!\",\n                                        type: \"error\"\n                                    });\n                                }\n                                $saveButton.blur();\n                            }).fail((jqXHR, textStatus, errorThrown) => {\n                                notification.addNotification({\n                                    message: textStatus + ': ' + errorThrown,\n                                    type: \"error\"\n                                });\n                                $saveButton.blur();\n                            });\n                        });\n\n                        let deleteIcon = $('.delete-icon');\n\n                        deleteIcon.on('dragover', event => {\n                            event.preventDefault();\n                            event.originalEvent.dataTransfer.dropEffect = \"move\";\n                        });\n\n                        deleteIcon.on('drop', event => {\n                            event.preventDefault();\n                            let parentNode = dragged.parentNode;\n                            if (parentNode !== null) {\n                                parentNode.removeChild(dragged);\n                                if (parentNode.firstElementChild === null) {\n                                    testInput.field.latex('');\n                                    $testBox.hide();\n                                    isDataVisible = false;\n                                }\n                            } else {\n                                let placeholder = document.getElementById('placeholder');\n                                if (placeholder !== null) {\n                                    placeholder.parentNode.removeChild(placeholder);\n                                }\n                            }\n                            event.originalEvent.dataTransfer.clearData();\n                        });\n\n                        let $backButton = $('#' + $.escapeSelector('back'));\n                        $backButton.on('click', event => {\n                            event.preventDefault();\n                            window.location.replace(M.str.qtype_shortmath.editor_manager_path);\n                        });\n\n                    }).fail(function (ex) {\n                    // Deal with this exception (I recommend core/notify exception function for this).\n                });\n            }\n        };\n    });\n"],"file":"view-editor.min.js"}