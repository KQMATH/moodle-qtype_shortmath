define ("qtype_shortmath/view-editor",["exports","core/notification","core/templates","qtype_shortmath/api-helpers","qtype_shortmath/visual-math-input"],function(a,b,c,d,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.initialize=void 0;b=f(b);c=f(c);e=f(e);function f(a){return a&&a.__esModule?a:{default:a}}function g(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){c(a);return}if(h.done){b(i)}else{Promise.resolve(i).then(d,e)}}function h(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){var i=a.apply(b,c);function f(a){g(i,d,e,f,h,"next",a)}function h(a){g(i,d,e,f,h,"throw",a)}f(void 0)})}}function i(a,b,c){if("undefined"!=typeof Reflect&&Reflect.get){i=Reflect.get}else{i=function(a,b,c){var d=q(a,b);if(!d)return;var e=Object.getOwnPropertyDescriptor(d,b);if(e.get){return e.get.call(c)}return e.value}}return i(a,b,c||a)}function j(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){j=function(a){return typeof a}}else{j=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return j(a)}function k(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function l(a,b){for(var c=0,d;c<b.length;c++){d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;if("value"in d)d.writable=!0;Object.defineProperty(a,d.key,d)}}function m(a,b,c){if(b)l(a.prototype,b);if(c)l(a,c);return a}function n(a,b,c,d){if("undefined"!=typeof Reflect&&Reflect.set){n=Reflect.set}else{n=function(a,b,c,d){var e=q(a,b),f;if(e){f=Object.getOwnPropertyDescriptor(e,b);if(f.set){f.set.call(d,c);return!0}else if(!f.writable){return!1}}f=Object.getOwnPropertyDescriptor(d,b);if(f){if(!f.writable){return!1}f.value=c;Object.defineProperty(d,b,f)}else{p(d,b,c)}return!0}}return n(a,b,c,d)}function o(a,b,c,d,e){var f=n(a,b,c,d||a);if(!f&&e){throw new Error("failed to set property")}return c}function p(a,b,c){if(b in a){Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0})}else{a[b]=c}return a}function q(a,b){while(!Object.prototype.hasOwnProperty.call(a,b)){a=x(a);if(null===a)break}return a}function r(a,b){if("function"!=typeof b&&null!==b){throw new TypeError("Super expression must either be null or a function")}a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}});if(b)s(a,b)}function s(a,b){s=Object.setPrototypeOf||function(a,b){a.__proto__=b;return a};return s(a,b)}function t(a){return function(){var b=x(a),c;if(w()){var d=x(this).constructor;c=Reflect.construct(b,arguments,d)}else{c=b.apply(this,arguments)}return u(this,c)}}function u(a,b){if(b&&("object"===j(b)||"function"==typeof b)){return b}return v(a)}function v(a){if(void 0===a){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return a}function w(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return!0}catch(a){return!1}}function x(a){x=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)};return x(a)}var y=null,z,A,B,C=!0,D=function(a){r(b,a);var c=t(b);function b(a,d){var e;k(this,b);e=c.call(this,a,d);e.textarea.addEventListener("focusout",function(){y=v(e)});e.rawInput.setAttribute("required",!0);e.rawInput.classList.add("form-control");var f=document.createElement("div");f.classList.add("invalid-feedback","text-nowrap");e.parent.appendChild(f);return e}m(b,[{key:"change",value:function change(){o(x(b.prototype),"onEdit",function(a,b){a.value=b.latex();if(!C&&null!==a.closest(".test-box")){if(0===a.value.length){a.parentElement.children.forEach(function(a){a.classList.remove("form-control","is-valid");a.classList.add("form-control","is-invalid")})}else{a.parentElement.children.forEach(function(a){a.classList.remove("form-control","is-invalid");a.classList.add("form-control","is-valid")})}}a.dispatchEvent(new Event("change"))},this,!0)}}]);return b}(e.default.Input),E=function(a){r(b,a);var c=t(b);function b(a,d,e,f){var g;k(this,b);g=c.call(this,a,d,e);g.command=f;return g}m(b,[{key:"enable",value:function enable(){var a=this;i(x(b.prototype),"enable",this).call(this);this.element.onclick=function(b){b.preventDefault();document.querySelector(":focus").blur();if(null!==y){if(y.mathInput===void 0){y.focus();return}a.onClick(y.mathInput);y.mathInput.focus()}};this.element.id=this.name;this.element.setAttribute("draggable",!0);this.element.addEventListener("dragstart",function(a){z=a.target;A=Array.from(z.parentNode.children);B=A.indexOf(z);a.dataTransfer.setData("text",a.target.id);a.dataTransfer.dropEffect="move";document.querySelector(".delete-box").classList.remove("d-none")});this.element.addEventListener("dragend",function(a){a.target.style.opacity="";document.querySelector(":focus").blur();if(null!==document.getElementById("placeholder")){document.getElementById("placeholder").replaceWith(z)}document.querySelector(".delete-box").classList.add("d-none")})}}]);return b}(e.default.Control),F=function(a){r(b,a);var c=t(b);function b(a){k(this,b);return c.call(this,a)}m(b,[{key:"add",value:function add(a,b){console.log(a);console.log(b);var c=a.__controller.container[0].querySelector(".mq-root-block"),d=c.outerHTML;this.addControl("btn_"+Date.now(),d,b.latex());return!0}},{key:"addAll",value:function addAll(a){var b=a.name,c=a.button,d=a.expression;this.addControl(b,c,d)}},{key:"addControl",value:function addControl(a,b,c){var d=new E(a,b,function(a){return a.write(c)},c);this.controls[a]=d;d.enable();this.wrapper.append(d.element)}}]);return b}(e.default.ControlList),G=function(a,e,f){var g,i,j,k,l,m,n,o,p,q,r,s,t,u,v=!1,w=function(){p=document.querySelector("#test");j=document.querySelector("#btn");m=document.querySelector("#exp");p.classList.remove("d-inline");o=new D(p,".answer");o.change();q=o.mathInput;console.log(q);if(p.value){q.write(p.value)}j.classList.remove("d-inline");i=new D(j,".answer");i.change();k=i.mathInput;m.classList.remove("d-inline");l=new D(m,".answer");l.change();n=l.mathInput},x=function(){r=document.querySelector(".controls_wrapper");r.classList.add("visual-math-input-wrapper");r.id="target";r.addEventListener("drop",function(a){a.preventDefault();if(s.id===z.id){a.dataTransfer.clearData();return}document.getElementById("placeholder").replaceWith(z);a.dataTransfer.clearData()});r.addEventListener("dragover",function(a){a.preventDefault();a.dataTransfer.dropEffect="move"});r.addEventListener("dragenter",function(a){var b;if(a.target.classList.contains("visual-math-input-wrapper")){b=a.target.lastChild.id}else if("BUTTON"!==a.target.nodeName){b=a.target.closest("button").id}else{b=a.target.id}if("placeholder"===b){return}s=document.getElementById(b);var c=A.indexOf(s);if(B===c){return}var d=document.createElement("button");d.id="placeholder";d.classList.add("visual-math-input-control","btn","btn-primary");d.setAttribute("draggable",!0);if(s.parentNode.contains(z)){s.parentNode.removeChild(z)}else{s.parentNode.removeChild(document.getElementById("placeholder"))}if(B<c){if(s.parentNode.lastChild!==s){s.parentNode.insertBefore(d,s.nextSibling)}else{s.parentNode.appendChild(d)}}else{s.parentNode.insertBefore(d,s)}A=Array.from(s.parentNode.children);B=A.indexOf(d)})},E=function(){var c=h(regeneratorRuntime.mark(function c(){var e,f,g;return regeneratorRuntime.wrap(function(c){while(1){switch(c.prev=c.next){case 0:e=document.querySelector("#addForm");f=document.querySelector("#add");document.querySelector(".test-box");u=new F(r);i.parent.querySelector(".invalid-feedback").textContent="Button is empty or invalid!";l.parent.querySelector(".invalid-feedback").textContent="Expression is empty or invalid!";f.addEventListener("click",function(a){a.preventDefault();e.dispatchEvent(new Event("submit"))});e.addEventListener("submit",function(a){a.preventDefault();a.stopPropagation();if(!1===e.checkValidity()){C=!1;document.querySelector(":focus").blur();e.querySelectorAll("input[type=text].form-control").forEach(function(a){if(0===a.value.length){a.parentElement.querySelector(".visual-math-input-field").classList.add("form-control","is-invalid")}})}else{C=u.add(k,n);C=!0;if(C){if(!v){v=!0}e.querySelector(".visual-math-input-field").classList.remove("form-control","is-valid");k.latex("");n.latex("")}}});c.prev=8;console.log(a);c.next=12;return(0,d.getShortmathTemplate)(a);case 12:g=c.sent;console.log(g);c.next=19;break;case 16:c.prev=16;c.t0=c["catch"](8);b.default.addNotification({message:c.t0,type:"error"});case 19:case"end":return c.stop();}}},c,null,[[8,16]])}));return function(){return c.apply(this,arguments)}}(),G=function(){var a=h(regeneratorRuntime.mark(function a(){var b;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:b=document.querySelector(".delete-icon");b.addEventListener("dragover",function(a){a.preventDefault();a.dataTransfer.dropEffect="move"});b.addEventListener("drop",function(a){a.preventDefault();var b=z.parentNode;if(null!==b){b.removeChild(z);if(null===b.firstElementChild){q.latex("");v=!1}}else{var c=document.getElementById("placeholder");if(null!==c){c.parentNode.removeChild(c)}}a.dataTransfer.clearData()});case 3:case"end":return a.stop();}}},a)}));return function(){return a.apply(this,arguments)}}(),H=function(){var a=h(regeneratorRuntime.mark(function a(){var b,c;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:b=document.querySelector("#save");g=document.querySelector("#name");c=document.querySelector("#saveForm");g.addEventListener("blur",function(){y=g});c.addEventListener("submit",function(a){a.preventDefault();if(!1===c.checkValidity()){c.classList.add("was-validated");a.stopPropagation()}else{var b=[],e=u.controls;r.querySelectorAll("button").forEach(function(a){var c=e[a.id];b.push({name:c.name,button:c.text,expression:c.command})});var f=(0,d.saveShortmathTemplate)(g,JSON.stringify(b),f);I(f);c.classList.remove("was-validated")}});b.addEventListener("click",function(a){a.preventDefault();c.dispatchEvent(new Event("submit"))});case 6:case"end":return a.stop();}}},a)}));return function(){return a.apply(this,arguments)}}(),I=function(a){if(0<a){b.default.addNotification({message:"Configuration saved! Please wait...",type:"success"});document.querySelector("overlay-div").style.display="block";setTimeout(function(){window.location.replace(f)},5e3)}else{b.default.addNotification({message:"Configuration saved!",type:"success"});r.innerHTML="";u=new F(r);g.value="";q.latex("");k.latex("");n.latex("");v=!1}t.blur();return{controls:u,isDataVisible:v}},J=function(){var a=h(regeneratorRuntime.mark(function a(){var b;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:b=document.querySelector("#back");b.addEventListener("click",function(a){a.preventDefault();window.location.replace(f)});case 2:case"end":return a.stop();}}},a)}));return function(){return a.apply(this,arguments)}}();c.default.render("qtype_shortmath/editor",{testInputLabel:"Test",inputSize:30,inputBoxTitle:"Add Buttons",testBoxTitle:"Test Buttons/Save Template",buttonInputLabel:"Button",inputSpanClass:"answer",expressionInputLabel:"Expression",buttonClass:"btn btn-primary",addButtonValue:"Add",deleteIconClass:"fa fa-trash fa-2x",nameInputLabel:"Name",saveButtonValue:"Save",backButtonValue:"Go Back",toolbarTitle:"Toolbar",nameErrorMessage:"Name cannot be empty!"}).then(function(a,b){c.default.appendNodeContents("div[role=\"main\"]",a,b);w();x();E();G();H();J()}).fail(b.default.exception)};a.initialize=G});
//# sourceMappingURL=view-editor.min.js.map
