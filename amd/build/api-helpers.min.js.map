{"version":3,"sources":["../src/api-helpers.js"],"names":["getShortmathTemplate","templateId","Promise","resolve","Ajax","call","methodname","args","id","done","foundTemplate","JSON","parse","template","fail","notification","exception","defaultFailCallback","saveShortmathTemplate","name","addNotification","message","type","succeeded","deleteShortmathTemplate","questionid","setTimeout","window","location"],"mappings":"kPAsBA,OACA,O,kXAQO,GAAMA,CAAAA,CAAoB,4CAAG,WAAOC,CAAP,wGAIX,IAAIC,CAAAA,OAAJ,CAAY,SAAAC,CAAO,CAAI,CAE5CC,UAAKC,IAAL,CAAU,CAAC,CACTC,UAAU,CAAE,8BADH,CAETC,IAAI,CAAE,CAAEC,EAAE,CAAEP,CAAN,CAFG,CAGTQ,IAAI,CAAE,SAAAC,CAAa,CAAI,CACrBP,CAAO,CAACQ,IAAI,CAACC,KAAL,CAAWF,CAAa,CAACG,QAAzB,CAAD,CACR,CALQ,CAMTC,IAAI,CAAEC,UAAaC,SAAb,EAA0BC,CAAmB,yCAAkChB,CAAlC,EAN1C,CAAD,CAAV,CASD,CAXsB,CAJW,QAI5BY,CAJ4B,iCAiB3BA,CAjB2B,0CAAH,uDAA1B,C,yBAqCA,GAAMK,CAAAA,CAAqB,4CAAG,WAAOC,CAAP,CAAaN,CAAb,CAAuBZ,CAAvB,wGAEX,IAAIC,CAAAA,OAAJ,CAAY,SAAAC,CAAO,CAAI,CAC7CC,UAAKC,IAAL,CAAU,CAAC,CACTC,UAAU,CAAE,+BADH,CAETC,IAAI,CAAE,CAAEY,IAAI,CAAJA,CAAF,CAAQN,QAAQ,CAARA,CAAR,CAAkBZ,UAAU,CAAVA,CAAlB,CAFG,CAGTQ,IAAI,CAAEN,CAHG,CAITW,IAAI,CAAEC,UAAaC,SAAb,EAA0BD,UAAaK,eAAb,CAA6B,CAC3DC,OAAO,kCAA4BF,CAA5B,CADoD,CAE3DG,IAAI,CAAE,OAFqD,CAA7B,CAJvB,CAAD,CAAV,CASD,CAVuB,CAFW,QAE7BC,CAF6B,iCAc5BA,CAd4B,0CAAH,uDAA3B,C,0BAwBA,QAASC,CAAAA,CAAT,CAAiCvB,CAAjC,CAA6C,CAClDG,UAAKC,IAAL,CAAU,CAAC,CACTC,UAAU,CAAE,iCADH,CAETC,IAAI,CAAE,CAAEkB,UAAU,CAAExB,CAAd,CAFG,CAGTQ,IAAI,CAAE,eAAM,CAGViB,UAAU,CAAC,UAAM,CACfC,MAAM,CAACC,QAAP,CAAkBA,QACnB,CAFS,CAEP,GAFO,CAGX,CATQ,CAUTd,IAAI,CAAEC,UAAaC,SAVV,CAAD,CAAV,CAYD,CAED,GAAMC,CAAAA,CAAmB,CAAG,SAAAI,CAAO,QAAI,WAAM,CAC3CN,UAAaK,eAAb,CAA6B,CAAEC,OAAO,CAAPA,CAAF,CAAWC,IAAI,CAAE,OAAjB,CAA7B,CACD,CAFkC,C","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @module     qtype_shortmath/api_helpers\n * @package    qtype_shortmath\n * @author     Simen Wiik <simenwiik@hotmail.com>\n * @copyright  2021 NTNU\n */\n\nimport Ajax from \"core/ajax\";\nimport notification from \"core/notification\";\n\n/**\n * Retrieves the shortmath template with given id\n *\n * @param {int} templateId id of the template, according to mdl_qtype_shortmath_templates\n *                         table in the database\n */\nexport const getShortmathTemplate = async (templateId) => {\n\n  // Since \"done\" takes a callback function, we have to wait for the\n  // callback function to complete before the ajax call returns the result\n  const template = await new Promise(resolve => {\n\n    Ajax.call([{\n      methodname: \"qtype_shortmath_get_template\",\n      args: { id: templateId },\n      done: foundTemplate => {\n        resolve(JSON.parse(foundTemplate.template));\n      },\n      fail: notification.exception || defaultFailCallback(`Couldn't get template with id ${templateId}`)\n    }]);\n\n  });\n\n  return template;\n};\n\n/**\n     * Method to generate the function to save the shortmath template to the database.\n     * The method takes a callback function, and returns a new function that takes\n     * the template name, the template itself as json, and the template id.\n     * You should use the function like this:\n     *\n     * let saveShortmathTemplate = buildShortmathTemplateSaveFunction(result => console.log(result))\n     * saveShortmathTemplate(\"My template\", \"[{...template...}]\", 2)\n     *\n     * The success callback takes one parameter, which is the return value from the web service. See the function\n     * save_template_returns in the file shortmath/classes/external/editor_template.php\n     * If you only define the success callback, the fail callback will default to a regular modal with the error.\n     *\n     * @param {string} name Name of the template\n     * @param {string} template Template as a string in JSON format\n     * @param {int} templateId id of the template, according to mdl_qtype_shortmath_templates table in the database\n     */\nexport const saveShortmathTemplate = async (name, template, templateId) => {\n\n  const succeeded = await new Promise(resolve => {\n    Ajax.call([{\n      methodname: \"qtype_shortmath_save_template\",\n      args: { name, template, templateId },\n      done: resolve,\n      fail: notification.exception || notification.addNotification({\n        message: `Couldn't save template ${name}`,\n        type: \"error\"\n      })\n    }]);\n  });\n\n  return succeeded;\n};\n\n\n/**\n * Deletes the shortmath template with given id\n *\n * @param {int} templateId id of the template, according to mdl_qtype_shortmath_templates\n *                         table in the database\n */\nexport function deleteShortmathTemplate(templateId) {\n  Ajax.call([{\n    methodname: \"qtype_shortmath_delete_template\",\n    args: { questionid: templateId },\n    done: () => {\n      // Reload webpage after 200 ms to ensure the template is deleted before\n      // the page is reloaded, or else the template will still show up\n      setTimeout(() => {\n        window.location = location;\n      }, 200);\n    },\n    fail: notification.exception\n  }]);\n}\n\nconst defaultFailCallback = message => () => {\n  notification.addNotification({ message, type: \"error\" });\n};"],"file":"api-helpers.min.js"}